"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_body=_interopRequireDefault(require("../../body")),_tools=require("../../tools"),_methods=_interopRequireDefault(require("./methods"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function renderFixed(t,e,o){var i=e.tableData,l=e.tableColumn,n=e.visibleColumn,s=e.collectColumn,r=e.isGroup,a=e.vSize,u=e.showHeader,c=e.showFooter,h=e.columnStore,f=e.footerData,d=h["".concat(o,"List")];return t("div",{class:"plx-table--fixed-".concat(o,"-wrapper"),ref:"".concat(o,"Container")},[u?t("plx-table-header",{props:{fixedType:o,tableData:i,tableColumn:l,visibleColumn:n,collectColumn:s,size:a,fixedColumn:d,isGroup:r},ref:"".concat(o,"Header")}):null,t("plx-table-body",{props:{fixedType:o,tableData:i,tableColumn:l,visibleColumn:n,collectColumn:s,fixedColumn:d,size:a,isGroup:r},ref:"".concat(o,"Body")}),c?t("plx-table-footer",{props:{fixedType:o,footerData:f,tableColumn:l,visibleColumn:n,size:a,fixedColumn:d},ref:"".concat(o,"Footer")}):null])}var _default2={name:"PlxTable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:[Boolean,String],default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,align:{type:String,default:function(){return _conf.default.align}},headerAlign:{type:String,default:function(){return _conf.default.headerAlign}},footerAlign:{type:String,default:function(){return _conf.default.footerAlign}},showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:{type:Boolean,default:function(){return _conf.default.highlightCurrentRow}},highlightHoverRow:{type:Boolean,default:function(){return _conf.default.highlightHoverRow}},highlightCurrentColumn:{type:Boolean,default:function(){return _conf.default.highlightCurrentColumn}},highlightHoverColumn:{type:Boolean,default:function(){return _conf.default.highlightHoverColumn}},highlightCell:Boolean,showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],cellStyle:[Object,Function],headerCellStyle:[Object,Function],footerCellStyle:[Object,Function],rowStyle:[Object,Function],headerRowStyle:[Object,Function],footerRowStyle:[Object,Function],spanMethod:Function,footerSpanMethod:Function,showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,remoteSort:Boolean,sortMethod:Function,columnWidth:[Number,String],columnMinWidth:[Number,String],columnKey:Boolean,rowKey:Boolean,rowId:{type:String,default:function(){return _conf.default.rowId}},zIndex:Number,autoResize:Boolean,syncResize:[Boolean,String],seqConfig:Object,sortConfig:Object,filterConfig:Object,radioConfig:Object,selectConfig:Object,checkboxConfig:Object,tooltipConfig:Object,exportConfig:[Boolean,Object],importConfig:[Boolean,Object],printConfig:Object,expandConfig:Object,treeConfig:[Boolean,Object],contextMenu:Object,mouseConfig:Object,keyboardConfig:Object,editConfig:[Boolean,Object],validConfig:Object,editRules:Object,optimization:Object,params:Object},components:{VxeTableBody:_body.default},provide:function(){return{$table:this}},inject:{$grid:{default:null}},mixins:[],data:function(){return{id:"".concat(_xeUtils.default.uniqueId()),collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollbarWidth:0,scrollbarHeight:0,isCoverBody:!1,rowHeight:0,isAllSelected:!1,isIndeterminate:!1,selection:[],currentRow:null,selectRow:null,footerData:[],rowExpandeds:[],expandLazyLoadeds:[],treeExpandeds:[],treeLazyLoadeds:[],treeIndeterminates:[],filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],childPos:null,style:null},editStore:{indexs:{columns:[]},titles:{columns:[]},checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1},importStore:{file:null,type:"",filename:"",visible:!1},importParams:{mode:"",types:null,message:!0},exportStore:{name:"",mode:"",columns:[],selectRecords:[],hasFooter:!1,visible:!1,isTree:!1},exportParams:{filename:"",sheetName:"",type:"",types:[],original:!1,message:!0,isHeader:!1,isFooter:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},validOpts:function(){return Object.assign({message:"default"},_conf.default.validConfig,this.validConfig)},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},rowHeightMaps:function(){return Object.assign({default:48,medium:44,small:40,mini:36},this.optimizeOpts.rHeights)},seqOpts:function(){return Object.assign({startIndex:0},_conf.default.seqConfig,this.seqConfig)},radioOpts:function(){return Object.assign({},_conf.default.radioConfig,this.radioConfig)},checkboxOpts:function(){return Object.assign({},_conf.default.checkboxConfig,this.checkboxConfig||this.selectConfig)},tooltipOpts:function(){return Object.assign({size:this.vSize,leaveDelay:300},_conf.default.tooltipConfig,this.tooltipConfig)},vaildTipOpts:function(){return Object.assign({isArrow:!1},this.tooltipOpts)},editOpts:function(){return Object.assign({},_conf.default.editConfig,this.editConfig)},sortOpts:function(){return Object.assign({},_conf.default.sortConfig,this.sortConfig)},filterOpts:function(){return Object.assign({},_conf.default.filterConfig,this.filterConfig)},mouseOpts:function(){return Object.assign({},_conf.default.mouseConfig,this.mouseConfig)},isGroup:function(){return this.collectColumn.some(function(t){return _tools.UtilTools.hasChildrenList(t)})},hasTip:function(){return _vXETable.default._tooltip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(t){return t.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(t){return t.resizable})},hasFilter:function(){return this.tableColumn.some(function(t){return t.filters&&t.filters.length})},headerCtxMenu:function(){return this.ctxMenuOpts.header&&this.ctxMenuOpts.header.options?this.ctxMenuOpts.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuOpts.body&&this.ctxMenuOpts.body.options?this.ctxMenuOpts.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuOpts:function(){return Object.assign({},_conf.default.menu,this.contextMenu)},ctxMenuList:function(){var e=[];return this.ctxMenuStore.list.forEach(function(t){t.forEach(function(t){e.push(t)})}),e},exportOpts:function(){return Object.assign({},_conf.default.exportConfig,this.exportConfig)},importOpts:function(){return Object.assign({},_conf.default.importConfig,this.importConfig)},printOpts:function(){return Object.assign({},_conf.default.printConfig,this.printConfig)},expandOpts:function(){return Object.assign({},_conf.default.expandConfig,this.expandConfig)},treeOpts:function(){return Object.assign({children:"children",hasChild:"hasChild",indent:20},_conf.default.treeConfig,this.treeConfig)},cellOffsetWidth:function(){return this.border?Math.max(2,Math.ceil(this.scrollbarWidth/this.tableColumn.length)):1},expandColumn:function(){return this.tableColumn.find(function(t){return"expand"===t.type})},isAllCheckboxDisabled:function(){var t=this.tableFullData,e=(this.treeConfig,this.checkboxOpts),o=e.strict,i=e.checkMethod;return!!o&&(!t.length||!!i&&t.every(function(t,e){return!i({row:t,rowIndex:e,$rowIndex:e})}))}},watch:{data:function(t){var e=this;this.loadTableData(t).then(function(){e.inited||(e.inited=!0,e.handleDefaults())})},customs:function(t){this.isUpdateCustoms||this.mergeCustomColumn(t),this.isUpdateCustoms=!1},collectColumn:function(t){var e=this,o=_tools.UtilTools.getColumnList(t);if(this.tableFullColumn=o,this.cacheColumnMap(),this.customs&&this.mergeCustomColumn(this.customs),this.refreshColumn().then(function(){e.scrollXLoad&&e.updateVirtualScrollX(!0)}),this.handleTableData(!0),this.$toolbar&&this.$toolbar.updateColumn(o),o.length){var i=Math.floor((o.length-1)/2);o[i].prop&&_tools.UtilTools.warn("plx.error.delProp",["prop","field"]),o[i].label&&_tools.UtilTools.warn("plx.error.delProp",["label","title"])}this.treeConfig&&o.some(function(t){return t.fixed})&&o.some(function(t){return"expand"===t.type})&&_tools.UtilTools.warn("plx.error.treeFixedExpand")},tableColumn:function(){this.analyColumnWidth()},height:function(){var t=this;this.$nextTick(function(){return t.recalculate(!0)})},loading:function(){this._isLoading||(this._isLoading=!0)},syncResize:function(t){var e=this;t&&this.$nextTick(function(){e.$el.clientWidth&&e.$el.clientHeight&&e.recalculate(!0)})}},created:function(){var t,e=this,o=Object.assign(this,{tZindex:0,elemStore:{},scrollXStore:{},scrollYStore:{},tooltipStore:{},parentHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,lastScrollLeft:0,lastScrollTop:0,selectReserveRowMap:{},tableFullData:[],afterFullData:[],fullAllDataRowMap:new Map,fullAllDataRowIdData:{},fullDataRowMap:new Map,fullDataRowIdData:{},fullColumnMap:new Map,fullColumnIdData:{}}),i=o.scrollXStore,l=o.scrollYStore,n=o.optimizeOpts,s=o.data,r=o.loading,a=o.treeOpts,u=o.treeConfig,c=o.showOverflow,h=n.scrollX,f=n.scrollY;if(this._isLoading=r,_tools.UtilTools.getRowkey(this)||_tools.UtilTools.error("plx.error.emptyProp",["row-id"]),this.startIndex,this.selectConfig,!u||!a.line||this.rowKey&&c||_tools.UtilTools.warn("plx.error.reqProp",["row-key | show-overflow"]),this.customs,this.sortMethod,this.remoteSort,this.remoteFilter,!_vXETable.default._edit&&this.editConfig?t="Edit":!_vXETable.default._valid&&this.editRules?t="Validator":_vXETable.default._keyboard||!this.keyboardConfig&&!this.mouseConfig?!_vXETable.default._resize&&this.autoResize&&(t="Resize"):t="Keyboard",t)throw new Error(_tools.UtilTools.getLog("plx.error.reqModule",[t]));f&&Object.assign(l,{startIndex:0,visibleIndex:0,adaptive:!_xeUtils.default.isBoolean(f.adaptive)||f.adaptive,renderSize:_xeUtils.default.toNumber(f.rSize),offsetSize:_xeUtils.default.toNumber(f.oSize)}),h&&Object.assign(i,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(h.rSize),offsetSize:_xeUtils.default.toNumber(h.oSize)}),this.loadTableData(s).then(function(){s&&s.length&&(e.inited=!0,e.handleDefaults()),e.updateStyle()}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent),this.preventEvent(null,"created",{$table:this})},mounted:function(){this.autoResize&&_vXETable.default._resize&&this.bindResize(),document.body.appendChild(this.$refs.tableWrapper),this.preventEvent(null,"mounted",{$table:this})},activated:function(){this.refreshScroll(),this.preventEvent(null,"activated",{$table:this})},deactivated:function(){this.preventEvent(null,"deactivated",{$table:this})},beforeDestroy:function(){var t=this.$refs.tableWrapper;t&&t.parentNode&&t.parentNode.removeChild(t),_vXETable.default._resize&&this.unbindResize(),this.closeFilter(),this.closeMenu(),this.clearAll(),this.preventEvent(null,"beforeDestroy",{$table:this})},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize"),_tools.GlobalEvent.off(this,"contextmenu"),this.preventEvent(null,"destroyed",{$table:this})},render:function(t){var e=this._e,o=this.id,i=this.isCoverBody,l=this.tableData,n=this.tableColumn,s=this.visibleColumn,r=this.collectColumn,a=this.isGroup,u=this.hasFilter,c=this.isResizable,h=this.isCtxMenu,f=this.loading,d=this.stripe,p=this._isLoading,b=this.showHeader,m=this.height,g=this.border,C=this.treeOpts,x=this.treeConfig,v=this.mouseConfig,_=this.mouseOpts,O=this.vSize,y=this.validOpts,w=this.editRules,S=this.showFooter,z=this.footerMethod,j=this.overflowX,M=this.overflowY,E=this.scrollXLoad,R=this.scrollYLoad,F=this.scrollbarHeight,D=this.highlightCell,T=this.highlightHoverRow,L=this.highlightHoverColumn,B=this.editConfig,H=this.checkboxOpts,G=this.optimizeOpts,$=this.vaildTipOpts,k=this.tooltipOpts,I=this.columnStore,q=this.filterStore,N=this.ctxMenuStore,U=this.footerData,X=this.hasTip,A=I.leftList,P=I.rightList,W=v&&(_.range||_.checked);return t("div",{class:["plx-table","tid_".concat(o),O?"size--".concat(O):"",g&&_xeUtils.default.isString(g)?"b--style-".concat(g):"",{"plx-editable":B,"show--head":b,"show--foot":S,"is--group":a,"has--height":m,"has--tree-line":x&&C.line,"fixed--left":A.length,"fixed--right":P.length,"c--highlight":D,"t--animat":G.animat,"t--stripe":d,"t--border":g,"t--selected":v&&_.selected,"t--checked":W,"row--highlight":T,"column--highlight":L,"is--cover":i,"is--loading":f,"scroll--y":M,"scroll--x":j,"virtual--x":E,"virtual--y":R}]},[t("div",{class:"plx-table-hidden-column",ref:"hideColumn"},this.$slots.default),t("div",{class:"plx-table--main-wrapper"},[b?t("plx-table-header",{ref:"tableHeader",props:{tableData:l,tableColumn:n,visibleColumn:s,collectColumn:r,size:O,isGroup:a}}):e(),t("plx-table-body",{ref:"tableBody",props:{tableData:l,tableColumn:n,visibleColumn:s,collectColumn:r,size:O,isGroup:a}}),S?t("plx-table-footer",{props:{footerData:U,footerMethod:z,tableColumn:n,visibleColumn:s,size:O},ref:"tableFooter"}):null]),A&&A.length&&j?renderFixed(t,this,"left"):e(),P&&P.length&&j?renderFixed(t,this,"right"):e(),f||l.length?e():t("div",{ref:"emptyPlaceholder",class:"plx-table--empty-placeholder"},[t("div",{class:"plx-table--empty-content"},this.$scopedSlots.empty?this.$scopedSlots.empty.call(this,{$table:this},t):_conf.default.i18n("plx.table.emptyText"))]),c?t("div",{class:"plx-table--resizable-bar",style:j?{"padding-bottom":"".concat(F,"px")}:null,ref:"resizeBar"}):e(),t("div",{class:"plx-table--border-line"}),p?t("plx-table-loading",{props:{visible:f}}):e(),u?t("plx-table-filter",{props:{optimizeOpts:G,filterStore:q},ref:"filterWrapper"}):e(),_vXETable.default._export?t("plx-import-panel",{props:{defaultOptions:this.importParams,storeData:this.importStore},on:{import:this.confirmImportEvent}}):e(),_vXETable.default._export?t("plx-export-panel",{props:{defaultOptions:this.exportParams,storeData:this.exportStore},on:{print:this.confirmPrintEvent,export:this.confirmExportEvent}}):e(),t("div",{class:"plx-table".concat(o,"-wrapper ").concat(this.$vnode.data.staticClass||""),ref:"tableWrapper"},[H.range?t("div",{class:"plx-table--checkbox-range",ref:"checkboxRange"}):e(),h?t("plx-table-context-menu",{props:{ctxMenuStore:N},ref:"ctxWrapper"}):e(),X?t("plx-tooltip",{ref:"tooltip",props:k,on:k.enterable?{leave:this.handleTooltipLeaveEvent}:null}):e(),X&&w&&("default"===y.message?!m:"tooltip"===y.message)?t("plx-tooltip",{class:"plx-table--valid-error",props:"tooltip"===y.message||1===l.length?$:null,ref:"validTip"}):e()])])},methods:_methods.default};exports.default=_default2;