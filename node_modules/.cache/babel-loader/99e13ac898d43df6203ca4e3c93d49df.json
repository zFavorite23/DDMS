{"remainingRequest":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js!D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js!D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\components\\File\\Upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\components\\File\\Upload.vue","mtime":1588235430027},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { qiuNiuUpToken, createFile } from \"../../api/file/upload\";\nimport { renderSize } from \"../../filtres/index\";\nexport default {\n  name: \"Upload\",\n  props: {\n    height: {\n      type: Number\n    },\n    width: {\n      type: Number\n    },\n    ext: {\n      type: String\n    },\n    size: {\n      type: Number\n    },\n    color: {\n      type: String,\n      default: \"#1890ff\"\n    }\n  },\n  data: function data() {\n    return {\n      activeName: \"localhost\",\n      file: null,\n      fileName: \"\",\n      filePath: \"\",\n      filePathUrl: \"\",\n      fileUrl: \"\",\n      dialogVisible: false,\n      uploadLoading: false\n    };\n  },\n  methods: {\n    onDrag: function onDrag(e) {\n      e.stopPropagation();\n      e.preventDefault();\n    },\n    onDrop: function onDrop(e) {\n      e.stopPropagation();\n      e.preventDefault();\n      var data = e.dataTransfer.files; // 获取文件对象\n\n      if (data.length < 1) {\n        return false; // 检测是否有文件拖拽到页面\n      }\n\n      this.file = data[0];\n      this.fileName = data[0].name;\n    },\n    onChange: function onChange(e) {\n      var data = e.target.files; // 获取文件对象\n\n      if (data.length < 1) {\n        return false; // 检测是否有文件拖拽到页面\n      }\n\n      this.file = data[0];\n      this.fileName = data[0].name;\n      e.target.value = \"\";\n    },\n    onReset: function onReset() {\n      this.activeName = \"localhost\";\n      this.file = null;\n      this.fileName = \"\";\n      this.filePath = \"\";\n      this.filePathUrl = \"\";\n      this.fileUrl = \"\";\n      this.dialogVisible = false;\n      this.uploadLoading = false;\n    },\n    handleSubmit: function handleSubmit() {\n      var _this2 = this;\n\n      if (this.activeName === \"network\") {\n        if (!this.fileUrl) {\n          this.$message.error(\"请输入文件网络地址\");\n          return;\n        }\n\n        this.$emit(\"on-select\", this.fileUrl, this.fileUrl);\n        this.onReset();\n        return;\n      }\n\n      if (this.file === null) {\n        this.$message.error(\"请先选择文件\");\n        return;\n      } // 检查文件\n\n\n      var isVerify = this.beforeUpload(this.file);\n\n      if (isVerify === false) {\n        return;\n      }\n\n      isVerify.then(function () {\n        _this2.uploadLoading = true;\n        qiuNiuUpToken().then(function (response) {\n          if (response.code > 0) {\n            _this2.$message.error(\"出现未知问题，刷新页面\");\n\n            return;\n          }\n\n          var url = response.data.upload_url;\n          var formData = new FormData();\n          formData.append(\"token\", response.data.up_token);\n          formData.append(\"file\", _this2.file);\n          createFile(url, formData).then(function (response) {\n            _this2.uploadLoading = false;\n\n            if (response.key || response.data.key) {\n              var filePath = response.key || response.data.key;\n\n              var _URL = window.URL || window.webkitURL;\n\n              var filePathUrl = _URL.createObjectURL(_this2.file);\n\n              _this2.$emit(\"on-select\", filePath, filePathUrl);\n\n              _this2.onReset();\n\n              return;\n            }\n\n            _this2.$message.error(\"上传出错\");\n          }).catch(function () {\n            _this2.uploadLoading = false;\n\n            _this2.$message.error(\"上传出错\");\n          });\n        }).catch(function () {\n          _this2.uploadLoading = false;\n\n          _this2.$message.error(\"出现未知问题，刷新页面\");\n        });\n      }).catch(function () {});\n    },\n    beforeUpload: function beforeUpload(file) {\n      var name = file.name ? file.name : \"\";\n      var ext = name ? name.substr(name.lastIndexOf(\".\") + 1, name.length) : true; // 转成小写\n\n      ext = ext.toLowerCase();\n      var isExt = false; // 如果有坚持文件后缀的配置\n\n      if (this.ext) {\n        isExt = this.ext.indexOf(ext) >= 0;\n\n        if (!isExt) {\n          this.$message.error(\"文件只能为 \" + this.ext + \" 格式!\");\n          return false;\n        }\n      }\n\n      var isSize = false;\n\n      if (this.size) {\n        var sizeStr = this.size;\n        isSize = sizeStr > 0 && file.size > sizeStr;\n\n        if (isSize) {\n          this.$message.error(\"上传文件不能超过 \" + renderSize(sizeStr) + \"!\");\n          return false;\n        }\n      }\n\n      var _this = this;\n\n      if (_this.width || _this.height) {\n        return new Promise(function (resolve, reject) {\n          var width = _this.width;\n          var height = _this.height;\n\n          var _URL = window.URL || window.webkitURL;\n\n          var img = new Image();\n          img.src = _URL.createObjectURL(file);\n\n          img.onload = function () {\n            var valid = (!width || img.width === width) && (!height || img.height === height);\n\n            if (valid) {\n              resolve();\n            } else {\n              var messageStr = \"\";\n\n              if (width && !height) {\n                messageStr = width;\n              }\n\n              if (height && !width) {\n                messageStr = height;\n              }\n\n              if (height && width) {\n                messageStr = width + \"*\" + height;\n              }\n\n              _this.$message.error(\"上传尺寸必须是 \" + messageStr + \" px!\");\n\n              reject();\n            }\n          };\n        });\n      }\n\n      return new Promise(function (resolve) {\n        resolve();\n      });\n    }\n  },\n  computed: {},\n  watch: {}\n};",null]}