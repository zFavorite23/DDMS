{"remainingRequest":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js!D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js!D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\purchase\\execute\\Edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\purchase\\execute\\Edit.vue","mtime":1597996042416},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.function.name\";\nimport _defineProperty from \"D:\\\\DDMS\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getApplyUserInfo } from \"../../../api/admin/user.js\";\nimport { getPurchase as _getPurchase, getPurchaseInfo as _getPurchaseInfo, applyEditpurchaseEs } from \"../../../api/purchase/purchase.js\";\nimport { mapGetters } from 'vuex';\nexport default {\n  data: function data() {\n    return {\n      query: {\n        companyId: null,\n        userId: null,\n        deptId: null,\n        itemId: null,\n        type: 6,\n        priceYuan: 0\n      },\n      formData: {\n        userId: null,\n        itemId: 0,\n        // 数据id\n        purchaseId: null,\n        // 采购名称\n        name: '',\n        // 详细分类\n        type1: '',\n        type2: '',\n        type3: '',\n        // 链接\n        buyUrl: '',\n        // 推荐厂家\n        factoryName: '',\n        // 型号参数\n        model: '',\n        // 数量\n        num: '',\n        // 单位\n        unit: '',\n        // 单价\n        price: '',\n        // 预估总价\n        guessPrice: '',\n        // 备注\n        remark: '',\n        // 预计到货时间\n        guessTime: '',\n        // 需求描述\n        demand: '',\n        // 型号参数图片\n        purchaseImg: '',\n        // 收货地址联系方式\n        contact: '',\n        // 其它参数\n        expressName: null,\n        expressNum: null,\n        isOpen: 1,\n        purchaseType: 1,\n        applyId: 1,\n        pactImg: null,\n        performNote: '',\n        pactPrice: null,\n        purchaseStatus: null,\n        payStatus: null,\n        invoiceStatus: null,\n        companyName: null,\n        bankName: null,\n        bankAccount: null,\n        guessPriceYuan: '',\n        priceYuan: '',\n        relPriceYuan: '',\n        pactPriceYuan: '',\n        aliasNext: '',\n        itemNextId: null\n      },\n      userOptions: [{\n        value: '合同谈判中',\n        label: '合同谈判中'\n      }, {\n        value: '合同已签订',\n        label: '合同已签订'\n      }, {\n        value: '已打全款',\n        label: '已打全款'\n      }, {\n        value: '已打首付款',\n        label: '已打首付款'\n      }, {\n        value: '已收货',\n        label: '已收货'\n      }],\n      invoice: [{\n        value: '未取得',\n        label: '未取得'\n      }, {\n        value: '未报销',\n        label: '未报销'\n      }, {\n        value: '已取得未报销',\n        label: '已取得未报销'\n      }, {\n        value: '已取得已报销',\n        label: '已取得已报销'\n      }, {\n        value: '无发票',\n        label: '无发票'\n      }, {\n        value: '已找票',\n        label: '已找票'\n      }],\n      userOptions2: [{\n        value: '已下单',\n        label: '已下单'\n      }, {\n        value: '已发货',\n        label: '已发货'\n      }, {\n        value: '已收货',\n        label: '已收货'\n      }, {\n        value: '已退货',\n        label: '已退货'\n      }, {\n        value: '已退款',\n        label: '已退款'\n      }],\n      fileList2: [],\n      applyUserList: [],\n      sumClassifyOptions: [],\n      mainClassifyOptions: [],\n      subClassifyOptions: [],\n      purchaseId: null,\n      uploadUrl: '',\n      rules: {\n        isOpen: [{\n          required: true,\n          message: '请选择对公状态',\n          trigger: 'change'\n        }],\n        companyName: [{\n          required: true,\n          message: '请填写公司名称',\n          trigger: 'change'\n        }],\n        bankName: [{\n          required: true,\n          message: '请填写开户行名称'\n        }],\n        bankAccount: [{\n          required: true,\n          message: '请填写开户行账号',\n          trigger: 'change'\n        }]\n      },\n      saving: false\n    };\n  },\n  created: function created() {\n    // this.formData.userId = this.userId;\n    this.query.userId = this.userId;\n    this.getPurchase('100000', this.userId);\n    this.uploadUrl = \"\".concat(window.location.origin, \"/apply/purchase/upload\");\n    this.purchaseId = this.$route.query.purchaseId;\n    this.getPurchaseInfo();\n  },\n  computed: _objectSpread({}, mapGetters(['permissions', 'userId'])),\n  methods: {\n    // 获取总类\n    getPurchase: function getPurchase(id, userId) {\n      var _this = this;\n\n      _getPurchase(id, userId).then(function (res) {\n        _this.sumClassifyOptions = res.data.data.purchaseType;\n      });\n    },\n    getPurchaseInfo: function getPurchaseInfo() {\n      var _this2 = this;\n\n      _getPurchaseInfo(this.purchaseId).then(function (res) {\n        var editPurchaseInfo = res.data.data;\n        _this2.formData.name = editPurchaseInfo.name;\n        _this2.formData.buyUrl = editPurchaseInfo.buyUrl;\n        _this2.formData.itemId = editPurchaseInfo.itemId;\n        _this2.formData.aliasNext = editPurchaseInfo.aliasNext;\n        _this2.formData.itemNextId = editPurchaseInfo.itemNextId;\n        _this2.formData.purchaseId = editPurchaseInfo.purchaseId;\n        _this2.query.itemId = editPurchaseInfo.itemId;\n        _this2.formData.type1 = editPurchaseInfo.type1;\n\n        if (editPurchaseInfo.itemId != null && editPurchaseInfo.itemNextId == null) {\n          _this2.formData.type2 = [editPurchaseInfo.type2, editPurchaseInfo.itemId];\n        } else if (editPurchaseInfo.itemNextId != null) {\n          _this2.formData.type2 = [editPurchaseInfo.type2, editPurchaseInfo.itemNextId, editPurchaseInfo.itemId];\n        } else {\n          _this2.formData.type2 = [editPurchaseInfo.type2];\n        }\n\n        _this2.formData.type3 = editPurchaseInfo.type3;\n        _this2.formData.factoryName = editPurchaseInfo.factoryName;\n        _this2.formData.model = editPurchaseInfo.model;\n        _this2.formData.demand = editPurchaseInfo.demand;\n        _this2.formData.num = editPurchaseInfo.num;\n        _this2.formData.unit = editPurchaseInfo.unit;\n        _this2.formData.priceYuan = editPurchaseInfo.priceYuan;\n        _this2.formData.pactPriceYuan = editPurchaseInfo.pactPriceYuan;\n        _this2.formData.guessPriceYuan = editPurchaseInfo.guessPriceYuan;\n        _this2.formData.remark = editPurchaseInfo.remark;\n        _this2.formData.purchaseImg = editPurchaseInfo.purchaseImg;\n        _this2.formData.contact = editPurchaseInfo.contact;\n        _this2.formData.guessTime = editPurchaseInfo.guessTime;\n        _this2.formData.expressName = editPurchaseInfo.expressName;\n        _this2.formData.expressNum = editPurchaseInfo.expressNum;\n        _this2.formData.isOpen = editPurchaseInfo.isOpen;\n        _this2.formData.purchaseType = editPurchaseInfo.purchaseType;\n        _this2.formData.applyId = editPurchaseInfo.applyId;\n\n        if (editPurchaseInfo.pactImg == null) {\n          _this2.formData.pactImg = '';\n        } else {\n          _this2.formData.pactImg = editPurchaseInfo.pactImg;\n          editPurchaseInfo.pactImg.split(',').forEach(function (item, index) {\n            if (item) {\n              _this2.fileList2.push({\n                url: \"\".concat(window.location.origin, \"/apply/purchase/\") + item\n              });\n            }\n          });\n        }\n\n        _this2.formData.pactPrice = editPurchaseInfo.pactPrice * 0.01;\n        _this2.formData.purchaseStatus = editPurchaseInfo.purchaseStatus;\n        _this2.formData.performNote = editPurchaseInfo.performNote;\n        _this2.formData.payStatus = editPurchaseInfo.payStatus;\n        _this2.formData.invoiceStatus = editPurchaseInfo.invoiceStatus;\n        _this2.formData.companyName = editPurchaseInfo.companyName;\n        _this2.formData.bankName = editPurchaseInfo.bankName;\n        _this2.formData.bankAccount = editPurchaseInfo.bankAccount;\n        _this2.formData.relPriceYuan = editPurchaseInfo.relPriceYuan;\n        editPurchaseInfo.checkUserList.forEach(function (item) {\n          _this2.applyUserList.push({\n            userId: item.checkUserId,\n            username: item.checkUserName,\n            avatar: item.checkUserAvatar\n          });\n        }); //console.log(editPurchaseInfo.invoiceImg)\n\n        _getPurchase(_this2.formData.type1, _this2.userId).then(function (res) {\n          res.data.data.purchaseType.forEach(function (item) {\n            _this2.mainClassifyOptions.push({\n              value: item.id,\n              label: item.name,\n              children: item.children\n            });\n          });\n        });\n\n        _getPurchase(_this2.formData.type2[0], _this2.userId).then(function (res) {\n          _this2.subClassifyOptions = res.data.data.purchaseType;\n        });\n      });\n\n      console.log(this.formData);\n    },\n    // 提交\n    onSubmit: function onSubmit() {\n      var _this3 = this;\n\n      this.formData.type2 = this.formData.type2[0];\n      console.log(this.formData);\n      this.$refs['formData'].validate(function (valid) {\n        if (valid) {\n          _this3.saving = true;\n          applyEditpurchaseEs(_this3.formData).then(function (res) {\n            console.log(res);\n\n            _this3.backHistory();\n          }).finally(function () {\n            _this3.saving = false;\n          });\n        }\n      });\n    },\n    handlePreview2: function handlePreview2(file) {\n      console.log(file);\n    },\n    handleRemove2: function handleRemove2(data) {\n      var serverUrl = \"\".concat(window.location.origin, \"/apply/purchase/\");\n      var imgUrl = data.url.replace(serverUrl, '');\n      this.formData.pactImg = this.formData.pactImg.replace(imgUrl + ',', '');\n    },\n    handSuccess2: function handSuccess2(data) {\n      var imgInfo = data.data;\n      var imgUrl = imgInfo.bucketName + '-' + imgInfo.fileName;\n      this.formData.pactImg += imgUrl + ',';\n    },\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      var isJPG = file.type === 'image/jpeg';\n      var isPNG = file.type === 'image/png';\n      var isPG = isJPG || isPNG; //限制图片格式为jpg / png\n\n      var isLt5M = file.size / 1024 / 1024 < 5; //限制图片大小\n\n      if (!isPG) {\n        this.$message.error('上传头像图片只能是 JPG 或 PNG 格式!');\n      }\n\n      if (!isLt5M) {\n        this.$message.error('上传头像图片大小不能超过 5MB!');\n      }\n\n      return isPG && isLt5M;\n    },\n    // 取消\n    backHistory: function backHistory() {\n      this.$router.go(-1);\n    },\n    goExpense: function goExpense() {\n      this.formData.type2 = this.formData.type2[0];\n      window.localStorage.setItem('editPurchaseInfo', JSON.stringify(this.formData));\n      this.$router.push({\n        path: '/apply/expense/form'\n      });\n    },\n    isOpen: function isOpen(val) {\n      if (val == 2) {\n        // console.log(132132132);\n        this.formData.companyName = '';\n        this.formData.bankName = '';\n        this.formData.bankAccount = '';\n        this.formData.pactPrice = '';\n        this.formData.pactImg = null;\n        this.formData.payStatus = '';\n        this.formData.purchaseStatus = '';\n      }\n\n      console.log(this.formData);\n    }\n  }\n};",null]}