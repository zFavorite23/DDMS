{"remainingRequest":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js!D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\admin\\UserInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\admin\\UserInfo.vue","mtime":1588235430045},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"D:\\\\DDMS\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getUserInfo as _getUserInfo, editUser, getWeixinAvatar as _getWeixinAvatar } from \"../../api/admin/user.js\";\nimport { mapGetters } from \"vuex\";\nexport default {\n  data: function data() {\n    var validatePass = function validatePass(rule, value, callback) {\n      if (value === \"\") {\n        callback(new Error(\"请输入密码\"));\n      } else {\n        if (!/^[0-9A-Za-z]{6,15}$/.test(value)) {\n          callback(new Error(\"密码少于6位\"));\n        }\n\n        callback();\n      }\n    };\n\n    return {\n      formData: {\n        userId: \"\",\n        username: \"\",\n        avatar: \"\",\n        phone: \"\",\n        newpassword1: \"\",\n        joinedTime: \"\",\n        wxOpenid: \"\"\n      },\n      saving: false,\n      rules: {\n        password: [{\n          required: true,\n          message: \"请输入新密码\",\n          trigger: \"blur\"\n        }, {\n          validator: validatePass,\n          trigger: \"blur\"\n        }]\n      },\n      uploadUrl: \"\"\n    };\n  },\n  created: function created() {\n    this.formData.userId = this.userId;\n    this.getUserInfo();\n    this.uploadUrl = \"\".concat(window.location.origin, \"/admin/user/file/upload\");\n  },\n  computed: _objectSpread({}, mapGetters([\"permissions\", \"userId\"])),\n  methods: {\n    getUserInfo: function getUserInfo() {\n      var _this = this;\n\n      _getUserInfo(this.formData.userId).then(function (response) {\n        if (response.data.data) {\n          var userInfo = response.data.data;\n          _this.formData.username = userInfo.username;\n          _this.formData.avatar = userInfo.avatar;\n          _this.formData.phone = userInfo.phone;\n          _this.formData.joinedTime = userInfo.joinedTime;\n          _this.formData.wxOpenid = userInfo.wxOpenid;\n        }\n      });\n    },\n    backHistory: function backHistory() {\n      this.$router.go(-1);\n    },\n    handleAvatarSuccess: function handleAvatarSuccess(res, file) {\n      var avatarUrl = \"\".concat(window.location.origin, \"/admin/user/file/\") + res.data.bucketName + \"-\" + res.data.fileName;\n      this.formData.avatar = avatarUrl;\n      this.imageUrl = URL.createObjectURL(file.raw);\n    },\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      var isJPG = file.type === \"image/jpeg\";\n      var isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error(\"上传头像图片只能是 JPG 格式!\");\n      }\n\n      if (!isLt2M) {\n        this.$message.error(\"上传头像图片大小不能超过 2MB!\");\n      }\n\n      return isJPG && isLt2M;\n    },\n    onSubmit: function onSubmit() {\n      var _this2 = this;\n\n      if (this.formData.phone.indexOf(\"*\") != -1) {\n        this.formData.phone = \"\";\n      }\n\n      editUser(this.formData).then(function (res) {\n        if (res.data.data) {\n          _this2.$message({\n            message: \"修改成功\",\n            type: \"success\"\n          }); // 刷新表单\n\n\n          _this2.$store.dispatch(\"loginOut\").then(function () {\n            location.reload(); // 为了重新实例化vue-router对象 避免bug\n          });\n        }\n      }).finally(function () {\n        _this2.saving = false;\n      });\n    },\n    getWeixinAvatar: function getWeixinAvatar() {\n      var _this3 = this;\n\n      _getWeixinAvatar(this.formData.userId).then(function (response) {\n        if (response.data.data) {\n          _this3.formData.avatar = response.data.data; //console.log(response.data.data)\n        }\n      });\n    }\n  },\n  mounted: function mounted() {}\n};",{"version":3,"sources":["UserInfo.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n    <div>\r\n        <el-form\r\n            label-position=\"right\"\r\n            :model=\"formData\"\r\n            :rules=\"rules\"\r\n            ref=\"formData\"\r\n            class=\"form\"\r\n            label-width=\"135px\"\r\n        >\r\n            <el-form-item label=\"头像：\">\r\n                <el-upload\r\n                    class=\"avatar-uploader\"\r\n                    :action=\"uploadUrl\"\r\n                    name=\"file\"\r\n                    :show-file-list=\"false\"\r\n                    :on-success=\"handleAvatarSuccess\"\r\n                    :before-upload=\"beforeAvatarUpload\"\r\n                >\r\n                    <img\r\n                        v-if=\"formData.avatar\"\r\n                        :src=\"formData.avatar\"\r\n                        class=\"avatar\"\r\n                    />\r\n                    <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n                </el-upload>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"姓名：\" prop=\"username\">\r\n                <el-input\r\n                    v-model=\"formData.username\"\r\n                    placeholder=\"请姓入姓名\"\r\n                    :disabled=\"true\"\r\n                ></el-input>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"手机号：\" prop=\"phone\">\r\n                <el-input\r\n                    v-model=\"formData.phone\"\r\n                    placeholder=\"请姓入姓名\"\r\n                    :disabled=\"true\"\r\n                ></el-input>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"密码：\" prop=\"password\">\r\n                <el-input\r\n                    v-model=\"formData.newpassword1\"\r\n                    placeholder=\"请输入密码\"\r\n                    minlength=\"6\"\r\n                    maxlength=\"50\"\r\n                    show-word-limit\r\n                ></el-input>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"入职时间：\" prop=\"joinedTime\">\r\n                <el-input\r\n                    v-model=\"formData.joinedTime\"\r\n                    placeholder=\"请选择入职时间\"\r\n                    :disabled=\"true\"\r\n                ></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"绑定微信：\">\r\n                <!--                <el-link v-if=\"formData.wxOpenid\" type=\"success\">已绑定</el-link>-->\r\n                <!--                <el-link v-else type=\"danger\">未绑定</el-link>-->\r\n                <el-button v-if=\"formData.wxOpenid\" type=\"success\" size=\"mini\"\r\n                    >已绑定</el-button\r\n                >\r\n                <el-button v-else type=\"danger\" size=\"mini\">去绑定</el-button>\r\n\r\n                <el-button v-if=\"formData.wxOpenid\" type=\"primary\" size=\"mini\" @click=\"getWeixinAvatar\">获取微信头像</el-button>\r\n            </el-form-item>\r\n            <el-form-item style=\"text-align: center\" class=\"save\">\r\n                <el-button type=\"primary\" @click=\"onSubmit\" :loading=\"saving\"\r\n                    >保存</el-button\r\n                >\r\n                <el-button @click=\"backHistory\">取消</el-button>\r\n            </el-form-item>\r\n        </el-form>\r\n    </div>\r\n</template>\r\n<script>\r\nimport { getUserInfo, editUser, getWeixinAvatar} from \"../../api/admin/user.js\";\r\nimport { mapGetters } from \"vuex\";\r\nexport default {\r\n    data() {\r\n        let validatePass = (rule, value, callback) => {\r\n            if (value === \"\") {\r\n                callback(new Error(\"请输入密码\"));\r\n            } else {\r\n                if (!/^[0-9A-Za-z]{6,15}$/.test(value)) {\r\n                    callback(new Error(\"密码少于6位\"));\r\n                }\r\n                callback();\r\n            }\r\n        };\r\n        return {\r\n            formData: {\r\n                userId: \"\",\r\n                username: \"\",\r\n                avatar: \"\",\r\n                phone: \"\",\r\n                newpassword1: \"\",\r\n                joinedTime: \"\",\r\n                wxOpenid: \"\"\r\n            },\r\n            saving: false,\r\n            rules: {\r\n                password: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入新密码\",\r\n                        trigger: \"blur\"\r\n                    },\r\n                    { validator: validatePass, trigger: \"blur\" }\r\n                ]\r\n            },\r\n            uploadUrl: \"\",\r\n        };\r\n    },\r\n    created() {\r\n        this.formData.userId = this.userId;\r\n        this.getUserInfo();\r\n        this.uploadUrl = `${window.location.origin}/admin/user/file/upload`;\r\n    },\r\n    computed: {\r\n        ...mapGetters([\"permissions\", \"userId\"])\r\n    },\r\n    methods: {\r\n        getUserInfo() {\r\n            getUserInfo(this.formData.userId).then(response => {\r\n                if (response.data.data) {\r\n                    const userInfo = response.data.data;\r\n                    this.formData.username = userInfo.username;\r\n                    this.formData.avatar = userInfo.avatar;\r\n                    this.formData.phone = userInfo.phone;\r\n                    this.formData.joinedTime = userInfo.joinedTime;\r\n                    this.formData.wxOpenid = userInfo.wxOpenid;\r\n                }\r\n            });\r\n        },\r\n        backHistory() {\r\n            this.$router.go(-1);\r\n        },\r\n        handleAvatarSuccess(res, file) {\r\n            var avatarUrl = `${window.location.origin}/admin/user/file/` + res.data.bucketName + \"-\" + res.data.fileName;\r\n            this.formData.avatar = avatarUrl;\r\n            this.imageUrl = URL.createObjectURL(file.raw);\r\n        },\r\n        beforeAvatarUpload(file) {\r\n            const isJPG = file.type === \"image/jpeg\";\r\n            const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n            if (!isJPG) {\r\n                this.$message.error(\"上传头像图片只能是 JPG 格式!\");\r\n            }\r\n            if (!isLt2M) {\r\n                this.$message.error(\"上传头像图片大小不能超过 2MB!\");\r\n            }\r\n            return isJPG && isLt2M;\r\n        },\r\n        onSubmit() {\r\n            if (this.formData.phone.indexOf(\"*\") != -1) {\r\n                this.formData.phone = \"\";\r\n            }\r\n            editUser(this.formData)\r\n                .then(res => {\r\n                    if (res.data.data) {\r\n                        this.$message({\r\n                            message: \"修改成功\",\r\n                            type: \"success\"\r\n                        });\r\n                        // 刷新表单\r\n                        this.$store.dispatch(\"loginOut\").then(() => {\r\n                            location.reload(); // 为了重新实例化vue-router对象 避免bug\r\n                        });\r\n                    }\r\n                })\r\n                .finally(() => {\r\n                    this.saving = false;\r\n                });\r\n        },\r\n        getWeixinAvatar() {\r\n            getWeixinAvatar(this.formData.userId).then(response => {\r\n                if (response.data.data) {\r\n                    this.formData.avatar = response.data.data;\r\n                    //console.log(response.data.data)\r\n                }\r\n            })\r\n        }\r\n    },\r\n    mounted() {}\r\n};\r\n</script>\r\n<style type=\"text/scss\" scoped lang=\"scss\">\r\n.el-input .el-input__count .el-input__count-inner {\r\n    height: 50%;\r\n}\r\n.el-image img {\r\n    border-radius: 50%;\r\n}\r\n@media screen and (min-width: 1300px) {\r\n    .el-input {\r\n        width: 300%;\r\n    }\r\n    .el-textarea {\r\n        width: 400% !important;\r\n    }\r\n}\r\n@media screen and (max-width: 320px) {\r\n    .el-input {\r\n        width: 85% !important;\r\n    }\r\n    .save {\r\n        margin-left: -45%;\r\n    }\r\n}\r\n.avatar-uploader .el-upload {\r\n    border: 1px dashed #d9d9d9;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    position: relative;\r\n    overflow: hidden;\r\n}\r\n.avatar-uploader .el-upload:hover {\r\n    border-color: #409eff;\r\n}\r\n.avatar-uploader-icon {\r\n    font-size: 28px;\r\n    color: #8c939d;\r\n    width: 178px;\r\n    height: 178px;\r\n    line-height: 178px;\r\n    text-align: center;\r\n}\r\n.avatar {\r\n    width: 178px;\r\n    height: 178px;\r\n    display: block;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/views/admin"}]}