{"remainingRequest":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js!D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\components\\File\\Upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\components\\File\\Upload.vue","mtime":1588235430027},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { qiuNiuUpToken, createFile } from \"../../api/file/upload\";\nimport { renderSize } from \"../../filtres/index\";\nexport default {\n  name: \"Upload\",\n  props: {\n    height: {\n      type: Number\n    },\n    width: {\n      type: Number\n    },\n    ext: {\n      type: String\n    },\n    size: {\n      type: Number\n    },\n    color: {\n      type: String,\n      default: \"#1890ff\"\n    }\n  },\n  data: function data() {\n    return {\n      activeName: \"localhost\",\n      file: null,\n      fileName: \"\",\n      filePath: \"\",\n      filePathUrl: \"\",\n      fileUrl: \"\",\n      dialogVisible: false,\n      uploadLoading: false\n    };\n  },\n  methods: {\n    onDrag: function onDrag(e) {\n      e.stopPropagation();\n      e.preventDefault();\n    },\n    onDrop: function onDrop(e) {\n      e.stopPropagation();\n      e.preventDefault();\n      var data = e.dataTransfer.files; // 获取文件对象\n\n      if (data.length < 1) {\n        return false; // 检测是否有文件拖拽到页面\n      }\n\n      this.file = data[0];\n      this.fileName = data[0].name;\n    },\n    onChange: function onChange(e) {\n      var data = e.target.files; // 获取文件对象\n\n      if (data.length < 1) {\n        return false; // 检测是否有文件拖拽到页面\n      }\n\n      this.file = data[0];\n      this.fileName = data[0].name;\n      e.target.value = \"\";\n    },\n    onReset: function onReset() {\n      this.activeName = \"localhost\";\n      this.file = null;\n      this.fileName = \"\";\n      this.filePath = \"\";\n      this.filePathUrl = \"\";\n      this.fileUrl = \"\";\n      this.dialogVisible = false;\n      this.uploadLoading = false;\n    },\n    handleSubmit: function handleSubmit() {\n      var _this2 = this;\n\n      if (this.activeName === \"network\") {\n        if (!this.fileUrl) {\n          this.$message.error(\"请输入文件网络地址\");\n          return;\n        }\n\n        this.$emit(\"on-select\", this.fileUrl, this.fileUrl);\n        this.onReset();\n        return;\n      }\n\n      if (this.file === null) {\n        this.$message.error(\"请先选择文件\");\n        return;\n      } // 检查文件\n\n\n      var isVerify = this.beforeUpload(this.file);\n\n      if (isVerify === false) {\n        return;\n      }\n\n      isVerify.then(function () {\n        _this2.uploadLoading = true;\n        qiuNiuUpToken().then(function (response) {\n          if (response.code > 0) {\n            _this2.$message.error(\"出现未知问题，刷新页面\");\n\n            return;\n          }\n\n          var url = response.data.upload_url;\n          var formData = new FormData();\n          formData.append(\"token\", response.data.up_token);\n          formData.append(\"file\", _this2.file);\n          createFile(url, formData).then(function (response) {\n            _this2.uploadLoading = false;\n\n            if (response.key || response.data.key) {\n              var filePath = response.key || response.data.key;\n\n              var _URL = window.URL || window.webkitURL;\n\n              var filePathUrl = _URL.createObjectURL(_this2.file);\n\n              _this2.$emit(\"on-select\", filePath, filePathUrl);\n\n              _this2.onReset();\n\n              return;\n            }\n\n            _this2.$message.error(\"上传出错\");\n          }).catch(function () {\n            _this2.uploadLoading = false;\n\n            _this2.$message.error(\"上传出错\");\n          });\n        }).catch(function () {\n          _this2.uploadLoading = false;\n\n          _this2.$message.error(\"出现未知问题，刷新页面\");\n        });\n      }).catch(function () {});\n    },\n    beforeUpload: function beforeUpload(file) {\n      var name = file.name ? file.name : \"\";\n      var ext = name ? name.substr(name.lastIndexOf(\".\") + 1, name.length) : true; // 转成小写\n\n      ext = ext.toLowerCase();\n      var isExt = false; // 如果有坚持文件后缀的配置\n\n      if (this.ext) {\n        isExt = this.ext.indexOf(ext) >= 0;\n\n        if (!isExt) {\n          this.$message.error(\"文件只能为 \" + this.ext + \" 格式!\");\n          return false;\n        }\n      }\n\n      var isSize = false;\n\n      if (this.size) {\n        var sizeStr = this.size;\n        isSize = sizeStr > 0 && file.size > sizeStr;\n\n        if (isSize) {\n          this.$message.error(\"上传文件不能超过 \" + renderSize(sizeStr) + \"!\");\n          return false;\n        }\n      }\n\n      var _this = this;\n\n      if (_this.width || _this.height) {\n        return new Promise(function (resolve, reject) {\n          var width = _this.width;\n          var height = _this.height;\n\n          var _URL = window.URL || window.webkitURL;\n\n          var img = new Image();\n          img.src = _URL.createObjectURL(file);\n\n          img.onload = function () {\n            var valid = (!width || img.width === width) && (!height || img.height === height);\n\n            if (valid) {\n              resolve();\n            } else {\n              var messageStr = \"\";\n\n              if (width && !height) {\n                messageStr = width;\n              }\n\n              if (height && !width) {\n                messageStr = height;\n              }\n\n              if (height && width) {\n                messageStr = width + \"*\" + height;\n              }\n\n              _this.$message.error(\"上传尺寸必须是 \" + messageStr + \" px!\");\n\n              reject();\n            }\n          };\n        });\n      }\n\n      return new Promise(function (resolve) {\n        resolve();\n      });\n    }\n  },\n  computed: {},\n  watch: {}\n};",{"version":3,"sources":["Upload.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n    <div class=\"upload-container\">\r\n        <el-button\r\n            :style=\"{ background: color, borderColor: color }\"\r\n            icon=\"el-icon-upload\"\r\n            size=\"mini\"\r\n            type=\"primary\"\r\n            @click=\"dialogVisible = true\"\r\n            >上传文件</el-button\r\n        >\r\n\r\n        <el-dialog\r\n            custom-class=\"upload-dialog__body\"\r\n            width=\"450px\"\r\n            title=\"插入图片\"\r\n            :visible.sync=\"dialogVisible\"\r\n            append-to-body\r\n        >\r\n            <el-tabs v-model=\"activeName\">\r\n                <el-tab-pane label=\"本地上传\" name=\"localhost\">\r\n                    <div class=\"upload-content\">\r\n                        <span class=\"text-muted\"\r\n                            >只能上传{{ ext }}文件，且大小不超过{{\r\n                                size | renderSize\r\n                            }}，且宽高 {{ width ? width + \"px\" : \"不限\" }} *\r\n                            {{ height ? height + \"px\" : \"不限\" }}</span\r\n                        >\r\n                        <br />\r\n                        <div\r\n                            class=\"widget-upload\"\r\n                            @dragenter=\"onDrag\"\r\n                            @dragover=\"onDrag\"\r\n                            @drop=\"onDrop\"\r\n                        >\r\n                            <input\r\n                                type=\"file\"\r\n                                ref=\"upload\"\r\n                                name=\"file\"\r\n                                class=\"widget-upload__file\"\r\n                                @change=\"onChange\"\r\n                            />\r\n                            <el-input\r\n                                class=\"widget-upload__text\"\r\n                                size=\"medium\"\r\n                                placeholder=\"文件拖拽到这里\"\r\n                                v-model=\"fileName\"\r\n                            >\r\n                            </el-input>\r\n                            <el-button size=\"medium\">选择文件</el-button>\r\n                        </div>\r\n                    </div>\r\n                </el-tab-pane>\r\n                <el-tab-pane label=\"远程地址获取\" name=\"network\">\r\n                    <div class=\"upload-content\">\r\n                        <span class=\"text-muted\"\r\n                            >只能上传{{ ext }}文件，且大小不超过{{\r\n                                size | renderSize\r\n                            }}，且宽高 {{ width ? width + \"px\" : \"不限\" }} *\r\n                            {{ height ? height + \"px\" : \"不限\" }}</span\r\n                        >\r\n                        <br />\r\n                        <div class=\"widget-upload\">\r\n                            <el-input\r\n                                size=\"medium\"\r\n                                placeholder=\"请输入文件所在网址\"\r\n                                v-model=\"fileUrl\"\r\n                            >\r\n                            </el-input>\r\n                        </div>\r\n                    </div>\r\n                </el-tab-pane>\r\n            </el-tabs>\r\n\r\n            <div style=\"text-align: right;padding-top: 40px;\">\r\n                <el-button size=\"medium\" @click=\"dialogVisible = false\"\r\n                    >取 消</el-button\r\n                >\r\n                <el-button\r\n                    size=\"medium\"\r\n                    type=\"primary\"\r\n                    @click=\"handleSubmit\"\r\n                    :loading=\"uploadLoading\"\r\n                    >插入</el-button\r\n                >\r\n            </div>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { qiuNiuUpToken, createFile } from \"../../api/file/upload\";\r\nimport { renderSize } from \"../../filtres/index\";\r\n\r\nexport default {\r\n    name: \"Upload\",\r\n    props: {\r\n        height: {\r\n            type: Number\r\n        },\r\n        width: {\r\n            type: Number\r\n        },\r\n        ext: {\r\n            type: String\r\n        },\r\n        size: {\r\n            type: Number\r\n        },\r\n        color: {\r\n            type: String,\r\n            default: \"#1890ff\"\r\n        }\r\n    },\r\n    data() {\r\n        return {\r\n            activeName: \"localhost\",\r\n            file: null,\r\n            fileName: \"\",\r\n            filePath: \"\",\r\n            filePathUrl: \"\",\r\n            fileUrl: \"\",\r\n            dialogVisible: false,\r\n            uploadLoading: false\r\n        };\r\n    },\r\n    methods: {\r\n        onDrag(e) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n        },\r\n        onDrop(e) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            const data = e.dataTransfer.files;\r\n            // 获取文件对象\r\n            if (data.length < 1) {\r\n                return false; // 检测是否有文件拖拽到页面\r\n            }\r\n            this.file = data[0];\r\n            this.fileName = data[0].name;\r\n        },\r\n        onChange(e) {\r\n            const data = e.target.files;\r\n            // 获取文件对象\r\n            if (data.length < 1) {\r\n                return false; // 检测是否有文件拖拽到页面\r\n            }\r\n            this.file = data[0];\r\n            this.fileName = data[0].name;\r\n            e.target.value = \"\";\r\n        },\r\n        onReset() {\r\n            this.activeName = \"localhost\";\r\n            this.file = null;\r\n            this.fileName = \"\";\r\n            this.filePath = \"\";\r\n            this.filePathUrl = \"\";\r\n            this.fileUrl = \"\";\r\n            this.dialogVisible = false;\r\n            this.uploadLoading = false;\r\n        },\r\n        handleSubmit() {\r\n            if (this.activeName === \"network\") {\r\n                if (!this.fileUrl) {\r\n                    this.$message.error(\"请输入文件网络地址\");\r\n                    return;\r\n                }\r\n                this.$emit(\"on-select\", this.fileUrl, this.fileUrl);\r\n                this.onReset();\r\n                return;\r\n            }\r\n            if (this.file === null) {\r\n                this.$message.error(\"请先选择文件\");\r\n                return;\r\n            }\r\n            // 检查文件\r\n            let isVerify = this.beforeUpload(this.file);\r\n            if (isVerify === false) {\r\n                return;\r\n            }\r\n            isVerify\r\n                .then(() => {\r\n                    this.uploadLoading = true;\r\n                    qiuNiuUpToken()\r\n                        .then(response => {\r\n                            if (response.code > 0) {\r\n                                this.$message.error(\"出现未知问题，刷新页面\");\r\n                                return;\r\n                            }\r\n                            const url = response.data.upload_url;\r\n                            const formData = new FormData();\r\n                            formData.append(\"token\", response.data.up_token);\r\n                            formData.append(\"file\", this.file);\r\n                            createFile(url, formData)\r\n                                .then(response => {\r\n                                    this.uploadLoading = false;\r\n                                    if (response.key || response.data.key) {\r\n                                        const filePath =\r\n                                            response.key || response.data.key;\r\n                                        let _URL =\r\n                                            window.URL || window.webkitURL;\r\n                                        const filePathUrl = _URL.createObjectURL(\r\n                                            this.file\r\n                                        );\r\n                                        this.$emit(\r\n                                            \"on-select\",\r\n                                            filePath,\r\n                                            filePathUrl\r\n                                        );\r\n                                        this.onReset();\r\n                                        return;\r\n                                    }\r\n                                    this.$message.error(\"上传出错\");\r\n                                })\r\n                                .catch(() => {\r\n                                    this.uploadLoading = false;\r\n                                    this.$message.error(\"上传出错\");\r\n                                });\r\n                        })\r\n                        .catch(() => {\r\n                            this.uploadLoading = false;\r\n                            this.$message.error(\"出现未知问题，刷新页面\");\r\n                        });\r\n                })\r\n                .catch(() => {});\r\n        },\r\n        beforeUpload(file) {\r\n            const name = file.name ? file.name : \"\";\r\n            let ext = name\r\n                ? name.substr(name.lastIndexOf(\".\") + 1, name.length)\r\n                : true;\r\n            // 转成小写\r\n            ext = ext.toLowerCase();\r\n            let isExt = false;\r\n            // 如果有坚持文件后缀的配置\r\n            if (this.ext) {\r\n                isExt = this.ext.indexOf(ext) >= 0;\r\n                if (!isExt) {\r\n                    this.$message.error(\"文件只能为 \" + this.ext + \" 格式!\");\r\n                    return false;\r\n                }\r\n            }\r\n            let isSize = false;\r\n            if (this.size) {\r\n                let sizeStr = this.size;\r\n                isSize = sizeStr > 0 && file.size > sizeStr;\r\n                if (isSize) {\r\n                    this.$message.error(\r\n                        \"上传文件不能超过 \" + renderSize(sizeStr) + \"!\"\r\n                    );\r\n                    return false;\r\n                }\r\n            }\r\n            const _this = this;\r\n            if (_this.width || _this.height) {\r\n                return new Promise(function(resolve, reject) {\r\n                    let width = _this.width;\r\n                    let height = _this.height;\r\n                    let _URL = window.URL || window.webkitURL;\r\n                    let img = new Image();\r\n                    img.src = _URL.createObjectURL(file);\r\n                    img.onload = function() {\r\n                        let valid =\r\n                            (!width || img.width === width) &&\r\n                            (!height || img.height === height);\r\n                        if (valid) {\r\n                            resolve();\r\n                        } else {\r\n                            let messageStr = \"\";\r\n                            if (width && !height) {\r\n                                messageStr = width;\r\n                            }\r\n                            if (height && !width) {\r\n                                messageStr = height;\r\n                            }\r\n                            if (height && width) {\r\n                                messageStr = width + \"*\" + height;\r\n                            }\r\n                            _this.$message.error(\r\n                                \"上传尺寸必须是 \" + messageStr + \" px!\"\r\n                            );\r\n                            reject();\r\n                        }\r\n                    };\r\n                });\r\n            }\r\n            return new Promise(function(resolve) {\r\n                resolve();\r\n            });\r\n        }\r\n    },\r\n    computed: {},\r\n    watch: {}\r\n};\r\n</script>\r\n\r\n<style type=\"text/scss\" lang=\"scss\">\r\n.upload-dialog__body {\r\n    .el-dialog__header {\r\n        background-color: #f3f3f3;\r\n        border-top-left-radius: 6px;\r\n        border-top-right-radius: 6px;\r\n    }\r\n    .el-dialog__body {\r\n        padding: 12px 20px !important;\r\n    }\r\n}\r\n.upload-content {\r\n    padding-top: 15px;\r\n    .widget-upload {\r\n        position: relative;\r\n    }\r\n    .widget-upload__text {\r\n        width: 66.66%;\r\n        padding-right: 15px;\r\n        .el-input__inner {\r\n            border: 1px solid #ccc;\r\n            background-color: #eee;\r\n        }\r\n    }\r\n    .widget-upload {\r\n        padding-top: 5px;\r\n        .widget-upload__file {\r\n            position: absolute;\r\n            opacity: 0;\r\n            width: 85%;\r\n            height: 100%;\r\n            z-index: 10;\r\n            cursor: pointer;\r\n        }\r\n    }\r\n}\r\n</style>\r\n"],"sourceRoot":"src/components/File"}]}