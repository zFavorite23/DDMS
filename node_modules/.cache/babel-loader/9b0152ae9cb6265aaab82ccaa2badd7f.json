{"remainingRequest":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js!D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js!D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\apply\\invoice\\Info.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\apply\\invoice\\Info.vue","mtime":1598348529786},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _defineProperty from \"D:\\\\DDMS\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getInvoiceInfo as _getInvoiceInfo, affirmInvoice, getInvoiceApproverList as _getInvoiceApproverList, updateInvoiceApprover, getInvoiceRefuse as _getInvoiceRefuse } from \"../../../api/apply/invoice.js\";\nimport { print as _print } from \"../../../utils/utils\";\nimport { mapGetters } from 'vuex';\nimport ElImageViewer from 'element-ui/packages/image/src/image-viewer';\nimport moment from 'moment';\nexport default {\n  components: {\n    ElImageViewer: ElImageViewer\n  },\n  data: function data() {\n    return {\n      month: '',\n      formData: {\n        approverId: null,\n        checkUserId: null,\n        check: '1',\n        summary: '同意'\n      },\n      invoiceInfo: {\n        applyUserName: '',\n        invoiceTime: ''\n      },\n      invoiceId: null,\n      createTime: null,\n      listLoading: false,\n      list: [],\n      approverList: [],\n      rules: {\n        summary: [{\n          required: true,\n          message: '请填写原因'\n        }]\n      },\n      previewTime: '',\n      previewList: [],\n      checkUser1: '',\n      checkUser2: '',\n      checkUser3: '',\n      applyUser: '',\n      showCheck: false,\n      saving: false,\n      url: '',\n      urls1: [],\n      urls2: [],\n      showViewer: false,\n      // 显示查看器\n      RefuseInfo: []\n    };\n  },\n  computed: _objectSpread({}, mapGetters(['permissions', 'userId', 'deptId'])),\n  created: function created() {\n    this.invoiceId = this.$route.params.invoiceId;\n    this.formData.checkUserId = this.userId;\n    this.getInvoiceInfo();\n    this.getInvoiceRefuse(); // window.addEventListener('beforeunload', e => this.beforeunloadFn(e))\n  },\n  methods: {\n    getInvoiceRefuse: function getInvoiceRefuse() {\n      var _this = this;\n\n      _getInvoiceRefuse(this.invoiceId).then(function (res) {\n        console.log(res);\n        _this.RefuseInfo = res.data.data;\n      });\n    },\n    getInvoiceInfo: function getInvoiceInfo() {\n      var _this2 = this;\n\n      _getInvoiceInfo(this.invoiceId).then(function (response) {\n        _this2.invoiceInfo = response.data.data;\n        console.log(_this2.invoiceInfo);\n        _this2.invoiceInfo.invoiceTimeCh = moment(_this2.invoiceInfo.invoiceTime).format('YYYY年MM月DD日');\n        _this2.invoiceInfo.payTimeCh = moment(_this2.invoiceInfo.payTime).format('YYYY年MM月DD日');\n        _this2.urls1 = [];\n        _this2.urls2 = [];\n\n        if (_this2.invoiceInfo.payImg) {\n          _this2.invoiceInfo.payImg.split(',').forEach(function (item, index) {\n            if (item) {\n              _this2.urls1.push(\"\".concat(window.location.origin, \"/apply/invoice/\") + item);\n            }\n          });\n        }\n\n        if (_this2.invoiceInfo.invoiceImg) {\n          _this2.invoiceInfo.invoiceImg.split(',').forEach(function (item, index) {\n            if (item) {\n              _this2.urls2.push(\"\".concat(window.location.origin, \"/apply/invoice/\") + item);\n            }\n          });\n        }\n\n        if (_this2.invoiceInfo.type1 == 22 || _this2.invoiceInfo.type1 == 10) {\n          _this2.checkUser1 = '王铮';\n          _this2.checkUser3 = '王海清';\n          _this2.applyUser = '李长霖';\n        } else {\n          _this2.applyUser = _this2.invoiceInfo.applyUserName;\n        }\n\n        _this2.getInvoiceApproverList();\n      });\n    },\n    getInvoiceApproverList: function getInvoiceApproverList() {\n      var _this3 = this;\n\n      _getInvoiceApproverList(this.invoiceId).then(function (response) {\n        // console.log(response);\n        _this3.approverList = response.data.data;\n\n        _this3.approverList.forEach(function (item, index) {\n          if (item.check == 0 && item.isBeing == 1 && item.userId == _this3.formData.checkUserId) {\n            _this3.formData.approverId = item.approverId;\n            _this3.showCheck = true;\n          }\n        });\n\n        if (_this3.invoiceInfo.status == 1) {\n          if (_this3.approverList.length == 2) {\n            _this3.checkUser1 = _this3.approverList[0].checkUserName;\n            _this3.checkUser3 = _this3.approverList[1].checkUserName;\n          }\n\n          if (_this3.approverList.length == 3) {\n            _this3.checkUser1 = _this3.approverList[0].checkUserName;\n            _this3.checkUser2 = _this3.approverList[1].checkUserName;\n            _this3.checkUser3 = _this3.approverList[2].checkUserName;\n          }\n        }\n      });\n    },\n    selectChcek: function selectChcek() {\n      if (this.formData.check == 1) {\n        this.formData.summary = '同意';\n      } else {\n        this.formData.summary = '';\n      }\n    },\n    onSubmit: function onSubmit() {\n      var _this4 = this;\n\n      this.$confirm('请审批人审核发票信息、报销内容、项目名称后再同意，一经同意后流程不能逆转。', '温馨提示：', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning',\n        showClose: false\n      }).then(function () {\n        updateInvoiceApprover(_this4.formData).then(function (res) {\n          // console.log(res);\n          if (res.data.data) {\n            _this4.backHistory();\n          }\n        }).finally(function () {\n          _this4.saving = false;\n        });\n      }).catch(function () {\n        _this4.saving = false;\n      }); // console.log(this.formData);\n    },\n    backHistory: function backHistory() {\n      this.$router.go(-1);\n    },\n    onPreview1: function onPreview1(index) {\n      // this.url = this.urls1[val];\n      // this.showViewer = true;\n      var arr = [];\n      var i = 0;\n\n      for (i; i < this.urls1.length; i++) {\n        arr.push(this.urls1[i + index]);\n\n        if (i + index >= this.urls1.length - 1) {\n          index = 0 - (i + 1);\n        }\n      }\n\n      return arr;\n    },\n    closeViewer: function closeViewer() {\n      this.showViewer = false;\n      this.url = '';\n    },\n    onPreview2: function onPreview2(index) {\n      // this.url = this.urls2[val];\n      // this.showViewer = true;\n      var arr = [];\n      var i = 0;\n\n      for (i; i < this.urls2.length; i++) {\n        arr.push(this.urls2[i + index]);\n\n        if (i + index >= this.urls2.length - 1) {\n          index = 0 - (i + 1);\n        }\n      }\n\n      return arr;\n    },\n    print: function print(e) {\n      // this.remove();\n      // let subOutputRankPrint = document.getElementById('printContent');\n      // let newContent =subOutputRankPrint.innerHTML;\n      // let oldContent = document.body.innerHTML;\n      // document.body.innerHTML = newContent;\n      // window.print();\n      // // window.location.reload();\n      // document.body.innerHTML = oldContent;\n      // return false;\n      this.remove();\n\n      var windows = _print(document.getElementById('printContent').innerHTML);\n\n      windows.close();\n    },\n    remove: function remove() {\n      document.getElementById('line').style.display = 'block';\n      document.getElementById('cont').style.display = 'block';\n      var hkey_path;\n      hkey_path = 'HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Internet Explorer\\\\PageSetup\\\\';\n\n      try {\n        var RegWsh = new ActiveXObject('WScript.Shell');\n        RegWsh.RegWrite(hkey_path + 'header', '');\n        RegWsh.RegWrite(hkey_path + 'footer', '');\n      } catch (e) {}\n    },\n    handleModalAffirm: function handleModalAffirm(data) {\n      var _this5 = this;\n\n      //console.log(data)\n      if (data.invoiceId) {\n        this.$confirm('确认收到发票了吗?', '提示', {\n          type: 'warning'\n        }).then(function () {\n          var editData = {\n            invoiceId: data.invoiceId,\n            isAffirm: '1',\n            backMonth: _this5.month\n          };\n          console.log(_this5.month);\n          affirmInvoice(editData).then(function (res) {\n            if (res.data.data) {\n              _this5.getInvoiceInfo();\n            }\n          });\n        });\n      }\n    }\n  },\n  mounted: function mounted() {\n    // window.addEventListener('beforeunload', e => this.beforeunloadFn(e))\n    var date = new Date();\n    var year = date.getFullYear();\n    var month = date.getMonth() + 1;\n    month = month > 9 ? month : '0' + month;\n    var toMonth = year + '-' + month;\n    this.month = toMonth;\n  }\n};",null]}