{"remainingRequest":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js!D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js!D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\login\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\login\\index.vue","mtime":1592813778460},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.regexp.match\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { randomLenNum } from '@/utils/utils';\nimport { codeUrl } from '@/config/app';\n\nvar Base64 = require('js-base64').Base64;\n\nexport default {\n  name: 'login',\n  data: function data() {\n    return {\n      ruleForm: {\n        username: '',\n        //用户名\n        password: '',\n        code: '',\n        randomStr: ''\n      },\n      remember: true,\n      autoLogin: true,\n      isAutoLogin: false,\n      isMobile: false,\n      checked: true,\n      code: {\n        src: '/code',\n        value: '',\n        len: 4,\n        type: 'image'\n      },\n      rules: {\n        username: [{\n          required: true,\n          message: '请输入用户名',\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: '请输入密码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          message: '密码长度最少为6位',\n          trigger: 'blur'\n        }],\n        code: [{\n          required: true,\n          message: '请输入验证码',\n          trigger: 'blur'\n        }, {\n          min: 4,\n          max: 4,\n          message: '验证码长度为4位',\n          trigger: 'blur'\n        }]\n      },\n      isShowPwd: false,\n      // 是否显示密码\n      loading: false,\n      // 登录loading\n      showDialog: false,\n      // 显示dialog\n      redirect: null,\n      // 回调地址\n      codeUrl: codeUrl\n    };\n  },\n  created: function created() {\n    // 将参数拷贝进查询对象\n    var query = this.$route.query;\n\n    if (query.redirect) {\n      // URL Encode\n      this.redirect = decodeURIComponent(query.redirect);\n    } //this._isMobile();\n    // let ddmsusername = this.getCookie(\"ddmsusername\");\n    // let ddmspassword = Base64.decode(this.getCookie(\"ddmspassword\"));\n\n\n    var ddmsusername = window.localStorage.getItem('ddmsusername');\n    var ddmspassword = Base64.decode(window.localStorage.getItem('ddmspassword'));\n\n    if (ddmsusername) {\n      this.ruleForm.username = ddmsusername;\n      this.ruleForm.password = ddmspassword;\n    }\n\n    this.refreshCode(ddmsusername); //alert(this.getCode().code);\n  },\n  methods: {\n    changeImgCode: function changeImgCode() {\n      this.refreshCode();\n    },\n    isRemember: function isRemember(val) {\n      console.log(val);\n\n      if (!val) {\n        this.autoLogin = false;\n        this.isAutoLogin = true;\n      } else {\n        this.autoLogin = true;\n        this.isAutoLogin = false;\n      }\n    },\n    refreshCode: function refreshCode(ddmsusername) {\n      this.ruleForm.code = '';\n      this.ruleForm.randomStr = randomLenNum(this.code.len, true);\n\n      if (ddmsusername) {\n        this.code.type = 'text';\n      }\n\n      this.code.type === 'text' ? this.code.value = randomLenNum(this.code.len) : this.code.src = \"\".concat(this.codeUrl, \"?randomStr=\").concat(this.ruleForm.randomStr);\n      this.ruleForm.code = this.code.value; //let ddmsAutoLogin = this.getCookie(\"ddmsAutoLogin\");\n\n      var ddmsAutoLogin = window.localStorage.getItem('ddmsAutoLogin');\n\n      if (ddmsAutoLogin) {\n        this.login();\n      }\n    },\n    handleLogin: function handleLogin() {\n      var _this = this;\n\n      this.$refs[\"ruleForm\"].validate(function (valid) {\n        if (valid) {\n          _this.login();\n        } else {\n          return false;\n        }\n      });\n    },\n    login: function login() {\n      var _this2 = this;\n\n      this.loading = true;\n      this.$store.dispatch('loginName', this.ruleForm).then(function (response) {\n        console.log(response);\n        _this2.loading = false; // if (response.code) {\n        //     this.$message.error(response.message);\n        //     return;\n        // }\n        // 储存登录信息\n\n        _this2.setUserInfo();\n\n        var path = '/'; // if (this.redirect) {\n        //     path = this.redirect;\n        // }\n\n        _this2.$router.push({\n          path: path\n        }); //console.log(path)\n        //window.location.replace(path);\n        // this.showDialog = true\n\n      }).catch(function () {\n        _this2.loading = false;\n      });\n    },\n    wxLogin: function wxLogin() {\n      // if(this._isMobile()){\n      //     console.log(\"m\")\n      // }else {\n      //     console.log(\"pc\")\n      // }\n      // let appid, client_id, redirect_uri, url\n      // redirect_uri = encodeURIComponent(window.location.origin + '/#/authredirect')\n      //\n      // appid = 'wxd1678d3f83b1d83a'\n      // url = 'https://open.weixin.qq.com/connect/qrconnect?appid=' + appid + '&redirect_uri=' + redirect_uri + '&state=WX-BIND&response_type=code&scope=snsapi_login#wechat_redirect'\n      var url = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxce4bd89765319e92&redirect_uri=http%3A%2F%2Foa.dreamdeck.cn%2F#%2Flogin&response_type=code&scope=snsapi_userinfo&state=123#wechat_redirect';\n      window.location.href = url;\n    },\n    _isMobile: function _isMobile() {\n      var flag = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);\n\n      if (flag) {\n        this.isMobile = true;\n      }\n\n      return flag;\n    },\n    getCode: function getCode() {\n      var href = location.href;\n\n      if (href.indexOf('?') != -1) {\n        var search = href.split('?')[1].split('&'),\n            data = {};\n\n        for (var i = 0; i < search.length; i++) {\n          var item = search[i].split('=');\n          data[item[0]] = item[1];\n        }\n\n        return data;\n      } else {\n        return {};\n      }\n    },\n    // 储存表单信息\n    setUserInfo: function setUserInfo() {\n      // 判断用户是否勾选记住密码，如果勾选，向cookie中储存登录信息，\n      // 如果没有勾选，储存的信息为空\n      if (this.remember) {\n        window.localStorage.setItem('ddmsusername', this.ruleForm.username); //this.setCookie(\"ddmsusername\",this.ruleForm.username)\n        // base64加密密码\n\n        var passWord = Base64.encode(this.ruleForm.password);\n        window.localStorage.setItem('ddmspassword', passWord); //this.setCookie(\"ddmspassword\",passWord)\n      } else {\n        window.localStorage.setItem('ddmsusername', '');\n        window.localStorage.setItem('ddmspassword', ''); //this.setCookie(\"ddmsusername\",\"\")\n        //this.setCookie(\"ddmspassword\",\"\")\n      } //this.setCookie(\"ddmsAutoLogin\",this.autoLogin)\n\n\n      window.localStorage.setItem('ddmsAutoLogin', this.autoLogin);\n    },\n    // 获取cookie\n    getCookie: function getCookie(key) {\n      if (document.cookie.length > 0) {\n        var start = document.cookie.indexOf(key + '=');\n\n        if (start !== -1) {\n          start = start + key.length + 1;\n          var end = document.cookie.indexOf(';', start);\n          if (end === -1) end = document.cookie.length;\n          return unescape(document.cookie.substring(start, end));\n        }\n      }\n\n      return '';\n    },\n    // 保存cookie\n    setCookie: function setCookie(cName, value, expiredays) {\n      var exdate = new Date();\n      exdate.setDate(exdate.getDate() + expiredays);\n      document.cookie = cName + '=' + decodeURIComponent(value) + (expiredays == null ? '' : ';expires=' + exdate.toGMTString());\n    }\n  }\n};",null]}