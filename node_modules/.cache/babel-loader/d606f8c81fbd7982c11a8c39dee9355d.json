{"remainingRequest":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js!D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js!D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\apply\\receipt\\Form.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\apply\\receipt\\Form.vue","mtime":1595384938769},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _defineProperty from \"D:\\\\DDMS\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.function.name\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { addObj, editObj } from \"../../../api/apply/receipt.js\";\nimport { getApplyUserInfo } from \"../../../api/admin/user.js\";\nimport { getItemVosWithUserId as _getItemVosWithUserId } from \"../../../api/project/team.js\";\nimport { getFirstpartyAll as _getFirstpartyAll } from \"../../../api/customer/firstparty.js\";\nimport { getStandardApplyInfoById } from \"../../../api/standard/apply.js\";\nimport { mapGetters } from 'vuex';\nexport default {\n  data: function data() {\n    return {\n      query: {\n        itemId: null,\n        userId: null,\n        deptId: null,\n        type: 8\n      },\n      formData: {\n        newData: true,\n        receiptId: null,\n        itemId: null,\n        companyId: null,\n        userId: null,\n        type: '2',\n        firstPartyId: null,\n        name: '',\n        dutyParagraph: '',\n        address: '',\n        telephone: '',\n        bankName: '',\n        bankAccount: '',\n        proportion: '',\n        priceYuan: '',\n        content: '11',\n        remark: '',\n        detailedList: '',\n        isAffirm: '1'\n      },\n      uploadUrl: '',\n      rules: {\n        itemId: [{\n          required: true,\n          message: '请选择开票项目',\n          trigger: 'change'\n        }],\n        companyId: [{\n          required: true,\n          message: '请选择开票公司',\n          trigger: 'change'\n        }],\n        type: [{\n          required: true,\n          message: '请选择开票类型',\n          trigger: 'change'\n        }],\n        name: [{\n          required: true,\n          message: '请填写公司名称'\n        }],\n        dutyParagraph: [{\n          required: true,\n          message: '请填写公司税号'\n        }],\n        address: [{\n          required: true,\n          message: '请填写公司注册地址'\n        }],\n        telephone: [{\n          required: true,\n          message: '请填写公司电话'\n        }],\n        bankName: [{\n          required: true,\n          message: '请填写开户行名称'\n        }],\n        bankAccount: [{\n          required: true,\n          message: '请填写开户行账号'\n        }],\n        proportion: [{\n          required: true,\n          message: '请填写开票百分比'\n        }],\n        priceYuan: [{\n          required: true,\n          message: '请填写开票金额'\n        }],\n        content: [{\n          required: true,\n          message: '请选择开票内容',\n          trigger: 'blur'\n        }],\n        remark: [{\n          required: true,\n          message: '请选择发票备注',\n          trigger: 'blur'\n        }],\n        detailedList: [{\n          required: true,\n          message: '请上传产品清单',\n          trigger: 'blur'\n        }],\n        isAffirm: [{\n          required: true,\n          message: '请选择是否与对方确认',\n          trigger: 'blur'\n        }]\n      },\n      type1Visible: false,\n      itemOptions: [],\n      companyOptions: [{\n        label: '北京甲板智慧科技有限公司',\n        value: 1\n      }, {\n        label: '北京甲板数字科技有限公司',\n        value: 2\n      }],\n      firstPartyList: [],\n      firstPartyOptions: [],\n      saving: false,\n      applyUserList: []\n    };\n  },\n  created: function created() {\n    this.getStandardApplyInfo();\n    this.getApplyUser(this.userId);\n    this.getItemVosWithUserId(this.userId);\n    this.getFirstpartyAll();\n    this.formData.userId = this.userId;\n    this.query.userId = this.userId;\n    this.uploadUrl = \"\".concat(window.location.origin, \"/apply/receipt/upload\");\n    var editReceiptInfo = JSON.parse(window.localStorage.getItem('editReceiptInfo'));\n\n    if (editReceiptInfo) {\n      console.log(editReceiptInfo);\n      this.formData.newData = false;\n      this.formData.receiptId = editReceiptInfo.receiptId;\n      this.formData.itemId = editReceiptInfo.itemId;\n\n      if (this.formData.itemId) {\n        this.selectItem(this.formData.itemId);\n      }\n\n      this.formData.companyId = editReceiptInfo.companyId;\n      this.formData.type = editReceiptInfo.type;\n      this.formData.firstPartyId = editReceiptInfo.firstPartyId;\n      this.formData.name = editReceiptInfo.name;\n      this.formData.dutyParagraph = editReceiptInfo.dutyParagraph;\n      this.formData.address = editReceiptInfo.address;\n      this.formData.telephone = editReceiptInfo.telephone;\n      this.formData.bankName = editReceiptInfo.bankName;\n      this.formData.bankAccount = editReceiptInfo.bankAccount;\n      this.formData.proportion = editReceiptInfo.proportion;\n      this.formData.priceYuan = editReceiptInfo.priceYuan;\n      this.formData.content = editReceiptInfo.content;\n      this.formData.remark = editReceiptInfo.remark; //this.formData.detailedList = editReceiptInfo.detailedList;\n\n      this.formData.isAffirm = editReceiptInfo.isAffirm;\n    }\n  },\n  computed: _objectSpread({}, mapGetters(['permissions', 'userId'])),\n  methods: {\n    selectItem: function selectItem(val) {\n      if (val == null || val == '') {\n        this.query.itemId = null;\n        this.formData.itemId = null;\n        this.getApplyUser();\n      } else {\n        this.query.itemId = val;\n        this.formData.itemId = val;\n        this.getApplyUser();\n      }\n    },\n    getApplyUser: function getApplyUser() {\n      var _this = this;\n\n      getApplyUserInfo(this.query).then(function (response) {\n        _this.applyUserList = [];\n        _this.formData.approverids = null;\n        response.data.data.forEach(function (element) {\n          if (element != null) {\n            _this.applyUserList.push({\n              userId: element.userId,\n              username: element.username,\n              avatar: element.avatar\n            });\n\n            if (_this.formData.approverids == null) {\n              _this.formData.approverids += element.userId;\n            } else {\n              _this.formData.approverids += ',' + element.userId;\n            }\n          }\n        });\n      });\n    },\n    getItemVosWithUserId: function getItemVosWithUserId(userId) {\n      var _this2 = this;\n\n      _getItemVosWithUserId(userId).then(function (response) {\n        console.log(response);\n        response.data.data.forEach(function (element) {\n          _this2.itemOptions.push({\n            value: element.itemId,\n            label: element.alias\n          });\n        });\n      });\n    },\n    getFirstpartyAll: function getFirstpartyAll() {\n      var _this3 = this;\n\n      _getFirstpartyAll().then(function (response) {\n        _this3.firstPartyList = response.data.data;\n        response.data.data.forEach(function (element) {\n          _this3.firstPartyOptions.push({\n            firstPartyId: element.firstPartyId,\n            name: element.name\n          });\n        });\n      });\n    },\n    selectFirstParty: function selectFirstParty(val) {\n      var that = this;\n      this.firstPartyList.forEach(function (element) {\n        if (element.firstPartyId == val) {\n          that.formData.name = element.name;\n          that.formData.dutyParagraph = element.dutyParagraph;\n          that.formData.address = element.address;\n          that.formData.telephone = element.telephone;\n          that.formData.bankName = element.bankName;\n          that.formData.bankAccount = element.bankAccount;\n        }\n      });\n    },\n    backHistory: function backHistory() {\n      window.localStorage.removeItem('editReceiptInfo');\n      this.formData.newData = true;\n      this.formData.receiptId = null;\n      this.formData.itemId = null;\n      this.formData.companyId = null;\n      this.formData.userId = null;\n      this.formData.type = '2';\n      this.formData.firstPartyId = null;\n      this.formData.name = '';\n      this.formData.dutyParagraph = '';\n      this.formData.address = '';\n      this.formData.telephone = '';\n      this.formData.bankName = '';\n      this.formData.bankAccount = '';\n      this.formData.proportion = '';\n      this.formData.priceYuan = '';\n      this.formData.content = '11';\n      this.formData.remark = '';\n      this.formData.detailedList = '';\n      this.formData.isAffirm = '1';\n      this.$router.go(-1);\n    },\n    onSubmit: function onSubmit() {\n      var _this4 = this;\n\n      this.$refs['formData'].validate(function (valid) {\n        if (valid) {\n          _this4.saving = true;\n\n          if (!_this4.formData.newData) {\n            _this4.formData.status = 0;\n            editObj(_this4.formData).then(function (res) {\n              if (res.data.data) {\n                _this4.backHistory();\n              }\n            }).finally(function () {\n              _this4.saving = false;\n            });\n          } else {\n            addObj(_this4.formData).then(function (res) {\n              if (res.data.data) {\n                _this4.backHistory();\n              }\n            }).finally(function () {\n              _this4.saving = false;\n            });\n          }\n        }\n      });\n    },\n    getStandardApplyInfo: function getStandardApplyInfo() {\n      var _this5 = this;\n\n      getStandardApplyInfoById(8).then(function (response) {\n        if (response.data.data) {\n          var data = response.data.data;\n          _this5.content = data.content;\n          var receiptStandardApply = JSON.parse(window.localStorage.getItem('receiptStandardApply'));\n\n          if (receiptStandardApply) {\n            if (receiptStandardApply.version < data.version) {\n              _this5.open();\n            }\n          } else {\n            _this5.open();\n          }\n\n          window.localStorage.setItem('receiptStandardApply', JSON.stringify(data));\n        }\n      });\n    },\n    open: function open() {\n      var content = this.content.split('\\n\\n');\n      var newDatas = [];\n      var h = this.$createElement;\n\n      for (var i in content) {\n        newDatas.push(h('p', null, content[i]));\n      }\n\n      this.$alert(h('div', null, newDatas), '开票规范');\n    },\n\n    /**\n     * 产品清单模板下载\n     */\n    templateDownload: function templateDownload() {\n      //this.$refs.upload.submit();\n      window.location.href = 'http://192.168.1.88/receipt-temp.xlsx';\n    },\n    handleRemove: function handleRemove(file, fileList) {\n      console.log(file, fileList);\n      this.formData.detailedList = '';\n    },\n    handlePreview: function handlePreview(file) {\n      console.log(file);\n    },\n    handSuccess: function handSuccess(data) {\n      var fileInfo = data.data;\n      var fileUrl = fileInfo.bucketName + '-' + fileInfo.fileName;\n      console.log(fileUrl);\n      this.formData.detailedList = fileUrl;\n    }\n  },\n  mounted: function mounted() {}\n};",null]}