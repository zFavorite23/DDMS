{"remainingRequest":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js!D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js!D:\\DDMS\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\DDMS\\src\\store\\modules\\admin.js","dependencies":[{"path":"D:\\DDMS\\src\\store\\modules\\admin.js","mtime":1588235430033},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _defineProperty from \"D:\\\\DDMS\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\n\nvar _mutations;\n\nimport { userInfo as _userInfo, loginName as _loginName, logout } from \"../../api/auth/login\";\nimport { getMenuList } from \"../../api/admin/user\";\nimport * as types from \"../mutation-types\";\nimport { encryption } from \"../../utils/utils\";\nimport { constantRouterMap } from \"../../router\";\nimport { getToken, setToken, removeToken, getUserId, setUserId, removeUserId } from \"../../utils/auth\"; // import { $NOT_NETWORK } from '../../utils/errorCode'\n\nimport { Message } from \"element-ui\"; // initial state\n\nvar state = {\n  userId: getUserId(),\n  // id\n  deptId: \"\",\n  // id\n  companyId: null,\n  // id\n  userName: \"\",\n  // 昵称\n  avatar: \"\",\n  // 头像\n  token: getToken(),\n  // 登录token\n  authRules: [],\n  // 权限列表\n  permissions: [],\n  // 权限列表\n  routers: constantRouterMap // 路由列表\n\n}; // getters\n\nvar getters = {\n  userId: function userId(state) {\n    return state.userId;\n  },\n  deptId: function deptId(state) {\n    return state.deptId;\n  },\n  companyId: function companyId(state) {\n    return state.companyId;\n  },\n  userName: function userName(state) {\n    return state.userName;\n  },\n  avatar: function avatar(state) {\n    return state.avatar;\n  },\n  token: function token(state) {\n    return state.token;\n  },\n  authRules: function authRules(state) {\n    return state.authRules;\n  },\n  permissions: function permissions(state) {\n    return state.permissions;\n  },\n  routers: function routers(state) {\n    return state.routers;\n  }\n}; // actions\n\nvar actions = {\n  // 用户名登录\n  loginName: function loginName(_ref, userInfo) {\n    var commit = _ref.commit;\n    var user = encryption({\n      data: userInfo,\n      key: \"dddddddddddddddd\",\n      param: [\"password\"]\n    }); // const userName = userInfo.userName ? userInfo.userName.trim() : \"\";\n    // const pwd = userInfo.pwd ? userInfo.pwd : \"\";\n\n    return new Promise(function (resolve, reject) {\n      _loginName(user.username, user.password, user.code, user.randomStr).then(function (response) {\n        var data = response.data || {};\n        commit(types.RECEIVE_USER_ID, data.user_id);\n        commit(types.RECEIVE_ADMIN_TOKEN, data.access_token);\n        commit(types.RECEIVE_ADMIN_AUTH_RULES, []);\n        resolve(response);\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  userInfo: function userInfo(_ref2) {\n    var commit = _ref2.commit;\n    return new Promise(function (resolve, reject) {\n      _userInfo().then(function (response) {\n        // if (response.code === 2) {\n        //     reject(\"登录失效\");\n        // }\n        var data = response.data || {};\n        commit(types.RECEIVE_ADMIN_COMPANY, data.data.sysUser.companyId);\n        commit(types.RECEIVE_ADMIN_DEPT, data.data.sysUser.deptId);\n        commit(types.RECEIVE_ADMIN_NAME, data.data.sysUser.username);\n        commit(types.RECEIVE_ADMIN_AVATAR, data.data.sysUser.avatar);\n        commit(types.RECEIVE_ADMIN_AUTH_RULES, data.data.roles);\n        commit(types.RECEIVE_ADMIN_PERMISSIONS, data.data.permissions);\n        resolve(data.data);\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 登出\n  loginOut: function loginOut(_ref3) {\n    var commit = _ref3.commit;\n    return new Promise(function (resolve, reject) {\n      logout().then(function () {\n        commit(types.RECEIVE_USER_ID, \"\");\n        commit(types.RECEIVE_ADMIN_TOKEN, \"\");\n        commit(types.RECEIVE_ADMIN_AUTH_RULES, []);\n        resolve();\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  // 前端 登出\n  fedLogout: function fedLogout(_ref4) {\n    var commit = _ref4.commit;\n    return new Promise(function (resolve) {\n      commit(types.RECEIVE_USER_ID, \"\");\n      commit(types.RECEIVE_ADMIN_TOKEN, \"\");\n      commit(types.RECEIVE_ADMIN_AUTH_RULES, []);\n      resolve();\n    });\n  },\n\n  /**\r\n   * 过滤路由列表\r\n   * @param commit\r\n   * @param data\r\n   * @returns {Promise}\r\n   */\n  filterRouter: function filterRouter(_ref5) {\n    var commit = _ref5.commit;\n    //console.info(data)\n    return new Promise(function (resolve) {\n      getMenuList().then(function (response) {\n        var accessedRouters = response.data.data;\n\n        if (accessedRouters && accessedRouters.length > 0) {\n          commit(types.RECEIVE_ROUTERS, accessedRouters);\n          resolve(accessedRouters);\n        }\n      }).catch(function (error) {\n        console.log(error);\n      }); // console.log(data)\n      // const { accessedRouters } = data;\n      // console.log(accessedRouters)\n      // if (accessedRouters && accessedRouters.length > 0) {\n      //     commit(types.RECEIVE_ROUTERS, accessedRouters);\n      // }\n    });\n  }\n}; // mutations\n\nvar mutations = (_mutations = {}, _defineProperty(_mutations, types.RECEIVE_USER_ID, function (state, userId) {\n  state.userId = userId;\n\n  if (userId === \"\") {\n    removeUserId();\n  } else {\n    setUserId(userId);\n  }\n}), _defineProperty(_mutations, types.RECEIVE_ADMIN_TOKEN, function (state, token) {\n  state.token = token;\n\n  if (token === \"\") {\n    removeToken();\n  } else {\n    setToken(token);\n  }\n}), _defineProperty(_mutations, types.RECEIVE_ADMIN_DEPT, function (state, deptId) {\n  state.deptId = deptId;\n}), _defineProperty(_mutations, types.RECEIVE_ADMIN_COMPANY, function (state, companyId) {\n  state.companyId = companyId;\n}), _defineProperty(_mutations, types.RECEIVE_ADMIN_NAME, function (state, userName) {\n  state.userName = userName;\n}), _defineProperty(_mutations, types.RECEIVE_ADMIN_AVATAR, function (state, avatar) {\n  state.avatar = avatar;\n}), _defineProperty(_mutations, types.RECEIVE_ADMIN_AUTH_RULES, function (state, authRules) {\n  state.authRules = authRules;\n}), _defineProperty(_mutations, types.RECEIVE_ADMIN_PERMISSIONS, function (state, permissions) {\n  var list = {};\n\n  for (var i = 0; i < permissions.length; i++) {\n    list[permissions[i]] = true;\n  }\n\n  state.permissions = list;\n}), _defineProperty(_mutations, types.RECEIVE_ROUTERS, function (state, routers) {\n  var tempRm = constantRouterMap.concat(routers);\n  state.routers = JSON.parse(JSON.stringify(tempRm)); //console.log(state.routers)\n}), _mutations);\nexport default {\n  state: state,\n  getters: getters,\n  actions: actions,\n  mutations: mutations\n};",null]}