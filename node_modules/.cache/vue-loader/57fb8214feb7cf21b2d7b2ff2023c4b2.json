{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\apply\\leave\\Form.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\apply\\leave\\Form.vue","mtime":1591155833357},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { addObj, editObj } from '../../../api/apply/leave.js';\r\nimport { getApplyUserInfo } from '../../../api/admin/user.js';\r\nimport { getItemVosWithUserId } from '../../../api/project/team.js';\r\nimport { getStandardApplyInfoById } from '../../../api/standard/apply.js';\r\nimport { getVacationByUserId } from '../../../api/checkwork/vacation.js';\r\nimport { getRestByUse } from '../../../api/checkwork/rest.js';\r\nimport { mapGetters } from 'vuex';\r\nexport default {\r\n    data() {\r\n        return {\r\n            query: {\r\n                itemId: null,\r\n                userId: null,\r\n                deptId: null,\r\n                type: 4\r\n            },\r\n            labelPosition: 'right',\r\n            formData: {\r\n                newData: true,\r\n                leaveId: null,\r\n                itemId: null,\r\n                userId: '',\r\n                type: '1',\r\n                start: '',\r\n                end: '',\r\n                time: '',\r\n                reason: '',\r\n                proveImg: '',\r\n                restIdList: '',\r\n                restList: '',\r\n                clockList: '',\r\n                approverids: ''\r\n                // sat:\"\"\r\n            },\r\n            timeValue: '',\r\n            uploadUrl: '',\r\n            itemOptions: [\r\n                {\r\n                    value: null,\r\n                    label: '与项目无关'\r\n                }\r\n            ],\r\n            timeOptions: [],\r\n            vacationInfo: null,\r\n            restInfo: null,\r\n            restOptions: [],\r\n            typeOptions: [\r\n                {\r\n                    value: '1',\r\n                    label: '事假'\r\n                },\r\n                {\r\n                    value: '2',\r\n                    label: '病假'\r\n                },\r\n                {\r\n                    value: '3',\r\n                    label: '年假'\r\n                },\r\n                {\r\n                    value: '4',\r\n                    label: '调休'\r\n                },\r\n                {\r\n                    value: '5',\r\n                    label: '婚假'\r\n                },\r\n                {\r\n                    value: '6',\r\n                    label: '产假'\r\n                },\r\n                {\r\n                    value: '7',\r\n                    label: '陪产假'\r\n                },\r\n                {\r\n                    value: '8',\r\n                    label: '丧假'\r\n                },\r\n                {\r\n                    value: '9',\r\n                    label: '周六妈妈带娃'\r\n                },\r\n                {\r\n                    value: '10',\r\n                    label: '周六培训学习'\r\n                }\r\n            ],\r\n            rules: {\r\n                type: [\r\n                    {\r\n                        required: true,\r\n                        message: '请选择请假类型',\r\n                        trigger: 'change'\r\n                    }\r\n                ],\r\n                start: [{ required: true, message: '请选择时间', trigger: 'change' }],\r\n                end: [{ required: true, message: '请选择时间', trigger: 'change' }],\r\n                time: [{ required: true, message: '请选择时间' }],\r\n                reason: [{ required: true, message: '请填写请假事由' }],\r\n                proveImg: [\r\n                    {\r\n                        required: true,\r\n                        message: '请上传证明图片',\r\n                        trigger: 'change'\r\n                    }\r\n                ]\r\n            },\r\n            saving: false,\r\n            applyUserList: [],\r\n            pickerOptions1: {\r\n                disabledDate: this.disabledDate\r\n            },\r\n            pickerOptions2: {\r\n                disabledDate: this.disabledDate\r\n            },\r\n            pickerOptions3: {\r\n                disabledDate: this.disabledDate\r\n            },\r\n            pickerOptions4: {\r\n                disabledDate: this.disabledDate\r\n            },\r\n            pickerOptions5: {\r\n                disabledDate: this.disabledDate1\r\n            },\r\n            pickerOptions6: {\r\n                disabledDate: this.disabledDate1\r\n            },\r\n            pickerOptions7: {\r\n                disabledDate: this.disabledDate2\r\n            },\r\n            pickerOptions8: {\r\n                disabledDate: this.disabledDate2\r\n            },\r\n            pickerOptions9: {\r\n                disabledDate: this.disabledDate3\r\n            },\r\n            pickerOptions10: {\r\n                disabledDate: this.disabledDate4\r\n            },\r\n            pickerOptions11: {\r\n                disabledDate: this.disabledDate4\r\n            },\r\n\r\n            startDate: '',\r\n            endDate: '',\r\n            dataList: []\r\n        };\r\n    },\r\n    created() {\r\n        this.getStandardApplyInfo();\r\n        this.getApplyUser(this.userId);\r\n        this.getItemVosWithUserId(this.userId);\r\n\r\n        this.getVacationByUserId(this.userId);\r\n        this.getRestByUserId(this.userId);\r\n\r\n        this.formData.userId = this.userId;\r\n        this.query.userId = this.userId;\r\n\r\n        this.uploadUrl = `${window.location.origin}/apply/leave/upload`;\r\n        const editLeaveInfo = JSON.parse(window.localStorage.getItem('editLeaveInfo'));\r\n\r\n        console.log(editLeaveInfo);\r\n        if (editLeaveInfo) {\r\n            this.formData.newData = false;\r\n            this.formData.leaveId = editLeaveInfo.leaveId;\r\n            this.formData.itemId = editLeaveInfo.itemId;\r\n            this.formData.type = editLeaveInfo.type;\r\n            this.formData.start = editLeaveInfo.start;\r\n            this.formData.end = editLeaveInfo.end;\r\n            this.formData.time = editLeaveInfo.time;\r\n            this.timeValue = editLeaveInfo.time + ' 天';\r\n            this.formData.reason = editLeaveInfo.reason;\r\n        } else {\r\n            this.applyClockInfo = JSON.parse(window.localStorage.getItem('applyClockInfo'));\r\n            if (this.applyClockInfo) {\r\n                this.formData.type = '1';\r\n\r\n                this.formData.end = this.applyClockInfo.day;\r\n                if (this.applyClockInfo.type == 1) {\r\n                    this.formData.start = this.applyClockInfo.day + ' 09:30:00';\r\n                    this.formData.end = this.applyClockInfo.day + ' 12:00:00';\r\n                    this.formData.time = 2.5;\r\n                    this.timeValue = '2.5小时';\r\n                }\r\n                if (this.applyClockInfo.type == 2) {\r\n                    this.formData.start = this.applyClockInfo.day + ' 14:00:00';\r\n                    this.formData.end = this.applyClockInfo.day + ' 18:30:00';\r\n                    this.formData.time = 4.5;\r\n                    this.timeValue = '4.5小时';\r\n                }\r\n\r\n                this.formData.clockList = JSON.stringify(this.applyClockInfo);\r\n            }\r\n        }\r\n        //    年假\r\n        this.vacation();\r\n    },\r\n    computed: {\r\n        ...mapGetters(['permissions', 'userId'])\r\n    },\r\n    methods: {\r\n        getApplyUser() {\r\n            getApplyUserInfo(this.query).then(response => {\r\n                this.applyUserList = [];\r\n                this.formData.approverids = null;\r\n                response.data.data.forEach(element => {\r\n                    this.applyUserList.push({\r\n                        userId: element.userId,\r\n                        username: element.username,\r\n                        avatar: element.avatar\r\n                    });\r\n                    if (this.formData.approverids == null) {\r\n                        this.formData.approverids += element.userId;\r\n                    } else {\r\n                        this.formData.approverids += ',' + element.userId;\r\n                    }\r\n                });\r\n            });\r\n        },\r\n        getItemVosWithUserId(userId) {\r\n            getItemVosWithUserId(userId).then(response => {\r\n                response.data.data.forEach(element => {\r\n                    this.itemOptions.push({\r\n                        value: element.itemId,\r\n                        label: element.alias\r\n                    });\r\n                });\r\n            });\r\n        },\r\n        getVacationByUserId(userId) {\r\n            getVacationByUserId(userId).then(response => {\r\n                this.vacationInfo = response.data.data;\r\n                if (this.vacationInfo) {\r\n                    if (this.vacationInfo.thingNum > 0) {\r\n                        this.typeOptions[0].label = '事假（' + this.vacationInfo.thingNum + '小时）';\r\n                    } else {\r\n                        this.typeOptions[0].label = '事假（0小时）';\r\n                        this.typeOptions[0].disabled = true;\r\n                    }\r\n\r\n                    if (this.vacationInfo.annualNum > 0) {\r\n                        this.typeOptions[2].label = '年假（' + this.vacationInfo.annualNum + '天）';\r\n                    } else {\r\n                        this.typeOptions[2].label = '年假（0天）';\r\n                        this.typeOptions[2].disabled = true;\r\n                    }\r\n                } else {\r\n                    this.typeOptions[0].label = '事假（0小时）';\r\n                    this.typeOptions[0].disabled = true;\r\n                    this.typeOptions[2].label = '年假（0天）';\r\n                    this.typeOptions[2].disabled = true;\r\n                    this.formData.type = '2';\r\n                }\r\n            });\r\n        },\r\n        getRestByUserId(userId) {\r\n            getRestByUse(userId).then(response => {\r\n                console.log(response);\r\n                this.restInfo = response.data.data;\r\n                this.restInfo.forEach(element => {\r\n                    this.restOptions.push({\r\n                        value: element.restId,\r\n                        label: element.day\r\n                    });\r\n                });\r\n                if (this.restInfo.length > 0) {\r\n                    this.typeOptions[3].label = '调休（' + this.restInfo.length + '天）';\r\n                } else {\r\n                    this.typeOptions[3].label = '调休（0天）';\r\n                    this.typeOptions[3].disabled = true;\r\n                }\r\n            });\r\n        },\r\n        disabledDate(time) {\r\n            if (!this.formData.start && !this.formData.end) {\r\n                return time.getTime() < Date.now() - 8 * 24 * 3600 * 1000 || time.getTime() > Date.now() + 7 * 24 * 3600 * 1000;\r\n            }\r\n            if (this.formData.type == 1 || this.formData.type == 3) {\r\n                if (this.formData.start && !this.formData.end) {\r\n                    return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > Date.now() + this.vacationInfo.annualNum * 24 * 3600 * 1000;\r\n                }\r\n            }\r\n            if (this.formData.type == 2) {\r\n                return time.getTime() < Date.now() - 7 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n\r\n            if (!this.formData.start && this.formData.end) {\r\n                return time.getTime() < Date.now() - 7 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n\r\n            if (this.formData.start && this.formData.end) {\r\n                return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n        },\r\n        // 年假\r\n        disabledDate1(time) {\r\n            if (!this.formData.start && !this.formData.end) {\r\n                return time.getTime() < Date.now() - 8 * 24 * 3600 * 1000 || time.getTime() > Date.now() + 7 * 24 * 3600 * 1000;\r\n            }\r\n            if (this.formData.start && !this.formData.end) {\r\n                return (\r\n                    time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 ||\r\n                    time.getTime() > Date.parse(this.formData.start) + (this.vacationInfo.annualNum - 1) * 24 * 3600 * 1000\r\n                );\r\n            }\r\n            if (!this.formData.start && this.formData.end) {\r\n                return time.getTime() < Date.parse(this.formData.end) - this.vacationInfo.annualNum * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n            if (this.formData.start && this.formData.end) {\r\n                return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n        },\r\n        //调休\r\n        disabledDate2(time) {\r\n            if (!this.formData.start && !this.formData.end) {\r\n                return time.getTime() < Date.now() - 8 * 24 * 3600 * 1000 || time.getTime() > Date.now() + 7 * 24 * 3600 * 1000;\r\n            }\r\n            if (this.formData.start && !this.formData.end) {\r\n                return (\r\n                    time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 ||\r\n                    time.getTime() > Date.parse(this.formData.start) + (this.formData.time - 1) * 24 * 3600 * 1000\r\n                );\r\n            }\r\n            if (!this.formData.start && this.formData.end) {\r\n                return time.getTime() < Date.parse(this.formData.end) - this.formData.time * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n            if (this.formData.start && this.formData.end) {\r\n                return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n        },\r\n        //周六\r\n        disabledDate3(time) {\r\n            switch (new Date().getDay()) {\r\n                case 0:\r\n                    return (\r\n                        time.getTime() < Date.now() - (0 + 7) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (0 + 6) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (0 + 7) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (0 + 8) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 1:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 2) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 1) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (1 + 3) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 + 4) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 2:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 3) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 2) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (1 + 2) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 + 3) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 3:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 4) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 3) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (1 + 1) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 + 2) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 4:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 5) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 4) * 24 * 3600 * 1000 && time.getTime() < Date.now() + 1 * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 + 1) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 5:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 6) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 5) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (1 - 1) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 + 0) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 6:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 7) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 6) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (1 - 2) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 - 1) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n            }\r\n        },\r\n\r\n        //事假\r\n        disabledDate4(time) {\r\n            var day = Math.ceil(this.vacationInfo.thingNum / 9);\r\n            if (!this.formData.start && !this.formData.end) {\r\n                return time.getTime() < Date.now() - 8 * 24 * 3600 * 1000 || time.getTime() > Date.now() + 7 * 24 * 3600 * 1000;\r\n            }\r\n            if (this.formData.start && !this.formData.end) {\r\n                return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > Date.parse(this.formData.start) + (day - 1) * 24 * 3600 * 1000;\r\n            }\r\n            if (!this.formData.start && this.formData.end) {\r\n                return time.getTime() < Date.parse(this.formData.end) - day * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n            if (this.formData.start && this.formData.end) {\r\n                return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n        },\r\n\r\n        chooseSat() {\r\n            this.formData.time = 1;\r\n            this.timeValue = this.formData.time + ' 天';\r\n        },\r\n        selectStart(val) {\r\n            if (this.formData.start && this.formData.end) {\r\n                const days = this.DateDiff(this.formData.start, this.formData.end);\r\n                console.log(days);\r\n                this.formData.time = days + 1;\r\n                this.timeValue = this.formData.time + ' 天';\r\n            }\r\n        },\r\n        selectEnd(val) {\r\n            console.log(val);\r\n            if (this.formData.start && this.formData.end) {\r\n                const days = this.DateDiff(this.formData.start, this.formData.end);\r\n                console.log(days);\r\n                this.formData.time = days + 1;\r\n                this.timeValue = this.formData.time + ' 天';\r\n            }\r\n        },\r\n        DateDiff(sDate1, sDate2) {\r\n            var aDate, oDate1, oDate2, iDays;\r\n            aDate = sDate1.split('-');\r\n            oDate1 = new Date(aDate[0], aDate[1], aDate[2]); //转换为12-18-2006格式\r\n            aDate = sDate2.split('-');\r\n            oDate2 = new Date(aDate[0], aDate[1], aDate[2]);\r\n            iDays = parseInt(Math.abs(oDate2 - oDate1) / 1000 / 60 / 60 / 24); //把相差的毫秒数转换为天数\r\n            return iDays;\r\n        },\r\n        chooseStart(val) {\r\n            console.log(val);\r\n            if (this.formData.start && this.formData.end) {\r\n                const hours = this.chooseDiff(this.formData.start, this.formData.end);\r\n                this.formData.time = hours;\r\n                this.timeValue = this.formData.time + ' 小时';\r\n                console.log(hours);\r\n                console.log(this.formData.time);\r\n            }\r\n        },\r\n        chooseEnd(val) {\r\n            console.log(val);\r\n            if (this.formData.start && this.formData.end) {\r\n                const hours = this.chooseDiff(this.formData.start, this.formData.end);\r\n                this.formData.time = hours;\r\n                this.timeValue = this.formData.time + ' 小时';\r\n                console.log(hours);\r\n                console.log(this.formData.time);\r\n            }\r\n        },\r\n        chooseDiff(sDate1, sDate2) {\r\n            if ((sDate1 == sDate2) == true) {\r\n                var date = Date.parse(sDate2) - Date.parse(sDate1);\r\n                var iHours = Math.floor(date / (3600 * 1000));\r\n                return iHours;\r\n                console.log(hours);\r\n            } else if ((sDate1 == sDate2) == false) {\r\n                var date = Date.parse(sDate2) - Date.parse(sDate1);\r\n                var day = Math.floor(date / 3600 / 1000 / 24);\r\n\r\n                var iHours = Math.floor(date / (3600 * 1000));\r\n                var iHours = iHours - 15 * day;\r\n                return iHours;\r\n                console.log(hours);\r\n            }\r\n        },\r\n        selectLeaveType(val) {\r\n            this.formData.start = '';\r\n            this.formData.end = '';\r\n            this.formData.time = '';\r\n            this.timeValue = '';\r\n        },\r\n\r\n        selectRest(val) {\r\n            // console.log(val)\r\n            // console.log(this.formData.restIdList)\r\n            this.formData.restList = '';\r\n            val.forEach(element => {\r\n                this.formData.restList += element + ',';\r\n            });\r\n            this.formData.time = val.length;\r\n            this.timeValue = val.length + ' 天';\r\n        },\r\n        vacation() {},\r\n        backHistory() {\r\n            window.localStorage.removeItem('editLeaveInfo');\r\n            window.localStorage.removeItem('applyClockInfo');\r\n            this.formData.newData = true;\r\n            this.formData.leaveId = null;\r\n            this.formData.itemId = null;\r\n            this.formData.start = '';\r\n            this.formData.end = '';\r\n            this.formData.day = '';\r\n            this.formData.time = '';\r\n            this.timeValue = '';\r\n            this.formData.reason = '';\r\n            this.$router.go(-1);\r\n        },\r\n        onSubmit() {\r\n            if (this.formData.type == '9' || this.formData.type == '10') {\r\n                this.formData.end = this.formData.start;\r\n            }\r\n            this.$refs['formData'].validate(valid => {\r\n                if (valid) {\r\n                    this.saving = true;\r\n                    if (!this.formData.newData) {\r\n                        editObj(this.formData)\r\n                            .then(res => {\r\n                                if (res.data.data) {\r\n                                    this.backHistory();\r\n                                }\r\n                            })\r\n                            .finally(() => {\r\n                                this.saving = false;\r\n                            });\r\n                    } else {\r\n                        addObj(this.formData)\r\n                            .then(res => {\r\n                                if (res.data.data) {\r\n                                    this.backHistory();\r\n                                }\r\n                                this.$router.push('/apply/leave');\r\n                            })\r\n                            .finally(() => {\r\n                                this.saving = false;\r\n                            });\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        beforeAvatarUpload: function(file) {\r\n            const isJPG = file.type === 'image/jpeg';\r\n            const isPNG = file.type === 'image/png';\r\n            const isPG = isJPG || isPNG;\r\n            const isLt5M = file.size / 1024 / 1024 < 5;\r\n            if (!isPG) {\r\n                this.$message.error('上传图片只能是 JPG 或 PNG 格式!');\r\n            }\r\n            if (!isLt5M) {\r\n                this.$message.error('上传图片大小不能超过 5MB!');\r\n            }\r\n            return isPG && isLt5M;\r\n        },\r\n        handleRemove(data) {\r\n            const imgInfo = data.response.data;\r\n            const imgUrl = imgInfo.bucketName + '-' + imgInfo.fileName;\r\n            this.formData.proveImg = this.formData.proveImg.replace(imgUrl + ',', '');\r\n            console.log(this.formData.proveImg);\r\n        },\r\n        handlePreview(file) {\r\n            console.log(file);\r\n        },\r\n        handSuccess(data) {\r\n            const imgInfo = data.data;\r\n            const imgUrl = imgInfo.bucketName + '-' + imgInfo.fileName;\r\n            this.formData.proveImg += imgUrl + ',';\r\n        },\r\n        getStandardApplyInfo() {\r\n            getStandardApplyInfoById(4).then(response => {\r\n                if (response.data.data) {\r\n                    const data = response.data.data;\r\n                    this.content = data.content;\r\n                    const leaveStandardApply = JSON.parse(window.localStorage.getItem('leaveStandardApply'));\r\n                    if (leaveStandardApply) {\r\n                        if (leaveStandardApply.version < data.version) {\r\n                            this.open();\r\n                        }\r\n                    } else {\r\n                        this.open();\r\n                    }\r\n                    window.localStorage.setItem('leaveStandardApply', JSON.stringify(data));\r\n                }\r\n            });\r\n        },\r\n        open() {\r\n            let content = this.content.split('\\n\\n');\r\n            let newDatas = [];\r\n            const h = this.$createElement;\r\n            for (let i in content) {\r\n                newDatas.push(h('p', null, content[i]));\r\n            }\r\n            this.$alert(h('div', null, newDatas), '请假规范');\r\n        }\r\n    },\r\n    mounted() {}\r\n};\r\n",{"version":3,"sources":["Form.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Form.vue","sourceRoot":"src/views/apply/leave","sourcesContent":["<template>\r\n    <div>\r\n        <el-form label-position=\"right\" ref=\"formData\" :rules=\"rules\" :model=\"formData\" class=\"form\" :label-position=\"labelPosition\" label-width=\"100px\">\r\n            <el-form-item label=\"项目：\">\r\n                <el-select v-model=\"formData.itemId\" filterable placeholder=\"请选择\">\r\n                    <el-option v-for=\"(item, index) in itemOptions\" :value=\"item.value\" :key=\"index\" :label=\"item.label\"></el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"请假类型：\" prop=\"type\">\r\n                <el-select v-model=\"formData.type\" placeholder=\"请选择类型\" @change=\"selectLeaveType\">\r\n                    <el-option v-for=\"(item, index) in typeOptions\" :value=\"item.value\" :key=\"index\" :label=\"item.label\" :disabled=\"item.disabled\"></el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"调休日期：\" v-if=\"formData.type == '4'\">\r\n                <el-select v-model=\"formData.restIdList\" multiple placeholder=\"请选择\" @change=\"selectRest\">\r\n                    <el-option v-for=\"(item, index) in restOptions\" :value=\"item.value\" :key=\"index\" :label=\"item.label\"></el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"调休日期：\" v-if=\"formData.type == '4'\">\r\n                <el-date-picker\r\n                    v-model=\"formData.start\"\r\n                    :picker-options=\"pickerOptions7\"\r\n                    @change=\"selectStart\"\r\n                    type=\"date\"\r\n                    placeholder=\"选择开始时间\"\r\n                    format=\"yyyy年MM月dd日\"\r\n                    value-format=\"yyyy-MM-dd\"\r\n                    style=\"margin-right: 10px\"\r\n                ></el-date-picker>\r\n                <el-date-picker\r\n                    v-model=\"formData.end\"\r\n                    :picker-options=\"pickerOptions8\"\r\n                    @change=\"selectEnd\"\r\n                    type=\"date\"\r\n                    placeholder=\"选择结束时间\"\r\n                    format=\"yyyy年MM月dd日\"\r\n                    value-format=\"yyyy-MM-dd\"\r\n                ></el-date-picker>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"请假时间：\" v-if=\"formData.type == '9' || formData.type == '10'\">\r\n                <el-date-picker\r\n                    v-model=\"formData.start\"\r\n                    :picker-options=\"pickerOptions9\"\r\n                    @change=\"chooseSat\"\r\n                    type=\"date\"\r\n                    value-format=\"yyyy-MM-dd\"\r\n                    format=\"yyyy年MM月dd日\"\r\n                    placeholder=\"选择日期\"\r\n                ></el-date-picker>\r\n            </el-form-item>\r\n\r\n            <el-form-item v-if=\"formData.type == '1'\" label=\"请假时间：\">\r\n                <el-col :span=\"10\">\r\n                    <el-form-item prop=\"start\">\r\n                        <el-date-picker\r\n                            v-model=\"formData.start\"\r\n                            :picker-options=\"pickerOptions10\"\r\n                            @change=\"chooseStart\"\r\n                            type=\"datetime\"\r\n                            style=\"margin-right: 10px\"\r\n                            placeholder=\"选择开始时间\"\r\n                            default-time=\"09:30:00\"\r\n                            format=\"yyyy-MM-dd HH:mm:ss\"\r\n                            value-format=\"yyyy-MM-dd HH:mm:ss\"\r\n                        ></el-date-picker>\r\n                    </el-form-item>\r\n                </el-col>\r\n                <el-col class=\"line\" :span=\"2\">-</el-col>\r\n                <el-col :span=\"10\">\r\n                    <el-form-item prop=\"end\">\r\n                        <el-date-picker\r\n                            v-model=\"formData.end\"\r\n                            type=\"datetime\"\r\n                            :picker-options=\"pickerOptions11\"\r\n                            @change=\"chooseEnd\"\r\n                            placeholder=\"选择结束时间\"\r\n                            default-time=\"18:30:00\"\r\n                            format=\"yyyy-MM-dd HH:mm:ss\"\r\n                            value-format=\"yyyy-MM-dd HH:mm:ss\"\r\n                        ></el-date-picker>\r\n                    </el-form-item>\r\n                </el-col>\r\n            </el-form-item>\r\n\r\n            <el-form-item v-if=\"formData.type == '2'\" label=\"请假时间：\">\r\n                <el-col :span=\"10\">\r\n                    <el-form-item prop=\"start\">\r\n                        <el-date-picker\r\n                            v-model=\"formData.start\"\r\n                            :picker-options=\"pickerOptions1\"\r\n                            @change=\"chooseStart\"\r\n                            type=\"datetime\"\r\n                            style=\"margin-right: 10px\"\r\n                            placeholder=\"选择开始时间\"\r\n                            default-time=\"09:30:00\"\r\n                            format=\"yyyy-MM-dd HH:mm:ss\"\r\n                            value-format=\"yyyy-MM-dd HH:mm:ss\"\r\n                        ></el-date-picker>\r\n                    </el-form-item>\r\n                </el-col>\r\n                <el-col class=\"line\" :span=\"2\">-</el-col>\r\n                <el-col :span=\"10\">\r\n                    <el-form-item prop=\"end\">\r\n                        <el-date-picker\r\n                            v-model=\"formData.end\"\r\n                            type=\"datetime\"\r\n                            :picker-options=\"pickerOptions2\"\r\n                            @change=\"chooseEnd\"\r\n                            placeholder=\"选择结束时间\"\r\n                            default-time=\"18:30:00\"\r\n                            format=\"yyyy-MM-dd HH:mm:ss\"\r\n                            value-format=\"yyyy-MM-dd HH:mm:ss\"\r\n                        ></el-date-picker>\r\n                    </el-form-item>\r\n                </el-col>\r\n            </el-form-item>\r\n\r\n            <el-form-item v-if=\"formData.type == '3'\" label=\"请假时间：\">\r\n                <el-col :span=\"11\">\r\n                    <el-form-item prop=\"start\">\r\n                        <el-date-picker\r\n                            v-model=\"formData.start\"\r\n                            :picker-options=\"pickerOptions5\"\r\n                            @change=\"selectStart\"\r\n                            type=\"date\"\r\n                            placeholder=\"选择开始时间\"\r\n                            format=\"yyyy年MM月dd日\"\r\n                            value-format=\"yyyy-MM-dd\"\r\n                            style=\"margin-right: 10px\"\r\n                        ></el-date-picker>\r\n                    </el-form-item>\r\n                </el-col>\r\n                <el-col class=\"line\" :span=\"2\">-</el-col>\r\n                <el-col :span=\"11\">\r\n                    <el-form-item prop=\"end\">\r\n                        <el-date-picker\r\n                            v-model=\"formData.end\"\r\n                            :picker-options=\"pickerOptions6\"\r\n                            @change=\"selectEnd\"\r\n                            type=\"date\"\r\n                            placeholder=\"选择结束时间\"\r\n                            format=\"yyyy年MM月dd日\"\r\n                            value-format=\"yyyy-MM-dd\"\r\n                        ></el-date-picker>\r\n                    </el-form-item>\r\n                </el-col>\r\n            </el-form-item>\r\n\r\n            <el-form-item v-if=\"formData.type == '5' || formData.type == '6' || formData.type == '7' || formData.type == '8'\" label=\"请假时间：\" required>\r\n                <el-col :span=\"11\">\r\n                    <el-form-item prop=\"start\">\r\n                        <el-date-picker\r\n                            v-model=\"formData.start\"\r\n                            :picker-options=\"pickerOptions3\"\r\n                            @change=\"selectStart\"\r\n                            type=\"date\"\r\n                            placeholder=\"选择开始时间\"\r\n                            format=\"yyyy年MM月dd日\"\r\n                            value-format=\"yyyy-MM-dd\"\r\n                            style=\"margin-right: 10px\"\r\n                        ></el-date-picker>\r\n                    </el-form-item>\r\n                </el-col>\r\n                <el-col class=\"line\" :span=\"2\">-</el-col>\r\n                <el-col :span=\"11\">\r\n                    <el-form-item prop=\"end\">\r\n                        <el-date-picker\r\n                            v-model=\"formData.end\"\r\n                            :picker-options=\"pickerOptions4\"\r\n                            @change=\"selectEnd\"\r\n                            type=\"date\"\r\n                            placeholder=\"选择结束时间\"\r\n                            format=\"yyyy年MM月dd日\"\r\n                            value-format=\"yyyy-MM-dd\"\r\n                        ></el-date-picker>\r\n                    </el-form-item>\r\n                </el-col>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"请假时长：\" prop=\"time\">\r\n                <el-input type=\"text\" :disabled=\"true\" placeholder=\"请假时长\" v-model=\"timeValue\" maxlength=\"10\" show-word-limit></el-input>\r\n            </el-form-item>\r\n            <!--            </div>-->\r\n\r\n            <el-form-item label=\"请假事由：\" prop=\"reason\">\r\n                <el-input type=\"textarea\" v-model=\"formData.reason\" placeholder=\"请填写请假事由\" maxlength=\"100\" show-word-limit></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"证明图片：\" prop=\"proveImg\" v-if=\"formData.type == '2'\">\r\n                <el-upload\r\n                    :action=\"uploadUrl\"\r\n                    name=\"file\"\r\n                    list-type=\"picture-card\"\r\n                    :on-preview=\"handlePreview\"\r\n                    :on-remove=\"handleRemove\"\r\n                    :on-success=\"handSuccess\"\r\n                    :before-upload=\"beforeAvatarUpload\"\r\n                    accept=\".png,.jpg,.jpeg,.JPEG,.PNG,.JPG\"\r\n                    :auto-upload=\"true\"\r\n                >\r\n                    <i class=\"el-icon-plus\"></i>\r\n                </el-upload>\r\n            </el-form-item>\r\n            <el-form-item label=\"审批人：\">\r\n                <div class=\"apply-user-list\" v-for=\"user in applyUserList\">\r\n                    <el-avatar :size=\"60\" :src=\"user.avatar\"></el-avatar>\r\n                    <span class=\"username\">{{ user.username }}</span>\r\n                </div>\r\n            </el-form-item>\r\n            <el-form-item class=\"save\" style=\"text-align: center\">\r\n                <el-button type=\"primary\" @click=\"onSubmit\">保存</el-button>\r\n                <el-button @click=\"backHistory\">取消</el-button>\r\n            </el-form-item>\r\n        </el-form>\r\n        <el-button type=\"primary\" class=\"invoiceRules\" @click=\"open\">请假规范</el-button>\r\n    </div>\r\n</template>\r\n<script>\r\nimport { addObj, editObj } from '../../../api/apply/leave.js';\r\nimport { getApplyUserInfo } from '../../../api/admin/user.js';\r\nimport { getItemVosWithUserId } from '../../../api/project/team.js';\r\nimport { getStandardApplyInfoById } from '../../../api/standard/apply.js';\r\nimport { getVacationByUserId } from '../../../api/checkwork/vacation.js';\r\nimport { getRestByUse } from '../../../api/checkwork/rest.js';\r\nimport { mapGetters } from 'vuex';\r\nexport default {\r\n    data() {\r\n        return {\r\n            query: {\r\n                itemId: null,\r\n                userId: null,\r\n                deptId: null,\r\n                type: 4\r\n            },\r\n            labelPosition: 'right',\r\n            formData: {\r\n                newData: true,\r\n                leaveId: null,\r\n                itemId: null,\r\n                userId: '',\r\n                type: '1',\r\n                start: '',\r\n                end: '',\r\n                time: '',\r\n                reason: '',\r\n                proveImg: '',\r\n                restIdList: '',\r\n                restList: '',\r\n                clockList: '',\r\n                approverids: ''\r\n                // sat:\"\"\r\n            },\r\n            timeValue: '',\r\n            uploadUrl: '',\r\n            itemOptions: [\r\n                {\r\n                    value: null,\r\n                    label: '与项目无关'\r\n                }\r\n            ],\r\n            timeOptions: [],\r\n            vacationInfo: null,\r\n            restInfo: null,\r\n            restOptions: [],\r\n            typeOptions: [\r\n                {\r\n                    value: '1',\r\n                    label: '事假'\r\n                },\r\n                {\r\n                    value: '2',\r\n                    label: '病假'\r\n                },\r\n                {\r\n                    value: '3',\r\n                    label: '年假'\r\n                },\r\n                {\r\n                    value: '4',\r\n                    label: '调休'\r\n                },\r\n                {\r\n                    value: '5',\r\n                    label: '婚假'\r\n                },\r\n                {\r\n                    value: '6',\r\n                    label: '产假'\r\n                },\r\n                {\r\n                    value: '7',\r\n                    label: '陪产假'\r\n                },\r\n                {\r\n                    value: '8',\r\n                    label: '丧假'\r\n                },\r\n                {\r\n                    value: '9',\r\n                    label: '周六妈妈带娃'\r\n                },\r\n                {\r\n                    value: '10',\r\n                    label: '周六培训学习'\r\n                }\r\n            ],\r\n            rules: {\r\n                type: [\r\n                    {\r\n                        required: true,\r\n                        message: '请选择请假类型',\r\n                        trigger: 'change'\r\n                    }\r\n                ],\r\n                start: [{ required: true, message: '请选择时间', trigger: 'change' }],\r\n                end: [{ required: true, message: '请选择时间', trigger: 'change' }],\r\n                time: [{ required: true, message: '请选择时间' }],\r\n                reason: [{ required: true, message: '请填写请假事由' }],\r\n                proveImg: [\r\n                    {\r\n                        required: true,\r\n                        message: '请上传证明图片',\r\n                        trigger: 'change'\r\n                    }\r\n                ]\r\n            },\r\n            saving: false,\r\n            applyUserList: [],\r\n            pickerOptions1: {\r\n                disabledDate: this.disabledDate\r\n            },\r\n            pickerOptions2: {\r\n                disabledDate: this.disabledDate\r\n            },\r\n            pickerOptions3: {\r\n                disabledDate: this.disabledDate\r\n            },\r\n            pickerOptions4: {\r\n                disabledDate: this.disabledDate\r\n            },\r\n            pickerOptions5: {\r\n                disabledDate: this.disabledDate1\r\n            },\r\n            pickerOptions6: {\r\n                disabledDate: this.disabledDate1\r\n            },\r\n            pickerOptions7: {\r\n                disabledDate: this.disabledDate2\r\n            },\r\n            pickerOptions8: {\r\n                disabledDate: this.disabledDate2\r\n            },\r\n            pickerOptions9: {\r\n                disabledDate: this.disabledDate3\r\n            },\r\n            pickerOptions10: {\r\n                disabledDate: this.disabledDate4\r\n            },\r\n            pickerOptions11: {\r\n                disabledDate: this.disabledDate4\r\n            },\r\n\r\n            startDate: '',\r\n            endDate: '',\r\n            dataList: []\r\n        };\r\n    },\r\n    created() {\r\n        this.getStandardApplyInfo();\r\n        this.getApplyUser(this.userId);\r\n        this.getItemVosWithUserId(this.userId);\r\n\r\n        this.getVacationByUserId(this.userId);\r\n        this.getRestByUserId(this.userId);\r\n\r\n        this.formData.userId = this.userId;\r\n        this.query.userId = this.userId;\r\n\r\n        this.uploadUrl = `${window.location.origin}/apply/leave/upload`;\r\n        const editLeaveInfo = JSON.parse(window.localStorage.getItem('editLeaveInfo'));\r\n\r\n        console.log(editLeaveInfo);\r\n        if (editLeaveInfo) {\r\n            this.formData.newData = false;\r\n            this.formData.leaveId = editLeaveInfo.leaveId;\r\n            this.formData.itemId = editLeaveInfo.itemId;\r\n            this.formData.type = editLeaveInfo.type;\r\n            this.formData.start = editLeaveInfo.start;\r\n            this.formData.end = editLeaveInfo.end;\r\n            this.formData.time = editLeaveInfo.time;\r\n            this.timeValue = editLeaveInfo.time + ' 天';\r\n            this.formData.reason = editLeaveInfo.reason;\r\n        } else {\r\n            this.applyClockInfo = JSON.parse(window.localStorage.getItem('applyClockInfo'));\r\n            if (this.applyClockInfo) {\r\n                this.formData.type = '1';\r\n\r\n                this.formData.end = this.applyClockInfo.day;\r\n                if (this.applyClockInfo.type == 1) {\r\n                    this.formData.start = this.applyClockInfo.day + ' 09:30:00';\r\n                    this.formData.end = this.applyClockInfo.day + ' 12:00:00';\r\n                    this.formData.time = 2.5;\r\n                    this.timeValue = '2.5小时';\r\n                }\r\n                if (this.applyClockInfo.type == 2) {\r\n                    this.formData.start = this.applyClockInfo.day + ' 14:00:00';\r\n                    this.formData.end = this.applyClockInfo.day + ' 18:30:00';\r\n                    this.formData.time = 4.5;\r\n                    this.timeValue = '4.5小时';\r\n                }\r\n\r\n                this.formData.clockList = JSON.stringify(this.applyClockInfo);\r\n            }\r\n        }\r\n        //    年假\r\n        this.vacation();\r\n    },\r\n    computed: {\r\n        ...mapGetters(['permissions', 'userId'])\r\n    },\r\n    methods: {\r\n        getApplyUser() {\r\n            getApplyUserInfo(this.query).then(response => {\r\n                this.applyUserList = [];\r\n                this.formData.approverids = null;\r\n                response.data.data.forEach(element => {\r\n                    this.applyUserList.push({\r\n                        userId: element.userId,\r\n                        username: element.username,\r\n                        avatar: element.avatar\r\n                    });\r\n                    if (this.formData.approverids == null) {\r\n                        this.formData.approverids += element.userId;\r\n                    } else {\r\n                        this.formData.approverids += ',' + element.userId;\r\n                    }\r\n                });\r\n            });\r\n        },\r\n        getItemVosWithUserId(userId) {\r\n            getItemVosWithUserId(userId).then(response => {\r\n                response.data.data.forEach(element => {\r\n                    this.itemOptions.push({\r\n                        value: element.itemId,\r\n                        label: element.alias\r\n                    });\r\n                });\r\n            });\r\n        },\r\n        getVacationByUserId(userId) {\r\n            getVacationByUserId(userId).then(response => {\r\n                this.vacationInfo = response.data.data;\r\n                if (this.vacationInfo) {\r\n                    if (this.vacationInfo.thingNum > 0) {\r\n                        this.typeOptions[0].label = '事假（' + this.vacationInfo.thingNum + '小时）';\r\n                    } else {\r\n                        this.typeOptions[0].label = '事假（0小时）';\r\n                        this.typeOptions[0].disabled = true;\r\n                    }\r\n\r\n                    if (this.vacationInfo.annualNum > 0) {\r\n                        this.typeOptions[2].label = '年假（' + this.vacationInfo.annualNum + '天）';\r\n                    } else {\r\n                        this.typeOptions[2].label = '年假（0天）';\r\n                        this.typeOptions[2].disabled = true;\r\n                    }\r\n                } else {\r\n                    this.typeOptions[0].label = '事假（0小时）';\r\n                    this.typeOptions[0].disabled = true;\r\n                    this.typeOptions[2].label = '年假（0天）';\r\n                    this.typeOptions[2].disabled = true;\r\n                    this.formData.type = '2';\r\n                }\r\n            });\r\n        },\r\n        getRestByUserId(userId) {\r\n            getRestByUse(userId).then(response => {\r\n                console.log(response);\r\n                this.restInfo = response.data.data;\r\n                this.restInfo.forEach(element => {\r\n                    this.restOptions.push({\r\n                        value: element.restId,\r\n                        label: element.day\r\n                    });\r\n                });\r\n                if (this.restInfo.length > 0) {\r\n                    this.typeOptions[3].label = '调休（' + this.restInfo.length + '天）';\r\n                } else {\r\n                    this.typeOptions[3].label = '调休（0天）';\r\n                    this.typeOptions[3].disabled = true;\r\n                }\r\n            });\r\n        },\r\n        disabledDate(time) {\r\n            if (!this.formData.start && !this.formData.end) {\r\n                return time.getTime() < Date.now() - 8 * 24 * 3600 * 1000 || time.getTime() > Date.now() + 7 * 24 * 3600 * 1000;\r\n            }\r\n            if (this.formData.type == 1 || this.formData.type == 3) {\r\n                if (this.formData.start && !this.formData.end) {\r\n                    return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > Date.now() + this.vacationInfo.annualNum * 24 * 3600 * 1000;\r\n                }\r\n            }\r\n            if (this.formData.type == 2) {\r\n                return time.getTime() < Date.now() - 7 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n\r\n            if (!this.formData.start && this.formData.end) {\r\n                return time.getTime() < Date.now() - 7 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n\r\n            if (this.formData.start && this.formData.end) {\r\n                return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n        },\r\n        // 年假\r\n        disabledDate1(time) {\r\n            if (!this.formData.start && !this.formData.end) {\r\n                return time.getTime() < Date.now() - 8 * 24 * 3600 * 1000 || time.getTime() > Date.now() + 7 * 24 * 3600 * 1000;\r\n            }\r\n            if (this.formData.start && !this.formData.end) {\r\n                return (\r\n                    time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 ||\r\n                    time.getTime() > Date.parse(this.formData.start) + (this.vacationInfo.annualNum - 1) * 24 * 3600 * 1000\r\n                );\r\n            }\r\n            if (!this.formData.start && this.formData.end) {\r\n                return time.getTime() < Date.parse(this.formData.end) - this.vacationInfo.annualNum * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n            if (this.formData.start && this.formData.end) {\r\n                return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n        },\r\n        //调休\r\n        disabledDate2(time) {\r\n            if (!this.formData.start && !this.formData.end) {\r\n                return time.getTime() < Date.now() - 8 * 24 * 3600 * 1000 || time.getTime() > Date.now() + 7 * 24 * 3600 * 1000;\r\n            }\r\n            if (this.formData.start && !this.formData.end) {\r\n                return (\r\n                    time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 ||\r\n                    time.getTime() > Date.parse(this.formData.start) + (this.formData.time - 1) * 24 * 3600 * 1000\r\n                );\r\n            }\r\n            if (!this.formData.start && this.formData.end) {\r\n                return time.getTime() < Date.parse(this.formData.end) - this.formData.time * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n            if (this.formData.start && this.formData.end) {\r\n                return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n        },\r\n        //周六\r\n        disabledDate3(time) {\r\n            switch (new Date().getDay()) {\r\n                case 0:\r\n                    return (\r\n                        time.getTime() < Date.now() - (0 + 7) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (0 + 6) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (0 + 7) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (0 + 8) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 1:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 2) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 1) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (1 + 3) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 + 4) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 2:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 3) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 2) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (1 + 2) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 + 3) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 3:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 4) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 3) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (1 + 1) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 + 2) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 4:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 5) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 4) * 24 * 3600 * 1000 && time.getTime() < Date.now() + 1 * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 + 1) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 5:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 6) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 5) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (1 - 1) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 + 0) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n                case 6:\r\n                    return (\r\n                        time.getTime() < Date.now() - (1 + 7) * 24 * 3600 * 1000 ||\r\n                        (time.getTime() > Date.now() - (1 + 6) * 24 * 3600 * 1000 && time.getTime() < Date.now() + (1 - 2) * 24 * 3600 * 1000) ||\r\n                        time.getTime() > Date.now() + (1 - 1) * 24 * 3600 * 1000\r\n                    );\r\n                    break;\r\n            }\r\n        },\r\n\r\n        //事假\r\n        disabledDate4(time) {\r\n            var day = Math.ceil(this.vacationInfo.thingNum / 9);\r\n            if (!this.formData.start && !this.formData.end) {\r\n                return time.getTime() < Date.now() - 8 * 24 * 3600 * 1000 || time.getTime() > Date.now() + 7 * 24 * 3600 * 1000;\r\n            }\r\n            if (this.formData.start && !this.formData.end) {\r\n                return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > Date.parse(this.formData.start) + (day - 1) * 24 * 3600 * 1000;\r\n            }\r\n            if (!this.formData.start && this.formData.end) {\r\n                return time.getTime() < Date.parse(this.formData.end) - day * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n            if (this.formData.start && this.formData.end) {\r\n                return time.getTime() < new Date(this.formData.start) - 1 * 24 * 3600 * 1000 || time.getTime() > new Date(this.formData.end);\r\n            }\r\n        },\r\n\r\n        chooseSat() {\r\n            this.formData.time = 1;\r\n            this.timeValue = this.formData.time + ' 天';\r\n        },\r\n        selectStart(val) {\r\n            if (this.formData.start && this.formData.end) {\r\n                const days = this.DateDiff(this.formData.start, this.formData.end);\r\n                console.log(days);\r\n                this.formData.time = days + 1;\r\n                this.timeValue = this.formData.time + ' 天';\r\n            }\r\n        },\r\n        selectEnd(val) {\r\n            console.log(val);\r\n            if (this.formData.start && this.formData.end) {\r\n                const days = this.DateDiff(this.formData.start, this.formData.end);\r\n                console.log(days);\r\n                this.formData.time = days + 1;\r\n                this.timeValue = this.formData.time + ' 天';\r\n            }\r\n        },\r\n        DateDiff(sDate1, sDate2) {\r\n            var aDate, oDate1, oDate2, iDays;\r\n            aDate = sDate1.split('-');\r\n            oDate1 = new Date(aDate[0], aDate[1], aDate[2]); //转换为12-18-2006格式\r\n            aDate = sDate2.split('-');\r\n            oDate2 = new Date(aDate[0], aDate[1], aDate[2]);\r\n            iDays = parseInt(Math.abs(oDate2 - oDate1) / 1000 / 60 / 60 / 24); //把相差的毫秒数转换为天数\r\n            return iDays;\r\n        },\r\n        chooseStart(val) {\r\n            console.log(val);\r\n            if (this.formData.start && this.formData.end) {\r\n                const hours = this.chooseDiff(this.formData.start, this.formData.end);\r\n                this.formData.time = hours;\r\n                this.timeValue = this.formData.time + ' 小时';\r\n                console.log(hours);\r\n                console.log(this.formData.time);\r\n            }\r\n        },\r\n        chooseEnd(val) {\r\n            console.log(val);\r\n            if (this.formData.start && this.formData.end) {\r\n                const hours = this.chooseDiff(this.formData.start, this.formData.end);\r\n                this.formData.time = hours;\r\n                this.timeValue = this.formData.time + ' 小时';\r\n                console.log(hours);\r\n                console.log(this.formData.time);\r\n            }\r\n        },\r\n        chooseDiff(sDate1, sDate2) {\r\n            if ((sDate1 == sDate2) == true) {\r\n                var date = Date.parse(sDate2) - Date.parse(sDate1);\r\n                var iHours = Math.floor(date / (3600 * 1000));\r\n                return iHours;\r\n                console.log(hours);\r\n            } else if ((sDate1 == sDate2) == false) {\r\n                var date = Date.parse(sDate2) - Date.parse(sDate1);\r\n                var day = Math.floor(date / 3600 / 1000 / 24);\r\n\r\n                var iHours = Math.floor(date / (3600 * 1000));\r\n                var iHours = iHours - 15 * day;\r\n                return iHours;\r\n                console.log(hours);\r\n            }\r\n        },\r\n        selectLeaveType(val) {\r\n            this.formData.start = '';\r\n            this.formData.end = '';\r\n            this.formData.time = '';\r\n            this.timeValue = '';\r\n        },\r\n\r\n        selectRest(val) {\r\n            // console.log(val)\r\n            // console.log(this.formData.restIdList)\r\n            this.formData.restList = '';\r\n            val.forEach(element => {\r\n                this.formData.restList += element + ',';\r\n            });\r\n            this.formData.time = val.length;\r\n            this.timeValue = val.length + ' 天';\r\n        },\r\n        vacation() {},\r\n        backHistory() {\r\n            window.localStorage.removeItem('editLeaveInfo');\r\n            window.localStorage.removeItem('applyClockInfo');\r\n            this.formData.newData = true;\r\n            this.formData.leaveId = null;\r\n            this.formData.itemId = null;\r\n            this.formData.start = '';\r\n            this.formData.end = '';\r\n            this.formData.day = '';\r\n            this.formData.time = '';\r\n            this.timeValue = '';\r\n            this.formData.reason = '';\r\n            this.$router.go(-1);\r\n        },\r\n        onSubmit() {\r\n            if (this.formData.type == '9' || this.formData.type == '10') {\r\n                this.formData.end = this.formData.start;\r\n            }\r\n            this.$refs['formData'].validate(valid => {\r\n                if (valid) {\r\n                    this.saving = true;\r\n                    if (!this.formData.newData) {\r\n                        editObj(this.formData)\r\n                            .then(res => {\r\n                                if (res.data.data) {\r\n                                    this.backHistory();\r\n                                }\r\n                            })\r\n                            .finally(() => {\r\n                                this.saving = false;\r\n                            });\r\n                    } else {\r\n                        addObj(this.formData)\r\n                            .then(res => {\r\n                                if (res.data.data) {\r\n                                    this.backHistory();\r\n                                }\r\n                                this.$router.push('/apply/leave');\r\n                            })\r\n                            .finally(() => {\r\n                                this.saving = false;\r\n                            });\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        beforeAvatarUpload: function(file) {\r\n            const isJPG = file.type === 'image/jpeg';\r\n            const isPNG = file.type === 'image/png';\r\n            const isPG = isJPG || isPNG;\r\n            const isLt5M = file.size / 1024 / 1024 < 5;\r\n            if (!isPG) {\r\n                this.$message.error('上传图片只能是 JPG 或 PNG 格式!');\r\n            }\r\n            if (!isLt5M) {\r\n                this.$message.error('上传图片大小不能超过 5MB!');\r\n            }\r\n            return isPG && isLt5M;\r\n        },\r\n        handleRemove(data) {\r\n            const imgInfo = data.response.data;\r\n            const imgUrl = imgInfo.bucketName + '-' + imgInfo.fileName;\r\n            this.formData.proveImg = this.formData.proveImg.replace(imgUrl + ',', '');\r\n            console.log(this.formData.proveImg);\r\n        },\r\n        handlePreview(file) {\r\n            console.log(file);\r\n        },\r\n        handSuccess(data) {\r\n            const imgInfo = data.data;\r\n            const imgUrl = imgInfo.bucketName + '-' + imgInfo.fileName;\r\n            this.formData.proveImg += imgUrl + ',';\r\n        },\r\n        getStandardApplyInfo() {\r\n            getStandardApplyInfoById(4).then(response => {\r\n                if (response.data.data) {\r\n                    const data = response.data.data;\r\n                    this.content = data.content;\r\n                    const leaveStandardApply = JSON.parse(window.localStorage.getItem('leaveStandardApply'));\r\n                    if (leaveStandardApply) {\r\n                        if (leaveStandardApply.version < data.version) {\r\n                            this.open();\r\n                        }\r\n                    } else {\r\n                        this.open();\r\n                    }\r\n                    window.localStorage.setItem('leaveStandardApply', JSON.stringify(data));\r\n                }\r\n            });\r\n        },\r\n        open() {\r\n            let content = this.content.split('\\n\\n');\r\n            let newDatas = [];\r\n            const h = this.$createElement;\r\n            for (let i in content) {\r\n                newDatas.push(h('p', null, content[i]));\r\n            }\r\n            this.$alert(h('div', null, newDatas), '请假规范');\r\n        }\r\n    },\r\n    mounted() {}\r\n};\r\n</script>\r\n<style type=\"text/scss\" scoped lang=\"scss\"></style>\r\n"]}]}