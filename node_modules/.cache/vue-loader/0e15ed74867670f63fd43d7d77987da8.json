{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\apply\\manhour\\Approver.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\apply\\manhour\\Approver.vue","mtime":1597025146945},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { getManhourApproverPage, updateManhourApprover, updateManhourApproverAll } from '../../../api/apply/manhour.js';\r\n// import {getUserInfo} from \"../../../api/admin/user.js\";\r\nimport { mapGetters } from 'vuex';\r\nexport default {\r\n    data() {\r\n        return {\r\n            show: '',\r\n            statusOptions: [\r\n                {\r\n                    value: '',\r\n                    label: '全部'\r\n                },\r\n                {\r\n                    value: '0',\r\n                    label: '审批中'\r\n                },\r\n                {\r\n                    value: '1',\r\n                    label: '同意'\r\n                },\r\n                {\r\n                    value: '2',\r\n                    label: '拒绝'\r\n                }\r\n            ],\r\n            query: {\r\n                userId: null,\r\n                status: '',\r\n                current: 1,\r\n                size: 10\r\n            },\r\n            pages: 0,\r\n            total: 0,\r\n            listLoading: false,\r\n            list: [],\r\n            number: '',\r\n            listType: '2'\r\n        };\r\n    },\r\n    props: [\"status\"],\r\n    created() {\r\n        window.localStorage.removeItem('editManhourInfo');\r\n        this.query.status = this.status;\r\n        if (!this.query.status) {\r\n            this.query.status = '';\r\n        }\r\n        this.query.userId = this.userId;\r\n        this.getManhourApproverPage();\r\n    },\r\n    computed: {\r\n        ...mapGetters(['permissions', 'userId'])\r\n    },\r\n    methods: {\r\n        getManhourApproverPage() {\r\n            this.listLoading = true;\r\n            getManhourApproverPage(this.query)\r\n                .then(response => {\n                    console.log(response)\r\n                    this.listLoading = false;\r\n                    this.total = response.data.data.total;\r\n                    this.query.current = response.data.data.current;\r\n                    this.query.size = response.data.data.size;\r\n                    this.list = response.data.data.records;\r\n                    this.list.forEach(item => {\r\n                        this.$set(item, 'show', true);\r\n                        if (item.checkMin == null || item.checkMin == 0) {\r\n                            item.checkMin = item.useHour;\r\n                        }\r\n                        // console.log(item);\r\n                    });\r\n                })\r\n                .catch(() => {\r\n                    this.listLoading = false;\r\n                });\r\n        },\r\n        handleSizeChange(val) {\r\n            this.query.size = val;\r\n            this.getManhourApproverPage();\r\n        },\r\n        handleCurrentChange(val) {\r\n            this.query.current = val;\r\n            this.getManhourApproverPage();\r\n        },\r\n\r\n        // 通过审批\r\n        updateManhourApprover(val) {\r\n            if (this.list[val].checkMin == this.list[val].useHour - 2 || this.list[val].checkMin == 0) {\r\n                this.list[val].checkMin = this.list[val].useHour;\r\n            }\r\n            this.list[val].checkMin = parseFloat(this.list[val].checkMin);\r\n            this.$set(this.list[val], 'check', 1);\r\n            console.log(this.list[val]);\r\n            updateManhourApprover(this.list[val]).then(res => {\r\n                console.log(res);\r\n                this.getManhourApproverPage();\r\n            });\r\n        },\r\n\r\n        //  不通过审批\r\n        okUpdate(val) {\r\n            this.list[val].show = false;\r\n            if (this.list[val].checkMin == this.list[val].useHour - 2 || this.list[val].checkMin == 0) {\r\n                this.list[val].checkMin = this.list[val].useHour;\r\n            }\r\n            this.list[val].checkMin = parseFloat(this.list[val].checkMin);\r\n            this.$set(this.list[val], 'check', 2);\r\n            console.log(this.list[val]);\r\n            updateManhourApprover(this.list[val]).then(res => {\r\n                console.log(res);\r\n                this.getManhourApproverPage();\r\n            });\r\n        },\r\n\r\n        // 一键审批\r\n        // updateManhourAll() {\r\n        //     var Newlist = this.list.filter(item => item.status == 0);\r\n        //     for (var i = 0; i < Newlist.length; i++) {\r\n        //         if (Newlist[i].checkMin == Newlist[i].useHour - 2 || this.list[val].checkMin == 0) {\r\n        //             Newlist[i].checkMin = Newlist[i].useHour;\r\n        //         }\r\n        //     }\r\n        //     updateManhourApproverAll(Newlist).then(res => {\r\n        //         console.log(res);\r\n        //         this.getManhourApproverPage();\r\n        //         this.show = true;\r\n        //     });\r\n        // },\r\n        //  合并\r\n        flitterData(arr) {\r\n            let spanOneArr = [],\r\n                spanTwoArr = [],\r\n                spanThreeArr = [],\r\n                concatOne = 0,\r\n                concatTwo = 0,\r\n                concatThree = 0;\r\n            arr.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    spanOneArr.push(1);\r\n                    spanTwoArr.push(1);\r\n                    spanThreeArr.push(1);\r\n                } else {\r\n                    if (item.day === arr[index - 1].day) {\r\n                        //第一列需合并相同内容的判断条件\r\n                        spanOneArr[concatOne] += 1;\r\n                        spanOneArr.push(0);\r\n                    } else {\r\n                        spanOneArr.push(1);\r\n                        concatOne = index;\r\n                    }\r\n                    if (item.day === arr[index - 1].day && item.integral === arr[index - 1].integral && item.applyUserName === arr[index - 1].applyUserName) {\r\n                        //第二列需合并相同内容的判断条件\r\n                        spanTwoArr[concatTwo] += 1;\r\n                        spanTwoArr.push(0);\r\n                    } else {\r\n                        spanTwoArr.push(1);\r\n                        concatTwo = index;\r\n                    }\r\n                }\r\n            });\r\n            return {\r\n                one: spanOneArr,\r\n                two: spanTwoArr,\r\n                three: spanThreeArr\r\n            };\r\n        },\r\n\r\n        objectSpanMethod({ row, column, rowIndex, columnIndex }) {\r\n            // if (columnIndex === 0) {\r\n            //     const _row = this.flitterData(this.list).one[rowIndex];\r\n            //     const _col = _row > 0 ? 1 : 0;\r\n            //     return {\r\n            //         rowspan: _row,\r\n            //         colspan: _col\r\n            //     };\r\n            // }\r\n            // if (columnIndex === 1) {\r\n            //     const _row = this.flitterData(this.list).two[rowIndex];\r\n            //     const _col = _row > 0 ? 1 : 0;\r\n            //     return {\r\n            //         rowspan: _row,\r\n            //         colspan: _col\r\n            //     };\r\n            // }\r\n        }\r\n    },\r\n    mounted() {}\r\n};\r\n",{"version":3,"sources":["Approver.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Approver.vue","sourceRoot":"src/views/apply/manhour","sourcesContent":["<template>\r\n    <div>\r\n        <div style=\"display: flex; justify-content: space-between;margin-bottom: 1%;\">\r\n            <span class=\"tit\">工时审批 / 总数 : {{ total }}</span>\r\n            <!-- <el-button size=\"mini\" type=\"primary\" style=\"margin-right: 30px;\" @click=\"updateManhourAll\">一键通过</el-button> -->\r\n        </div>\r\n        <el-form :inline=\"true\" :model=\"query\">\r\n            <el-form-item>\r\n                <el-select clearable v-model=\"query.status\" placeholder=\"请选择\">\r\n                    <el-option v-for=\"item in statusOptions\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\" :disabled=\"item.disabled\"></el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n            <el-form-item><el-button type=\"primary\" size=\"medium\" v-on:click=\"getManhourApproverPage()\" icon=\"el-icon-search\">搜索</el-button></el-form-item>\r\n        </el-form>\r\n        <el-table :data=\"list\" :span-method=\"objectSpanMethod\" stripe border v-loading=\"listLoading\" style=\"width: 100%;\">\r\n            <el-table-column prop=\"applyUserName\" min-width=\"80\" label=\"申请人\"></el-table-column>\r\n            <el-table-column prop=\"day\" min-width=\"100\" label=\"申请日期\"></el-table-column>\r\n            <el-table-column label=\"自评积分\">\r\n                <template slot-scope=\"scope\">\r\n                    <span>{{ scope.row.integral }} 分</span>\r\n                </template>\r\n            </el-table-column>\r\n            <el-table-column min-width=\"160\" label=\"项目\" :show-overflow-tooltip=\"true\">\r\n                <template slot-scope=\"scope\">\r\n                    <span v-if=\"scope.row.alias == null || scope.row.alias == ''\">与项目无关</span>\r\n                    <span v-else>{{ scope.row.alias }}</span>\r\n                </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"categoryName\" min-width=\"80\" label=\"工作类别\">\r\n            </el-table-column>\r\n            <el-table-column label=\"分类\" min-width=\"130\" :show-overflow-tooltip=\"true\">\r\n                <template slot-scope=\"scope\">\n                    <p>{{ scope.row.mainClassifyName }}</p>\n                    <p>{{ scope.row.subClassifyName }}</p>\r\n                </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"reason\" min-width=\"120\" label=\"工作内容\" :show-overflow-tooltip=\"true\"></el-table-column>\r\n            <el-table-column label=\"工时\">\r\n                <template slot-scope=\"scope\">\r\n                    <span>{{ scope.row.useHour }} 小时</span>\r\n                </template>\r\n            </el-table-column>\r\n            <el-table-column min-width=\"180\" label=\"审批工时\">\r\n                <template slot-scope=\"scope\">\r\n                    <!-- <p v-show=\"scope.row.show\" v-if=\"scope.row.status == 2 || scope.row.status == 1\">{{ scope.row.checkMin }} 小时</p>\r\n                    <p v-show=\"scope.row.show\" v-else>{{ scope.row.useHour }} 小时</p> -->\r\n                    <!-- v-show=\"!scope.row.show\" -->\r\n                    <el-input-number\r\n                        v-if=\"scope.row.status == 0\"\r\n                        v-model=\"scope.row.checkMin\"\r\n                        controls-position=\"right\"\r\n                        size=\"mini\"\r\n                        step-strictly\r\n                        :step=\"0.5\"\r\n                        :max=\"24\"\r\n                        :min=\"0.0\"\r\n                    ></el-input-number>\r\n                    <span v-else>{{ scope.row.checkMin }} 小时</span>\r\n                </template>\r\n            </el-table-column>\r\n            <el-table-column min-width=\"180\" label=\"反馈意见\">\r\n                <template slot-scope=\"scope\">\r\n                    <el-input v-if=\"scope.row.status == 0\" v-model=\"scope.row.summary\" size=\"mini\" placeholder=\"请输入内容\"></el-input>\r\n                    <span v-else>{{ scope.row.summary }}</span>\r\n                </template>\r\n            </el-table-column>\r\n            <el-table-column min-width=\"180\" label=\"完成进度\">\r\n                <template slot-scope=\"scope\">\r\n                    <el-tag v-if=\"scope.row.complete == '100'\" type=\"success\">已完成</el-tag>\r\n                    <div v-else>\r\n                        <el-tag type=\"warning\">完成 {{ scope.row.complete }}%</el-tag>\r\n                        <el-tag type=\"warning\">预计{{ scope.row.completeTime }}完成</el-tag>\r\n                    </div>\r\n                </template>\r\n            </el-table-column>\r\n            <el-table-column label=\"操作\" min-width=\"180\" fixed=\"right\">\r\n                <template slot-scope=\"scope\">\r\n                    <span v-if=\"scope.row.status == 0\">\r\n                        <span v-if=\"scope.row.show == true\">\r\n                            <el-button size=\"mini\" type=\"primary\" @click=\"updateManhourApprover(scope.$index)\">通过</el-button>\r\n                            <el-button size=\"mini\" type=\"primary\" @click=\"okUpdate(scope.$index)\">不通过</el-button>\r\n                        </span>\r\n                        <!-- <span v-if=\"scope.row.show == false\">\r\n                            <el-button size=\"mini\" type=\"primary\" @click=\"okUpdate(scope.$index)\">确定</el-button>\r\n                            <el-button size=\"mini\" type=\"primary\" @click=\"scope.row.show = true\">返回</el-button>\r\n                        </span> -->\r\n                    </span>\r\n\r\n                    <el-tag v-if=\"scope.row.status == 1 && scope.row.complete == '100'\" type=\"success\">同意</el-tag>\r\n                    <el-tag v-if=\"scope.row.status == 1 && scope.row.complete != '100'\" type=\"warning\">同意(未完成)</el-tag>\r\n                    <el-tag v-if=\"scope.row.status == 2\" type=\"danger\">已拒绝</el-tag>\r\n                </template>\r\n            </el-table-column>\r\n        </el-table>\r\n\r\n        <el-pagination\r\n            class=\"right\"\r\n            @size-change=\"handleSizeChange\"\r\n            @current-change=\"handleCurrentChange\"\r\n            :current-page=\"query.current\"\r\n            :page-sizes=\"[10, 20, 50, 100]\"\r\n            :page-size=\"query.size\"\r\n            layout=\"total, sizes, prev, pager, next\"\r\n            :total=\"total\"\r\n        ></el-pagination>\r\n    </div>\r\n</template>\r\n<script>\r\nimport { getManhourApproverPage, updateManhourApprover, updateManhourApproverAll } from '../../../api/apply/manhour.js';\r\n// import {getUserInfo} from \"../../../api/admin/user.js\";\r\nimport { mapGetters } from 'vuex';\r\nexport default {\r\n    data() {\r\n        return {\r\n            show: '',\r\n            statusOptions: [\r\n                {\r\n                    value: '',\r\n                    label: '全部'\r\n                },\r\n                {\r\n                    value: '0',\r\n                    label: '审批中'\r\n                },\r\n                {\r\n                    value: '1',\r\n                    label: '同意'\r\n                },\r\n                {\r\n                    value: '2',\r\n                    label: '拒绝'\r\n                }\r\n            ],\r\n            query: {\r\n                userId: null,\r\n                status: '',\r\n                current: 1,\r\n                size: 10\r\n            },\r\n            pages: 0,\r\n            total: 0,\r\n            listLoading: false,\r\n            list: [],\r\n            number: '',\r\n            listType: '2'\r\n        };\r\n    },\r\n    props: [\"status\"],\r\n    created() {\r\n        window.localStorage.removeItem('editManhourInfo');\r\n        this.query.status = this.status;\r\n        if (!this.query.status) {\r\n            this.query.status = '';\r\n        }\r\n        this.query.userId = this.userId;\r\n        this.getManhourApproverPage();\r\n    },\r\n    computed: {\r\n        ...mapGetters(['permissions', 'userId'])\r\n    },\r\n    methods: {\r\n        getManhourApproverPage() {\r\n            this.listLoading = true;\r\n            getManhourApproverPage(this.query)\r\n                .then(response => {\n                    console.log(response)\r\n                    this.listLoading = false;\r\n                    this.total = response.data.data.total;\r\n                    this.query.current = response.data.data.current;\r\n                    this.query.size = response.data.data.size;\r\n                    this.list = response.data.data.records;\r\n                    this.list.forEach(item => {\r\n                        this.$set(item, 'show', true);\r\n                        if (item.checkMin == null || item.checkMin == 0) {\r\n                            item.checkMin = item.useHour;\r\n                        }\r\n                        // console.log(item);\r\n                    });\r\n                })\r\n                .catch(() => {\r\n                    this.listLoading = false;\r\n                });\r\n        },\r\n        handleSizeChange(val) {\r\n            this.query.size = val;\r\n            this.getManhourApproverPage();\r\n        },\r\n        handleCurrentChange(val) {\r\n            this.query.current = val;\r\n            this.getManhourApproverPage();\r\n        },\r\n\r\n        // 通过审批\r\n        updateManhourApprover(val) {\r\n            if (this.list[val].checkMin == this.list[val].useHour - 2 || this.list[val].checkMin == 0) {\r\n                this.list[val].checkMin = this.list[val].useHour;\r\n            }\r\n            this.list[val].checkMin = parseFloat(this.list[val].checkMin);\r\n            this.$set(this.list[val], 'check', 1);\r\n            console.log(this.list[val]);\r\n            updateManhourApprover(this.list[val]).then(res => {\r\n                console.log(res);\r\n                this.getManhourApproverPage();\r\n            });\r\n        },\r\n\r\n        //  不通过审批\r\n        okUpdate(val) {\r\n            this.list[val].show = false;\r\n            if (this.list[val].checkMin == this.list[val].useHour - 2 || this.list[val].checkMin == 0) {\r\n                this.list[val].checkMin = this.list[val].useHour;\r\n            }\r\n            this.list[val].checkMin = parseFloat(this.list[val].checkMin);\r\n            this.$set(this.list[val], 'check', 2);\r\n            console.log(this.list[val]);\r\n            updateManhourApprover(this.list[val]).then(res => {\r\n                console.log(res);\r\n                this.getManhourApproverPage();\r\n            });\r\n        },\r\n\r\n        // 一键审批\r\n        // updateManhourAll() {\r\n        //     var Newlist = this.list.filter(item => item.status == 0);\r\n        //     for (var i = 0; i < Newlist.length; i++) {\r\n        //         if (Newlist[i].checkMin == Newlist[i].useHour - 2 || this.list[val].checkMin == 0) {\r\n        //             Newlist[i].checkMin = Newlist[i].useHour;\r\n        //         }\r\n        //     }\r\n        //     updateManhourApproverAll(Newlist).then(res => {\r\n        //         console.log(res);\r\n        //         this.getManhourApproverPage();\r\n        //         this.show = true;\r\n        //     });\r\n        // },\r\n        //  合并\r\n        flitterData(arr) {\r\n            let spanOneArr = [],\r\n                spanTwoArr = [],\r\n                spanThreeArr = [],\r\n                concatOne = 0,\r\n                concatTwo = 0,\r\n                concatThree = 0;\r\n            arr.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    spanOneArr.push(1);\r\n                    spanTwoArr.push(1);\r\n                    spanThreeArr.push(1);\r\n                } else {\r\n                    if (item.day === arr[index - 1].day) {\r\n                        //第一列需合并相同内容的判断条件\r\n                        spanOneArr[concatOne] += 1;\r\n                        spanOneArr.push(0);\r\n                    } else {\r\n                        spanOneArr.push(1);\r\n                        concatOne = index;\r\n                    }\r\n                    if (item.day === arr[index - 1].day && item.integral === arr[index - 1].integral && item.applyUserName === arr[index - 1].applyUserName) {\r\n                        //第二列需合并相同内容的判断条件\r\n                        spanTwoArr[concatTwo] += 1;\r\n                        spanTwoArr.push(0);\r\n                    } else {\r\n                        spanTwoArr.push(1);\r\n                        concatTwo = index;\r\n                    }\r\n                }\r\n            });\r\n            return {\r\n                one: spanOneArr,\r\n                two: spanTwoArr,\r\n                three: spanThreeArr\r\n            };\r\n        },\r\n\r\n        objectSpanMethod({ row, column, rowIndex, columnIndex }) {\r\n            // if (columnIndex === 0) {\r\n            //     const _row = this.flitterData(this.list).one[rowIndex];\r\n            //     const _col = _row > 0 ? 1 : 0;\r\n            //     return {\r\n            //         rowspan: _row,\r\n            //         colspan: _col\r\n            //     };\r\n            // }\r\n            // if (columnIndex === 1) {\r\n            //     const _row = this.flitterData(this.list).two[rowIndex];\r\n            //     const _col = _row > 0 ? 1 : 0;\r\n            //     return {\r\n            //         rowspan: _row,\r\n            //         colspan: _col\r\n            //     };\r\n            // }\r\n        }\r\n    },\r\n    mounted() {}\r\n};\r\n</script>\r\n<style type=\"text/scss\" lang=\"scss\"></style>\r\n"]}]}