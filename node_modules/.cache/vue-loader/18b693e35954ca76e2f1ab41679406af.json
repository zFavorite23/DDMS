{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\purchase\\purchaseApply\\Info.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\purchase\\purchaseApply\\Info.vue","mtime":1598236622730},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getPurchaseInfo, updatePurchaseApprover, getBusinessDept } from '../../../api/purchase/purchase.js';\nimport { mapGetters } from 'vuex';\nimport ElImageViewer from 'element-ui/packages/image/src/image-viewer';\n\nexport default {\n    components: { ElImageViewer },\n    data() {\n        return {\n            purchaseId: null,\n            purchaseInfo: '',\n            approverList: [],\n            url: '',\n            urls2: [],\n            showViewer: false, // 显示查看器\n            formData: {\n                userId: null,\n                approverId: null,\n                userId: null,\n                check: '1',\n                summary: '同意',\n                principalId: 91\n            },\n            query: {\n                deptId: 3100\n            },\n            rules: {\n                summary: [{ required: true, message: '请填写原因' }],\n                principalId: [{ required: true, message: '请选择采购负责人', trigger: 'change' }]\n            },\n            showCheck: false,\n            saving: false,\n            BusinessList: []\n        };\n    },\n    computed: {\n        ...mapGetters(['permissions', 'userId'])\n    },\n    created() {\n        this.purchaseId = this.$route.params.purchaseId;\n        this.getPurchaseInfo();\n        this.formData.userId = this.userId;\n        this.getBusinessDept(this.query);\n    },\n    methods: {\n        backHistory() {\n            this.$router.go(-1);\n        },\n        getPurchaseInfo() {\n            getPurchaseInfo(this.purchaseId).then(res => {\n                this.purchaseInfo = res.data.data;\n                console.log(this.purchaseInfo);\n                this.approverList = res.data.data.checkUserList;\n                this.approverList.forEach((item, index) => {\n                    if (item.check == 0 && item.isBeing == 1 && item.userId == this.formData.userId) {\n                        this.formData.approverId = item.approverId;\n                        this.showCheck = true;\n                    }\n                });\n                this.urls2 = [];\n                if (this.purchaseInfo.purchaseImg) {\n                    this.purchaseInfo.purchaseImg.split(',').forEach((item, index) => {\n                        if (item) {\n                            this.urls2.push(`${window.location.origin}/apply/purchase/` + item);\n                        }\n                    });\n                }\n            });\n        },\n        selectChcek() {\n            if (this.formData.check == 1) {\n                this.formData.summary = '同意';\n            } else {\n                this.formData.summary = '';\n            }\n        },\n        onSubmit() {\n            this.$refs['formData'].validate(valid => {\n                console.log(this.formData);\n\n                if (valid) {\n                    updatePurchaseApprover(this.formData)\n                        .then(res => {\n                            // console.log(res);\n                            if (res.data.data) {\n                                this.backHistory();\n                            }\n                        })\n                        .finally(() => {\n                            this.saving = false;\n                        });\n\n                    // console.log(this.formData);\n                }\n            });\n        },\n        getBusinessDept(id) {\n            getBusinessDept(id).then(res => {\n                // console.log(res);\n                res.data.data.forEach(item => {\n                    this.BusinessList.push({\n                        value: item.userId,\n                        label: item.username\n                    });\n                });\n            });\n        },\n        closeViewer() {\n            this.showViewer = false;\n            this.url = '';\n        },\n        onPreview2(val) {\n            this.url = this.urls2[val];\n            this.showViewer = true;\n        }\n    }\n};\n",null]}