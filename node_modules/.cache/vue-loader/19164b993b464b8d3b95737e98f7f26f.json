{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\purchase\\purchaseApply\\Form.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\purchase\\purchaseApply\\Form.vue","mtime":1594026542232},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getApplyUserInfo } from '../../../api/admin/user.js';\nimport { getPurchase } from '../../../api/purchase/purchase.js';\nimport { mapGetters } from 'vuex';\nexport default {\n    data() {\n        return {\n            query: {\n                companyId: null,\n                userId: null,\n                deptId: null,\n                itemId: null,\n                type: 6,\n                priceYuan: 0\n            },\n            formData: {\n                approverids: '',\n                name: '',\n                // 详细分类\n                type1: '',\n                type2: '',\n                type3: '',\n                // 数量\n                num: '',\n                // 单位\n                units: '',\n                // 单价\n                price: '',\n                // 总价\n                totalPrice: '',\n                // 预计到货时间\n                time: ''\n            },\n            uploadUrl: '',\n            fileList2: [],\n            applyUserList: [],\n            sumClassifyOptions: [],\n            mainClassifyOptions: [],\n            subClassifyOptions: []\n        };\n    },\n    created() {\n        this.getApplyUserInfo();\n        this.formData.userId = this.userId;\n        this.query.userId = this.userId;\n        this.getPurchase('100000', this.userId);\n        this.uploadUrl = `${window.location.origin}/purchase/form/upload`;\n    },\n    computed: {\n        ...mapGetters(['permissions', 'userId']),\n\n        // 计算总价\n        totalPrice: {\n            get() {\n                this.formData.totalPrice = this.formData.num * this.formData.price;\n                return this.formData.totalPrice;\n            },\n            set(value) {\n                this.formData.totalPrice = value;\n            }\n        }\n    },\n    methods: {\n        // 获取总类\n        getPurchase(id, userId) {\n            getPurchase(id, userId).then(res => {\n                console.log(res);\n                this.sumClassifyOptions = res.data.data.purchaseType;\n            });\n        },\n\n        // 主分类\n        classifyChange(val) {\n            (this.mainClassifyOptions = []), (this.subClassifyOptions = []);\n            getPurchase(val, this.query.userId).then(res => {\n                res.data.data.purchaseType.forEach(item => {\n                    this.mainClassifyOptions.push({\n                        value: item.id,\n                        label: item.name,\n                        children: item.children\n                    });\n                });\n            });\n        },\n\n        // 详情分类\n        classifyChange2(val) {\n            this.query.itemId = null;\n            this.formData.itemId = null;\n            getPurchase(val[0], this.query.userId).then(res => {\n                this.subClassifyOptions = res.data.data.purchaseType;\n            });\n\n            // 获取项目id\n            if (val.length > 1 && val.length < 3) {\n                this.query.itemId = val[1];\n                this.formData.itemId = val[1];\n                // this.getApplyUser();\n            } else if (val.length == 3) {\n                this.query.itemId = val[2];\n                this.formData.itemId = val[2];\n                // this.getApplyUser();\n            } else {\n                this.query.itemId = null;\n                this.formData.itemId = null;\n            }\n        },\n\n        getApplyUserInfo() {\n            getApplyUserInfo(this.query).then(response => {\n                this.applyUserList = [];\n                this.formData.approverids = null;\n                console.log(response);\n                response.data.data.forEach(element => {\n                    this.applyUserList.push({\n                        userId: element.userId,\n                        username: element.username,\n                        avatar: element.avatar\n                    });\n                    if (this.formData.approverids == null) {\n                        this.formData.approverids += element.userId;\n                    } else {\n                        this.formData.approverids += ',' + element.userId;\n                    }\n                });\n            });\n        },\n\n        handlePreview2(file) {\n            console.log(file);\n        },\n        handleRemove2(data) {\n            var serverUrl = `${window.location.origin}/purchase/form`;\n            const imgUrl = data.url.replace(serverUrl, '');\n            this.formData.invoiceImg = this.formData.invoiceImg.replace(imgUrl + ',', '');\n        },\n        handSuccess2(data) {\n            const imgInfo = data.data;\n            const imgUrl = imgInfo.bucketName + '-' + imgInfo.fileName;\n            this.formData.invoiceImg += imgUrl + ',';\n        },\n        beforeAvatarUpload: function(file) {\n            const isJPG = file.type === 'image/jpeg';\n            const isPNG = file.type === 'image/png';\n            const isPG = isJPG || isPNG; //限制图片格式为jpg / png\n            const isLt5M = file.size / 1024 / 1024 < 5; //限制图片大小\n            if (!isPG) {\n                this.$message.error('上传头像图片只能是 JPG 或 PNG 格式!');\n            }\n            if (!isLt5M) {\n                this.$message.error('上传头像图片大小不能超过 5MB!');\n            }\n            return isPG && isLt5M;\n        },\n\n        // 提交\n        onSubmit() {\n            console.log(this.formData);\n        },\n\n        // 取消\n        backHistory() {\n            this.$router.go(-1);\n        }\n    }\n};\n",null]}