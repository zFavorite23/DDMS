{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\apply\\expense\\Info.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\apply\\expense\\Info.vue","mtime":1598265289841},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { getExpenseInfo, updateExpress, affirmExpense, getExpenseApproverList, updateExpenseApprover } from '../../../api/apply/expense.js';\r\nimport { mapGetters } from 'vuex';\r\nimport ElImageViewer from 'element-ui/packages/image/src/image-viewer';\r\nexport default {\r\n    components: { ElImageViewer },\r\n    data() {\r\n        return {\r\n            dialogVisibleExpress: false,\r\n            dialogVisibleInvoice: false,\r\n            editExpressData: {\r\n                expenseId: null,\r\n                purchaseStatus: null,\r\n                expressName: '',\r\n                expressNum: ''\r\n            },\r\n            editInvoiceData: {\r\n                expenseId: null,\r\n                invoiceType: '',\r\n                taxRate: '',\r\n                invoiceImg: ''\r\n            },\r\n            purchaseStatusOptions: [\r\n                {\r\n                    value: '0',\r\n                    label: '未支付'\r\n                },\r\n                {\r\n                    value: '1',\r\n                    label: '已支付未发货'\r\n                },\r\n                {\r\n                    value: '2',\r\n                    label: '已发货'\r\n                },\r\n                {\r\n                    value: '3',\r\n                    label: '已签收'\r\n                },\r\n                {\r\n                    value: '4',\r\n                    label: '已支付无需发货'\r\n                }\r\n            ],\r\n            invoiceTypeOptions: [\r\n                {\r\n                    value: '0',\r\n                    label: '无发票'\r\n                },\r\n                {\r\n                    value: '1',\r\n                    label: '专票'\r\n                },\r\n                {\r\n                    value: '2',\r\n                    label: '普票'\r\n                }\r\n            ],\r\n            formData: {\r\n                approverId: null,\r\n                checkUserId: null,\r\n                check: '1',\r\n                summary: '同意'\r\n            },\r\n            expenseId: null,\r\n            expenseInfo: null,\r\n            listLoading: false,\r\n            list: [],\r\n            approverList: [],\r\n            ruleForm: {\r\n                check: '1',\r\n                desc: '同意'\r\n            },\r\n            rules: {\r\n                desc: [{ required: true, message: '请填写批注', trigger: 'blur' }],\r\n                purchaseStatus: [\r\n                    {\r\n                        required: true,\r\n                        message: '请选择采购状态',\r\n                        trigger: 'change'\r\n                    }\r\n                ],\r\n                expressName: [{ required: true, message: '请填写快递公司' }],\r\n                expressNum: [{ required: true, message: '请填写快递单号' }],\r\n                invoiceType: [\r\n                    {\r\n                        required: true,\r\n                        message: '请选择发票状态',\r\n                        trigger: 'change'\r\n                    }\r\n                ],\r\n                taxRate: [{ required: true, message: '请填写税率' }]\r\n            },\r\n            showViewer: false, // 显示查看器\r\n            url: '',\r\n            urls1: [],\r\n            urls2: [],\r\n            showCheck: false,\r\n            saving: false,\r\n            uploadUrl: '',\r\n            fileList1: []\r\n        };\r\n    },\r\n    computed: {\r\n        ...mapGetters(['permissions', 'userId', 'deptId'])\r\n    },\r\n    created() {\r\n        this.expenseId = this.$route.params.expenseId;\r\n        this.formData.checkUserId = this.userId;\r\n        this.getExpenseInfo();\r\n        this.getExpenseApproverList();\r\n        this.uploadUrl = `${window.location.origin}/apply/expense/upload`;\r\n    },\r\n    methods: {\r\n        getExpenseInfo() {\r\n            getExpenseInfo(this.expenseId).then(response => {\r\n                this.expenseInfo = response.data.data;\r\n                if (this.expenseInfo.invoiceImg) {\r\n                    this.expenseInfo.invoiceImg.split(',').forEach((item, index) => {\r\n                        if (item) {\r\n                            this.urls1.push(`${window.location.origin}/apply/expense/` + item);\r\n                        }\r\n                    });\r\n                }\r\n                if (this.expenseInfo.contract) {\r\n                    this.expenseInfo.contract.split(',').forEach((item, index) => {\r\n                        if (item) {\r\n                            this.urls2.push(`${window.location.origin}/apply/expense/` + item);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        getExpenseApproverList() {\r\n            getExpenseApproverList(this.expenseId).then(response => {\r\n                this.approverList = response.data.data;\r\n                this.approverList.forEach((item, index) => {\r\n                    if (item.check == '0' && item.isBeing == '1' && item.userId == this.formData.checkUserId) {\r\n                        this.formData.approverId = item.approverId;\r\n                        this.showCheck = true;\r\n                    }\r\n                });\r\n            });\r\n        },\r\n        backHistory() {\r\n            this.$router.go(-1);\r\n        },\r\n        onPreview1(val) {\r\n            this.url = this.urls1[val];\r\n            this.showViewer = true;\r\n        },\r\n        onPreview2(val) {\r\n            this.url = this.urls2[val];\r\n            this.showViewer = true;\r\n        },\r\n        closeViewer() {\r\n            this.showViewer = false;\r\n            this.url = '';\r\n        },\r\n        selectChcek() {\r\n            if (this.formData.check == 1) {\r\n                this.formData.summary = '同意';\r\n            } else {\r\n                this.formData.summary = '';\r\n            }\r\n        },\r\n        onSubmit() {\r\n            updateExpenseApprover(this.formData)\r\n                .then(res => {\r\n                    if (res.data.data) {\r\n                        this.backHistory();\r\n                    }\r\n                })\r\n                .finally(() => {\r\n                    this.saving = false;\r\n                });\r\n        },\r\n        selectPurchaseStatus(val) {\r\n            // if (val == 2 || val == 3){\r\n            //     console.log(val)\r\n            // }\r\n        },\r\n        selectInvoiceType(val) {},\r\n        handleModal(data) {\r\n            this.editExpressData.expenseId = data.expenseId;\r\n            this.editExpressData.purchaseStatus = data.purchaseStatus;\r\n            this.editExpressData.expressName = data.expressName;\r\n            this.editExpressData.expressNum = data.expressNum;\r\n            this.dialogVisibleExpress = true;\r\n        },\r\n        handleModalInvoice(data) {\r\n            this.editInvoiceData.expenseId = data.expenseId;\r\n            this.editInvoiceData.invoiceType = data.invoiceType;\r\n            this.editInvoiceData.taxRate = data.taxRate;\r\n            this.editInvoiceData.invoiceImg = data.invoiceImg;\r\n            if (data.invoiceImg) {\r\n                data.invoiceImg.split(',').forEach((item, index) => {\r\n                    if (item) {\r\n                        this.fileList1.push({\r\n                            url: `${window.location.origin}/apply/expense/` + item\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n            this.dialogVisibleInvoice = true;\r\n        },\r\n        handleSubmit() {\r\n            this.$refs['editExpressData'].validate(valid => {\r\n                if (valid) {\r\n                    updateExpress(this.editExpressData)\r\n                        .then(res => {\r\n                            if (res.data.data) {\r\n                                this.dialogVisibleExpress = false;\r\n                                this.getExpenseInfo();\r\n                            }\r\n                        })\r\n                        .finally(() => {});\r\n                }\r\n            });\r\n        },\r\n        handleSubmitInvoice() {\r\n            this.$refs['editInvoiceData'].validate(valid => {\r\n                if (valid) {\r\n                    updateExpress(this.editInvoiceData)\r\n                        .then(res => {\r\n                            if (res.data.data) {\r\n                                this.dialogVisibleInvoice = false;\r\n                                this.getExpenseInfo();\r\n                            }\r\n                        })\r\n                        .finally(() => {});\r\n                }\r\n            });\r\n        },\r\n        beforeAvatarUpload: function(file) {\r\n            const isJPG = file.type === 'image/jpeg';\r\n            const isPNG = file.type === 'image/png';\r\n            const isPG = isJPG || isPNG; //限制图片格式为jpg / png\r\n            const isLt5M = file.size / 1024 / 1024 < 5; //限制图片大小\r\n            if (!isPG) {\r\n                this.$message.error('图片只能是 JPG 或 PNG 格式!');\r\n            }\r\n            if (!isLt5M) {\r\n                this.$message.error('图片大小不能超过 5MB!');\r\n            }\r\n            return isPG && isLt5M;\r\n        },\r\n        handleRemove1(data) {\r\n            const imgInfo = data.response.data;\r\n            const imgUrl = imgInfo.bucketName + '-' + imgInfo.fileName;\r\n            this.editInvoiceData.invoiceImg = this.editInvoiceData.invoiceImg.replace(imgUrl + ',', '');\r\n            //console.log(this.editInvoiceData.invoiceImg)\r\n        },\r\n        handlePreview1(file) {\r\n            console.log(file);\r\n        },\r\n        handSuccess1(data) {\r\n            const imgInfo = data.data;\r\n            const imgUrl = imgInfo.bucketName + '-' + imgInfo.fileName;\r\n            this.editInvoiceData.invoiceImg += imgUrl + ',';\r\n            //console.log(this.editInvoiceData.invoiceImg)\r\n        },\r\n        handleModalAffirm(data) {\r\n            //console.log(data)\r\n            if (data.expenseId) {\r\n                this.$confirm('确认收到发票了吗?', '提示', {\r\n                    type: 'warning'\r\n                }).then(() => {\r\n                    const editData = {\r\n                        expenseId: data.expenseId,\r\n                        isAffirm: '1'\r\n                    };\r\n                    affirmExpense(editData).then(res => {\r\n                        if (res.data.data) {\r\n                            this.getExpenseInfo();\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        }\r\n    }\r\n};\r\n",null]}