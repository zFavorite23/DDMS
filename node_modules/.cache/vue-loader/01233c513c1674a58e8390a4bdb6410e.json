{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\checkwork\\My.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\checkwork\\My.vue","mtime":1596020304163},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { getPageList, getStatisticsUserId, clockMigration } from '../../api/checkwork/clock.js';\r\nimport { dateFormat } from '../../utils/date.js';\r\nimport { mapGetters } from 'vuex';\r\nexport default {\r\n    data() {\r\n        return {\r\n            query: {\r\n                selectMonth: dateFormat(new Date()).substr(0, 7),\r\n                userId: '',\r\n                current: 1,\r\n                size: 10\r\n            },\r\n            expireTimeOption: {\r\n                disabledDate: time => {\r\n                    var date = new Date();\r\n                    var year = date.getFullYear();\r\n                    var month = date.getMonth() + 1;\r\n                    if (month >= 1 && month <= 9) {\r\n                        month = '0' + month;\r\n                    }\r\n                    var currentdate = year.toString() + month.toString();\r\n                    var timeyear = time.getFullYear();\r\n                    var timemonth = time.getMonth() + 1;\r\n                    if (timemonth >= 1 && timemonth <= 9) {\r\n                        timemonth = '0' + timemonth;\r\n                    }\r\n                    var timedate = timeyear.toString() + timemonth.toString();\r\n                    return currentdate < timedate;\r\n                }\r\n            },\r\n            pages: 0,\r\n            total: 0,\r\n            listLoading: false,\r\n            list: [],\r\n            number: '',\r\n            arr1: [],\r\n            userStatisticsInfo: {\r\n                userName: ''\r\n            }\r\n        };\r\n    },\r\n    created() {\r\n        this.getClockList();\r\n        this.query.userId = this.userId;\r\n        this.getStatisticsUserId();\r\n    },\r\n    computed: {\r\n        ...mapGetters(['permissions', 'userId'])\r\n    },\r\n    mounted() {},\r\n    methods: {\r\n        open() {},\r\n        setdates(arr) {\r\n            var obj = {},\r\n                k,\r\n                arr1 = [];\r\n            for (var i = 0, len = arr.length; i < len; i++) {\r\n                k = arr[i].day;\r\n                if (obj[k]) obj[k]++;\r\n                else obj[k] = 1;\r\n            }\r\n            //console.log(obj)\r\n            //保存结果{el-'元素'，count-出现次数}\r\n            for (var o in obj) {\r\n                for (let i = 0; i < obj[o]; i++) {\r\n                    if (i === 0) {\r\n                        this.arr1.push(obj[o]);\r\n                    } else {\r\n                        this.arr1.push(0);\r\n                    }\r\n                }\r\n            }\r\n            //console.log(this.arr1);\r\n        },\r\n        objectSpanMethod({ row, column, rowIndex, columnIndex }) {\r\n            if (columnIndex === 0) {\r\n                let _row = this.arr1[rowIndex];\r\n                let _col = this.arr1[rowIndex] > 0 ? 1 : 0;\r\n                return [_row, _col];\r\n            }\r\n        },\r\n\r\n        getClockList() {\r\n            this.listLoading = true;\r\n            getPageList(this.query)\r\n                .then(response => {\r\n                    console.log(response);\r\n                    this.listLoading = false;\r\n                    this.total = response.data.data.total;\r\n                    this.query.current = response.data.data.current;\r\n                    this.query.size = response.data.data.size;\r\n                    this.list = response.data.data.records;\r\n                    this.setdates(this.list);\r\n                    // 当前减去7天的日期\r\n                    var time = new Date().setDate(new Date().getDate() - 7);\r\n                    var date = new Date(time);\r\n                    const Y = date.getFullYear() + '-';\r\n                    const M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';\r\n                    const D = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();\r\n                    var time_2 = Y + M + D;\r\n                    let reg = new RegExp('-', 'g');\r\n\r\n                    this.list.forEach(item => {\r\n                        if (item.status == 2 || item.status == 3 || item.status == 4) {\r\n                            this.$set(item, 'isShow', false);\r\n                        }\r\n                        if (new Date(item.day.replace(reg, '/')) < new Date(time_2.replace(reg, '/'))) {\r\n                            item.isShow = true;\r\n                        }\r\n                    });\r\n\r\n                    // console.log(this.list);\r\n                    // this.getStatisticsUserId();\r\n                })\r\n                .catch(() => {\r\n                    this.listLoading = false;\r\n                });\r\n        },\r\n        getClockMigration() {\r\n            clockMigration().then(response => {});\r\n        },\r\n        getStatisticsUserId() {\r\n            getStatisticsUserId(this.query).then(response => {\r\n                this.userStatisticsInfo = response.data.data;\r\n                console.log(this.userStatisticsInfo);\r\n                var a = this.userStatisticsInfo.normalNum == null ? +0 + ' 次' : this.userStatisticsInfo.normalNum + ' 次';\r\n                var b = this.userStatisticsInfo.lateNum == null ? +0 + ' 次' : this.userStatisticsInfo.lateNum + ' 次';\r\n                var c = this.userStatisticsInfo.earlyNum == null ? +0 + ' 次' : this.userStatisticsInfo.earlyNum + ' 次';\r\n                var d = this.userStatisticsInfo.absenteeismNum == null ? +0 + ' 次' : this.userStatisticsInfo.absenteeismNum + ' 次';\r\n                var e = this.userStatisticsInfo.businesstripNum == null ? +0 + ' 天' : this.userStatisticsInfo.businesstripNum + ' 天';\r\n                var f = this.userStatisticsInfo.leaveNum == null ? +0 + ' 小时' : this.userStatisticsInfo.leaveNum + ' 小时';\r\n                var g = this.userStatisticsInfo.gooutNum == null ? +0 + ' 小时' : this.userStatisticsInfo.gooutNum + ' 小时';\r\n                content = ['姓名：' + this.userStatisticsInfo.userName, '正常：' + a, '迟到：' + b, '早退：' + c, '旷工：' + d, '出差：' + e, '请假：' + f, '外出：' + g];\r\n                console.log(content);\r\n                let content = content;\r\n                let newDatas = [];\r\n                const h = this.$createElement;\r\n                for (let i in content) {\r\n                    newDatas.push(h('p', null, content[i]));\r\n                }\r\n                this.$alert(h('div', null, newDatas), '当月小计');\r\n            });\r\n        },\r\n        formatType: function(row) {\r\n            return row.type == 1 ? '上班' : row.type == 2 ? '下班' : '未知';\r\n        },\r\n        formatType2: function(row) {\r\n            return row.type == 1 ? '' : row.type == 2 ? row.min : '';\r\n        },\r\n        // 单独处理时间的函数\r\n        dealDisabledDate(time) {\r\n            return time.getTime() >= Date.now();\r\n        },\r\n        handleSizeChange(val) {\r\n            this.query.size = val;\r\n            this.getClockList();\r\n        },\r\n        handleCurrentChange(val) {\r\n            this.query.current = val;\r\n            this.getClockList();\r\n        },\r\n        composeValue(item, row) {\r\n            return {\r\n                button: item,\r\n                row: row\r\n            };\r\n        },\r\n\r\n        handleCommand(command) {\r\n            //this.$message('click on item ' + command);\r\n\r\n            window.localStorage.setItem('applyClockInfo', JSON.stringify(command.row));\r\n            if (command.button == 1) {\r\n                this.$router.push({\r\n                    path: '/apply/clock/form'\r\n                });\r\n            }\r\n            if (command.button == 2) {\r\n                this.$router.push({\r\n                    path: '/apply/goout/form'\r\n                });\r\n            }\r\n            if (command.button == 3) {\r\n                this.$router.push({\r\n                    path: '/apply/leave/form'\r\n                });\r\n            }\r\n        }\r\n    }\r\n};\r\n",null]}