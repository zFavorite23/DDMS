{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\apply\\invoice\\Info.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\apply\\invoice\\Info.vue","mtime":1595215651069},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { getInvoiceInfo, affirmInvoice, getInvoiceApproverList, updateInvoiceApprover, getInvoiceRefuse } from '../../../api/apply/invoice.js';\r\nimport { print } from '../../../utils/utils';\r\nimport { mapGetters } from 'vuex';\r\n\r\nimport ElImageViewer from 'element-ui/packages/image/src/image-viewer';\r\nimport moment from 'moment';\r\nexport default {\r\n    components: { ElImageViewer },\r\n    data() {\r\n        return {\r\n            formData: {\r\n                approverId: null,\r\n                checkUserId: null,\r\n                check: '1',\r\n                summary: '同意'\r\n            },\r\n            invoiceInfo: {\r\n                applyUserName: '',\r\n                invoiceTime: ''\r\n            },\r\n            invoiceId: null,\r\n            createTime: null,\r\n            listLoading: false,\r\n            list: [],\r\n            approverList: [],\r\n            rules: {\r\n                summary: [{ required: true, message: '请填写原因' }]\r\n            },\r\n            previewTime: '',\r\n            previewList: [],\r\n            checkUser1: '',\r\n            checkUser2: '',\r\n            checkUser3: '',\r\n            applyUser: '',\r\n            showCheck: false,\r\n            saving: false,\r\n            url: '',\r\n            urls1: [],\r\n            urls2: [],\r\n            showViewer: false, // 显示查看器\r\n            RefuseInfo: []\r\n        };\r\n    },\r\n    computed: {\r\n        ...mapGetters(['permissions', 'userId', 'deptId'])\r\n    },\r\n    created() {\r\n        this.invoiceId = this.$route.params.invoiceId;\r\n        this.formData.checkUserId = this.userId;\r\n        this.getInvoiceInfo();\r\n        this.getInvoiceRefuse();\r\n        // window.addEventListener('beforeunload', e => this.beforeunloadFn(e))\r\n    },\r\n    methods: {\r\n        getInvoiceRefuse() {\r\n            getInvoiceRefuse(this.invoiceId).then(res => {\r\n                console.log(res);\r\n                this.RefuseInfo = res.data.data;\r\n            });\r\n        },\r\n        getInvoiceInfo() {\r\n            getInvoiceInfo(this.invoiceId).then(response => {\r\n                this.invoiceInfo = response.data.data;\r\n                console.log(this.invoiceInfo);\r\n                this.invoiceInfo.invoiceTimeCh = moment(this.invoiceInfo.invoiceTime).format('YYYY年MM月DD日');\r\n                this.invoiceInfo.payTimeCh = moment(this.invoiceInfo.payTime).format('YYYY年MM月DD日');\r\n                this.urls1 = [];\r\n                this.urls2 = [];\r\n                if (this.invoiceInfo.payImg) {\r\n                    this.invoiceInfo.payImg.split(',').forEach((item, index) => {\r\n                        if (item) {\r\n                            this.urls1.push(`${window.location.origin}/apply/invoice/` + item);\r\n                        }\r\n                    });\r\n                }\r\n                if (this.invoiceInfo.invoiceImg) {\r\n                    this.invoiceInfo.invoiceImg.split(',').forEach((item, index) => {\r\n                        if (item) {\r\n                            this.urls2.push(`${window.location.origin}/apply/invoice/` + item);\r\n                        }\r\n                    });\r\n                }\r\n\r\n                if (this.invoiceInfo.type1 == 22 || this.invoiceInfo.type1 == 10) {\r\n                    this.checkUser1 = '王铮';\r\n                    this.checkUser3 = '王海清';\r\n                    this.applyUser = '李长霖';\r\n                } else {\r\n                    this.applyUser = this.invoiceInfo.applyUserName;\r\n                }\r\n\r\n                this.getInvoiceApproverList();\r\n            });\r\n        },\r\n        getInvoiceApproverList() {\r\n            getInvoiceApproverList(this.invoiceId).then(response => {\r\n                // console.log(response);\r\n                this.approverList = response.data.data;\r\n                this.approverList.forEach((item, index) => {\r\n                    if (item.check == 0 && item.isBeing == 1 && item.userId == this.formData.checkUserId) {\r\n                        this.formData.approverId = item.approverId;\r\n                        this.showCheck = true;\r\n                    }\r\n                });\r\n                if (this.invoiceInfo.status == 1) {\r\n                    if (this.approverList.length == 2) {\r\n                        this.checkUser1 = this.approverList[0].checkUserName;\r\n                        this.checkUser3 = this.approverList[1].checkUserName;\r\n                    }\r\n                    if (this.approverList.length == 3) {\r\n                        this.checkUser1 = this.approverList[0].checkUserName;\r\n                        this.checkUser2 = this.approverList[1].checkUserName;\r\n                        this.checkUser3 = this.approverList[2].checkUserName;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        selectChcek() {\r\n            if (this.formData.check == 1) {\r\n                this.formData.summary = '同意';\r\n            } else {\r\n                this.formData.summary = '';\r\n            }\r\n        },\r\n        onSubmit() {\r\n            this.$confirm('请审批人审核发票信息、报销内容、项目名称后再同意，一经同意后流程不能逆转。', '温馨提示：', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning',\r\n                showClose: false\r\n            })\r\n                .then(() => {\r\n                    updateInvoiceApprover(this.formData)\r\n                        .then(res => {\r\n                            // console.log(res);\r\n                            if (res.data.data) {\r\n                                this.backHistory();\r\n                            }\r\n                        })\r\n                        .finally(() => {\r\n                            this.saving = false;\r\n                        });\r\n                })\r\n                .catch(() => {\r\n                    this.saving = false;\r\n                });\r\n\r\n            // console.log(this.formData);\r\n        },\r\n        backHistory() {\r\n            this.$router.go(-1);\r\n        },\r\n        onPreview1(index) {\r\n            // this.url = this.urls1[val];\r\n            // this.showViewer = true;\r\n            let arr = [];\r\n            let i = 0;\r\n            for (i; i < this.urls1.length; i++) {\r\n                arr.push(this.urls1[i + index]);\r\n                if (i + index >= this.urls1.length - 1) {\r\n                    index = 0 - (i + 1);\r\n                }\r\n            }\r\n            return arr;\r\n        },\r\n        closeViewer() {\r\n            this.showViewer = false;\r\n            this.url = '';\r\n        },\r\n        onPreview2(index) {\r\n            // this.url = this.urls2[val];\r\n            // this.showViewer = true;\r\n            let arr = [];\r\n            let i = 0;\r\n            for (i; i < this.urls2.length; i++) {\r\n                arr.push(this.urls2[i + index]);\r\n                if (i + index >= this.urls2.length - 1) {\r\n                    index = 0 - (i + 1);\r\n                }\r\n            }\r\n            return arr;\r\n        },\r\n        print(e) {\r\n            // this.remove();\r\n            // let subOutputRankPrint = document.getElementById('printContent');\r\n            // let newContent =subOutputRankPrint.innerHTML;\r\n            // let oldContent = document.body.innerHTML;\r\n            // document.body.innerHTML = newContent;\r\n            // window.print();\r\n            // // window.location.reload();\r\n            // document.body.innerHTML = oldContent;\r\n            // return false;\r\n            this.remove();\r\n            const windows = print(document.getElementById('printContent').innerHTML);\r\n            windows.close();\r\n        },\r\n        remove() {\r\n            document.getElementById('line').style.display = 'block';\r\n            document.getElementById('cont').style.display = 'block';\r\n            var hkey_path;\r\n            hkey_path = 'HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Internet Explorer\\\\PageSetup\\\\';\r\n            try {\r\n                var RegWsh = new ActiveXObject('WScript.Shell');\r\n                RegWsh.RegWrite(hkey_path + 'header', '');\r\n                RegWsh.RegWrite(hkey_path + 'footer', '');\r\n            } catch (e) {}\r\n        },\r\n        handleModalAffirm(data) {\r\n            //console.log(data)\r\n\r\n            if (data.invoiceId) {\r\n                this.$confirm('确认收到发票了吗?', '提示', {\r\n                    type: 'warning'\r\n                }).then(() => {\r\n                    const editData = {\r\n                        invoiceId: data.invoiceId,\r\n                        isAffirm: '1'\r\n                    };\r\n                    affirmInvoice(editData).then(res => {\r\n                        if (res.data.data) {\r\n                            this.getInvoiceInfo();\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        }\r\n    }\r\n    // mounted:{\r\n    // window.addEventListener('beforeunload', e => this.beforeunloadFn(e))\r\n    // }\r\n};\r\n",null]}