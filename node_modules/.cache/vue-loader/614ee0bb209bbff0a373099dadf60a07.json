{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\other\\Role.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\other\\Role.vue","mtime":1588235430072},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {\r\n    getPageList,\r\n    addRole,\r\n    updateRole,\r\n    deleteRole,\r\n    permissionUpd,\r\n    fetchRoleTree\r\n} from \"../../api/other/role.js\";\r\nimport { fetchMenuTree } from \"../../api/other/menu.js\";\r\nimport { mapGetters } from \"vuex\";\r\nexport default {\r\n    data() {\r\n        return {\r\n            query: {\r\n                current: 1,\r\n                size: 10\r\n            },\r\n            pages: 0,\r\n            total: 0,\r\n            defaultImg: \"\",\r\n            deptOptions: [],\r\n            roleList: [\r\n                {\r\n                    value: \"1\",\r\n                    label: \"管理员\"\r\n                }\r\n            ],\r\n            pickerOptions: {\r\n                disabledDate: time => {\r\n                    return this.dealDisabledDate(time);\r\n                }\r\n            },\r\n            dialogTitle: \"\",\r\n            listLoading: false,\r\n            dialogVisible: false,\r\n            saving: false,\r\n            list: [],\r\n            role_btn_add: false,\r\n            role_btn_edit: false,\r\n            role_btn_del: false,\r\n            role_btn_perm: false,\r\n            formData: {\r\n                newData: true,\r\n                roleId: \"\",\r\n                roleName: \"\",\r\n                roleCode: \"\",\r\n                roleDesc: \"\",\r\n                dsType: 2\r\n            },\r\n            treeData: [],\r\n            checkedKeys: [],\r\n            checkedDsScope: [],\r\n            defaultProps: {\r\n                label: \"name\",\r\n                value: \"id\"\r\n            },\r\n            roleId: undefined,\r\n            roleCode: undefined,\r\n            rolesOptions: undefined,\r\n            dialogPermissionVisible: false,\r\n            rules: {\r\n                roleName: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入角色名称\",\r\n                        trigger: \"blur\"\r\n                    }\r\n                ],\r\n                roleCode: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入角色标识\",\r\n                        trigger: \"blur\"\r\n                    }\r\n                ],\r\n                roleDesc: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入角色描述\",\r\n                        trigger: \"blur\"\r\n                    }\r\n                ]\r\n            }\r\n        };\r\n    },\r\n    created() {\r\n        this.getRoleList();\r\n        this.role_btn_add = this.permissions[\"sys_role_add\"];\r\n        this.role_btn_edit = this.permissions[\"sys_role_edit\"];\r\n        this.role_btn_del = this.permissions[\"sys_role_del\"];\r\n        this.role_btn_perm = this.permissions[\"sys_role_perm\"];\r\n    },\r\n    computed: {\r\n        ...mapGetters([\"permissions\"])\r\n    },\r\n    methods: {\r\n        getRoleList() {\r\n            this.loading = true;\r\n            getPageList(this.query)\r\n                .then(response => {\r\n                    this.loading = false;\r\n                    //console.log(response.data.data.records)\r\n                    this.total = response.data.data.total;\r\n                    this.query.current = response.data.data.current;\r\n                    this.query.size = response.data.data.size;\r\n                    this.list = response.data.data.records;\r\n                })\r\n                .catch(() => {\r\n                    this.loading = false;\r\n                });\r\n        },\r\n        handleModal(data) {\r\n            if (data) {\r\n                this.dialogTitle = \"编辑角色 - \" + data.roleName;\r\n                this.formData.newData = false;\r\n                this.formData.roleId = data.roleId;\r\n                this.formData.roleName = data.roleName;\r\n                this.formData.roleCode = data.roleCode;\r\n                this.formData.roleDesc = data.roleDesc;\r\n            } else {\r\n                this.dialogTitle = \"添加角色\";\r\n                this.formData.newData = true;\r\n                this.formData.roleId = \"\";\r\n                this.formData.roleName = \"\";\r\n                this.formData.roleCode = \"\";\r\n                this.formData.roleDesc = \"\";\r\n            }\r\n            this.dialogVisible = true;\r\n        },\r\n        // 单独处理时间的函数\r\n        dealDisabledDate(time) {\r\n            return time.getTime() >= Date.now();\r\n        },\r\n        handleSizeChange(val) {\r\n            this.query.size = val;\r\n            this.getRoleList();\r\n        },\r\n        handleCurrentChange(val) {\r\n            this.query.current = val;\r\n            this.getRoleList();\r\n        },\r\n        selsChange: function(sels) {\r\n            this.sels = sels;\r\n        },\r\n        handleSubmit() {\r\n            this.$refs[\"formData\"].validate(valid => {\r\n                if (valid) {\r\n                    this.saving = true;\r\n                    if (!this.formData.newData) {\r\n                        updateRole(this.formData)\r\n                            .then(res => {\r\n                                if (res.data.data) {\r\n                                    this.dialogVisible = false;\r\n                                    this.getRoleList();\r\n                                }\r\n                            })\r\n                            .finally(() => {\r\n                                this.saving = false;\r\n                            });\r\n                    } else {\r\n                        addRole(this.formData)\r\n                            .then(res => {\r\n                                if (res.data.data) {\r\n                                    this.dialogVisible = false;\r\n                                    this.getRoleList();\r\n                                }\r\n                            })\r\n                            .finally(() => {\r\n                                this.saving = false;\r\n                            });\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        // 删除\r\n        handleDel(index, row) {\r\n            if (row.roleId) {\r\n                this.$confirm(\"确认删除 \" + row.roleName + \" 吗?\", \"提示\", {\r\n                    type: \"warning\"\r\n                }).then(() => {\r\n                    deleteRole(row.roleId).then(res => {\r\n                        if (res.data.data) {\r\n                            this.getRoleList();\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        },\r\n        handlePermission(index, row) {\r\n            if (row.roleId) {\r\n                fetchRoleTree(row.roleId)\r\n                    .then(response => {\r\n                        this.checkedKeys = response.data.data;\r\n                        return fetchMenuTree();\r\n                    })\r\n                    .then(response => {\r\n                        this.treeData = response.data.data;\r\n                        //console.log(this.treeData)\r\n                        // 解析出所有的太监节点\r\n                        this.checkedKeys = this.resolveAllEunuchNodeId(\r\n                            this.treeData,\r\n                            this.checkedKeys,\r\n                            []\r\n                        );\r\n                        this.dialogPermissionVisible = true;\r\n                        this.roleId = row.roleId;\r\n                        this.roleCode = row.roleCode;\r\n                    });\r\n            }\r\n        },\r\n        /**\r\n         * 解析出所有的太监节点id\r\n         * @param json 待解析的json串\r\n         * @param idArr 原始节点数组\r\n         * @param temp 临时存放节点id的数组\r\n         * @return 太监节点id数组\r\n         */\r\n        resolveAllEunuchNodeId(json, idArr, temp) {\r\n            for (let i = 0; i < json.length; i++) {\r\n                const item = json[i];\r\n                // 存在子节点，递归遍历;不存在子节点，将json的id添加到临时数组中\r\n                if (item.children && item.children.length !== 0) {\r\n                    this.resolveAllEunuchNodeId(item.children, idArr, temp);\r\n                } else {\r\n                    temp.push(idArr.filter(id => id === item.id));\r\n                }\r\n            }\r\n            return temp;\r\n        },\r\n        filterNode(value, data) {\r\n            if (!value) return true;\r\n            return data.label.indexOf(value) !== -1;\r\n        },\r\n        getNodeData(data, done) {\r\n            done();\r\n        },\r\n        cancal() {\r\n            this.dialogPermissionVisible = false;\r\n        },\r\n        updatePermession(roleId) {\r\n            this.menuIds = \"\";\r\n            this.menuIds = this.$refs.menuTree\r\n                .getCheckedKeys()\r\n                .join(\",\")\r\n                .concat(\",\")\r\n                .concat(this.$refs.menuTree.getHalfCheckedKeys().join(\",\"));\r\n            permissionUpd(roleId, this.menuIds).then(() => {\r\n                this.dialogPermissionVisible = false;\r\n                //this.$store.dispatch('GetMenu', false)\r\n                this.$notify.success(\"修改成功\");\r\n            });\r\n        }\r\n    },\r\n    mounted() {}\r\n};\r\n",null]}