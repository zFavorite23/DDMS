{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\apply\\manhour\\Approver.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\apply\\manhour\\Approver.vue","mtime":1597025146945},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { getManhourApproverPage, updateManhourApprover, updateManhourApproverAll } from '../../../api/apply/manhour.js';\r\n// import {getUserInfo} from \"../../../api/admin/user.js\";\r\nimport { mapGetters } from 'vuex';\r\nexport default {\r\n    data() {\r\n        return {\r\n            show: '',\r\n            statusOptions: [\r\n                {\r\n                    value: '',\r\n                    label: '全部'\r\n                },\r\n                {\r\n                    value: '0',\r\n                    label: '审批中'\r\n                },\r\n                {\r\n                    value: '1',\r\n                    label: '同意'\r\n                },\r\n                {\r\n                    value: '2',\r\n                    label: '拒绝'\r\n                }\r\n            ],\r\n            query: {\r\n                userId: null,\r\n                status: '',\r\n                current: 1,\r\n                size: 10\r\n            },\r\n            pages: 0,\r\n            total: 0,\r\n            listLoading: false,\r\n            list: [],\r\n            number: '',\r\n            listType: '2'\r\n        };\r\n    },\r\n    props: [\"status\"],\r\n    created() {\r\n        window.localStorage.removeItem('editManhourInfo');\r\n        this.query.status = this.status;\r\n        if (!this.query.status) {\r\n            this.query.status = '';\r\n        }\r\n        this.query.userId = this.userId;\r\n        this.getManhourApproverPage();\r\n    },\r\n    computed: {\r\n        ...mapGetters(['permissions', 'userId'])\r\n    },\r\n    methods: {\r\n        getManhourApproverPage() {\r\n            this.listLoading = true;\r\n            getManhourApproverPage(this.query)\r\n                .then(response => {\n                    console.log(response)\r\n                    this.listLoading = false;\r\n                    this.total = response.data.data.total;\r\n                    this.query.current = response.data.data.current;\r\n                    this.query.size = response.data.data.size;\r\n                    this.list = response.data.data.records;\r\n                    this.list.forEach(item => {\r\n                        this.$set(item, 'show', true);\r\n                        if (item.checkMin == null || item.checkMin == 0) {\r\n                            item.checkMin = item.useHour;\r\n                        }\r\n                        // console.log(item);\r\n                    });\r\n                })\r\n                .catch(() => {\r\n                    this.listLoading = false;\r\n                });\r\n        },\r\n        handleSizeChange(val) {\r\n            this.query.size = val;\r\n            this.getManhourApproverPage();\r\n        },\r\n        handleCurrentChange(val) {\r\n            this.query.current = val;\r\n            this.getManhourApproverPage();\r\n        },\r\n\r\n        // 通过审批\r\n        updateManhourApprover(val) {\r\n            if (this.list[val].checkMin == this.list[val].useHour - 2 || this.list[val].checkMin == 0) {\r\n                this.list[val].checkMin = this.list[val].useHour;\r\n            }\r\n            this.list[val].checkMin = parseFloat(this.list[val].checkMin);\r\n            this.$set(this.list[val], 'check', 1);\r\n            console.log(this.list[val]);\r\n            updateManhourApprover(this.list[val]).then(res => {\r\n                console.log(res);\r\n                this.getManhourApproverPage();\r\n            });\r\n        },\r\n\r\n        //  不通过审批\r\n        okUpdate(val) {\r\n            this.list[val].show = false;\r\n            if (this.list[val].checkMin == this.list[val].useHour - 2 || this.list[val].checkMin == 0) {\r\n                this.list[val].checkMin = this.list[val].useHour;\r\n            }\r\n            this.list[val].checkMin = parseFloat(this.list[val].checkMin);\r\n            this.$set(this.list[val], 'check', 2);\r\n            console.log(this.list[val]);\r\n            updateManhourApprover(this.list[val]).then(res => {\r\n                console.log(res);\r\n                this.getManhourApproverPage();\r\n            });\r\n        },\r\n\r\n        // 一键审批\r\n        // updateManhourAll() {\r\n        //     var Newlist = this.list.filter(item => item.status == 0);\r\n        //     for (var i = 0; i < Newlist.length; i++) {\r\n        //         if (Newlist[i].checkMin == Newlist[i].useHour - 2 || this.list[val].checkMin == 0) {\r\n        //             Newlist[i].checkMin = Newlist[i].useHour;\r\n        //         }\r\n        //     }\r\n        //     updateManhourApproverAll(Newlist).then(res => {\r\n        //         console.log(res);\r\n        //         this.getManhourApproverPage();\r\n        //         this.show = true;\r\n        //     });\r\n        // },\r\n        //  合并\r\n        flitterData(arr) {\r\n            let spanOneArr = [],\r\n                spanTwoArr = [],\r\n                spanThreeArr = [],\r\n                concatOne = 0,\r\n                concatTwo = 0,\r\n                concatThree = 0;\r\n            arr.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    spanOneArr.push(1);\r\n                    spanTwoArr.push(1);\r\n                    spanThreeArr.push(1);\r\n                } else {\r\n                    if (item.day === arr[index - 1].day) {\r\n                        //第一列需合并相同内容的判断条件\r\n                        spanOneArr[concatOne] += 1;\r\n                        spanOneArr.push(0);\r\n                    } else {\r\n                        spanOneArr.push(1);\r\n                        concatOne = index;\r\n                    }\r\n                    if (item.day === arr[index - 1].day && item.integral === arr[index - 1].integral && item.applyUserName === arr[index - 1].applyUserName) {\r\n                        //第二列需合并相同内容的判断条件\r\n                        spanTwoArr[concatTwo] += 1;\r\n                        spanTwoArr.push(0);\r\n                    } else {\r\n                        spanTwoArr.push(1);\r\n                        concatTwo = index;\r\n                    }\r\n                }\r\n            });\r\n            return {\r\n                one: spanOneArr,\r\n                two: spanTwoArr,\r\n                three: spanThreeArr\r\n            };\r\n        },\r\n\r\n        objectSpanMethod({ row, column, rowIndex, columnIndex }) {\r\n            // if (columnIndex === 0) {\r\n            //     const _row = this.flitterData(this.list).one[rowIndex];\r\n            //     const _col = _row > 0 ? 1 : 0;\r\n            //     return {\r\n            //         rowspan: _row,\r\n            //         colspan: _col\r\n            //     };\r\n            // }\r\n            // if (columnIndex === 1) {\r\n            //     const _row = this.flitterData(this.list).two[rowIndex];\r\n            //     const _col = _row > 0 ? 1 : 0;\r\n            //     return {\r\n            //         rowspan: _row,\r\n            //         colspan: _col\r\n            //     };\r\n            // }\r\n        }\r\n    },\r\n    mounted() {}\r\n};\r\n",null]}