{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\purchase\\purchaseApply\\Form.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\purchase\\purchaseApply\\Form.vue","mtime":1594026542232},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getApplyUserInfo } from '../../../api/admin/user.js';\nimport { getPurchase } from '../../../api/purchase/purchase.js';\nimport { mapGetters } from 'vuex';\nexport default {\n    data() {\n        return {\n            query: {\n                companyId: null,\n                userId: null,\n                deptId: null,\n                itemId: null,\n                type: 6,\n                priceYuan: 0\n            },\n            formData: {\n                approverids: '',\n                name: '',\n                // 详细分类\n                type1: '',\n                type2: '',\n                type3: '',\n                // 数量\n                num: '',\n                // 单位\n                units: '',\n                // 单价\n                price: '',\n                // 总价\n                totalPrice: '',\n                // 预计到货时间\n                time: ''\n            },\n            uploadUrl: '',\n            fileList2: [],\n            applyUserList: [],\n            sumClassifyOptions: [],\n            mainClassifyOptions: [],\n            subClassifyOptions: []\n        };\n    },\n    created() {\n        this.getApplyUserInfo();\n        this.formData.userId = this.userId;\n        this.query.userId = this.userId;\n        this.getPurchase('100000', this.userId);\n        this.uploadUrl = `${window.location.origin}/purchase/form/upload`;\n    },\n    computed: {\n        ...mapGetters(['permissions', 'userId']),\n\n        // 计算总价\n        totalPrice: {\n            get() {\n                this.formData.totalPrice = this.formData.num * this.formData.price;\n                return this.formData.totalPrice;\n            },\n            set(value) {\n                this.formData.totalPrice = value;\n            }\n        }\n    },\n    methods: {\n        // 获取总类\n        getPurchase(id, userId) {\n            getPurchase(id, userId).then(res => {\n                console.log(res);\n                this.sumClassifyOptions = res.data.data.purchaseType;\n            });\n        },\n\n        // 主分类\n        classifyChange(val) {\n            (this.mainClassifyOptions = []), (this.subClassifyOptions = []);\n            getPurchase(val, this.query.userId).then(res => {\n                res.data.data.purchaseType.forEach(item => {\n                    this.mainClassifyOptions.push({\n                        value: item.id,\n                        label: item.name,\n                        children: item.children\n                    });\n                });\n            });\n        },\n\n        // 详情分类\n        classifyChange2(val) {\n            this.query.itemId = null;\n            this.formData.itemId = null;\n            getPurchase(val[0], this.query.userId).then(res => {\n                this.subClassifyOptions = res.data.data.purchaseType;\n            });\n\n            // 获取项目id\n            if (val.length > 1 && val.length < 3) {\n                this.query.itemId = val[1];\n                this.formData.itemId = val[1];\n                // this.getApplyUser();\n            } else if (val.length == 3) {\n                this.query.itemId = val[2];\n                this.formData.itemId = val[2];\n                // this.getApplyUser();\n            } else {\n                this.query.itemId = null;\n                this.formData.itemId = null;\n            }\n        },\n\n        getApplyUserInfo() {\n            getApplyUserInfo(this.query).then(response => {\n                this.applyUserList = [];\n                this.formData.approverids = null;\n                console.log(response);\n                response.data.data.forEach(element => {\n                    this.applyUserList.push({\n                        userId: element.userId,\n                        username: element.username,\n                        avatar: element.avatar\n                    });\n                    if (this.formData.approverids == null) {\n                        this.formData.approverids += element.userId;\n                    } else {\n                        this.formData.approverids += ',' + element.userId;\n                    }\n                });\n            });\n        },\n\n        handlePreview2(file) {\n            console.log(file);\n        },\n        handleRemove2(data) {\n            var serverUrl = `${window.location.origin}/purchase/form`;\n            const imgUrl = data.url.replace(serverUrl, '');\n            this.formData.invoiceImg = this.formData.invoiceImg.replace(imgUrl + ',', '');\n        },\n        handSuccess2(data) {\n            const imgInfo = data.data;\n            const imgUrl = imgInfo.bucketName + '-' + imgInfo.fileName;\n            this.formData.invoiceImg += imgUrl + ',';\n        },\n        beforeAvatarUpload: function(file) {\n            const isJPG = file.type === 'image/jpeg';\n            const isPNG = file.type === 'image/png';\n            const isPG = isJPG || isPNG; //限制图片格式为jpg / png\n            const isLt5M = file.size / 1024 / 1024 < 5; //限制图片大小\n            if (!isPG) {\n                this.$message.error('上传头像图片只能是 JPG 或 PNG 格式!');\n            }\n            if (!isLt5M) {\n                this.$message.error('上传头像图片大小不能超过 5MB!');\n            }\n            return isPG && isLt5M;\n        },\n\n        // 提交\n        onSubmit() {\n            console.log(this.formData);\n        },\n\n        // 取消\n        backHistory() {\n            this.$router.go(-1);\n        }\n    }\n};\n",{"version":3,"sources":["Form.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"Form.vue","sourceRoot":"src/views/purchase/purchaseApply","sourcesContent":["<template>\n    <div>\n        <el-form ref=\"formData\" :model=\"formData\" class=\"form\" label-width=\"150px\">\n            <el-form-item label=\"采购物品名称：\" prop=\"name\">\n                <el-input v-model=\"formData.name\" placeholder=\"请填写采购名称\" maxlength=\"50\" show-word-limit></el-input>\n            </el-form-item>\n\n            <el-form-item label=\"总分类：\" prop=\"name\">\n                <el-radio-group v-model=\"formData.classify\">\n                    <el-radio-group v-model=\"formData.type1\" @change=\"classifyChange\">\n                        <el-radio v-for=\"(item, index) in sumClassifyOptions\" :label=\"item.id\" :key=\"index\">{{ item.name }}</el-radio>\n                    </el-radio-group>\n                </el-radio-group>\n            </el-form-item>\n\n            <el-form-item label=\"主分类：\" prop=\"name\">\n                <el-cascader\n                    v-model=\"formData.type2\"\n                    :options=\"mainClassifyOptions\"\n                    :props=\"{ expandTrigger: 'hover' }\"\n                    :show-all-levels=\"false\"\n                    filterable\n                    size=\"mini\"\n                    @change=\"classifyChange2\"\n                ></el-cascader>\n            </el-form-item>\n\n            <el-form-item label=\"明细分类：\" prop=\"name\">\n                <el-radio-group v-model=\"formData.type3\">\n                    <el-radio v-for=\"(item, index) in subClassifyOptions\" :label=\"item.id\" :key=\"index\">{{ item.name }}</el-radio>\n                </el-radio-group>\n            </el-form-item>\n\n            <el-row>\n                <el-col :span=\"12\">\n                    <el-form-item label=\"具体需求描述：\"><el-input v-model=\"formData.name\" placeholder=\"请填写采购名称\" maxlength=\"50\" show-word-limit></el-input></el-form-item>\n                </el-col>\n                <el-col :span=\"12\">\n                    <el-form-item label=\"推荐厂家名称：\"><el-input v-model=\"formData.name\" placeholder=\"请填写采购名称\" maxlength=\"50\" show-word-limit></el-input></el-form-item>\n                </el-col>\n            </el-row>\n\n            <el-row>\n                <el-col :span=\"12\">\n                    <el-form-item label=\"推荐淘宝/京东链接：\"><el-input v-model=\"formData.name\" placeholder=\"请输入链接\"></el-input></el-form-item>\n                </el-col>\n                <el-col :span=\"12\">\n                    <el-row>\n                        <el-col :span=\"12\">\n                            <el-form-item label=\"需求数量：\"><el-input v-model.number=\"formData.num\" placeholder=\"请输入数量\"></el-input></el-form-item>\n                        </el-col>\n                        <el-col :span=\"12\">\n                            <el-form-item label=\"单位：\"><el-input v-model=\"formData.units\" placeholder=\"请输入单位\"></el-input></el-form-item>\n                        </el-col>\n                    </el-row>\n                </el-col>\n            </el-row>\n\n            <el-row>\n                <el-col :span=\"12\">\n                    <el-form-item label=\"型号参数/描述截图：\"><el-input v-model=\"formData.name\" placeholder=\"请填写采购名称\"></el-input></el-form-item>\n                </el-col>\n                <el-col :span=\"12\">\n                    <el-row>\n                        <el-col :span=\"12\">\n                            <el-form-item label=\"预估单价：\"><el-input v-model.number=\"formData.price\" placeholder=\"请输入单价\"></el-input></el-form-item>\n                        </el-col>\n                        <el-col :span=\"12\">\n                            <el-form-item label=\"预估总价：\"><el-input v-model.number=\"totalPrice\" disabled placeholder=\"请输入总价\"></el-input></el-form-item>\n                        </el-col>\n                    </el-row>\n                </el-col>\n            </el-row>\n\n            <el-form-item label=\"描述截图：\" prop=\"invoiceImg\">\n                <el-upload\n                    class=\"upload-demo\"\n                    :action=\"uploadUrl\"\n                    name=\"file\"\n                    :on-preview=\"handlePreview2\"\n                    :on-remove=\"handleRemove2\"\n                    :on-success=\"handSuccess2\"\n                    :before-upload=\"beforeAvatarUpload\"\n                    :file-list=\"fileList2\"\n                    accept=\".png,.jpg,.jpeg,.JPEG,.PNG,.JPG\"\n                    list-type=\"picture\"\n                >\n                    <el-button size=\"small\" type=\"primary\">点击上传</el-button>\n                    <div slot=\"tip\" class=\"el-upload__tip\">只能上传jpg/png文件，且不超过5MB</div>\n                </el-upload>\n            </el-form-item>\n\n            <el-form-item label=\"备注：\">\n                <el-input type=\"textarea\" :rows=\"2\" maxlength=\"80\" show-word-limit placeholder=\"特殊要求(例如: 保质期, 定制尺寸和颜色等等)\"></el-input>\n            </el-form-item>\n\n            <el-row>\n                <el-col :span=\"16\">\n                    <el-form-item label=\"收货信息：\"><el-input v-model=\"formData.name\" placeholder=\"请填写采购名称\" maxlength=\"50\" show-word-limit></el-input></el-form-item>\n                </el-col>\n                <el-col :span=\"8\">\n                    <el-form-item label=\"预计到货时间：\">\n                        <el-date-picker format=\"yyyy 年 MM 月 dd 日\" value-format=\"yyyy-MM-dd\" type=\"date\" v-model=\"formData.time\" placeholder=\"选择日期\"></el-date-picker>\n                    </el-form-item>\n                </el-col>\n            </el-row>\n\n            <el-form-item label=\"审批人：\">\n                <div class=\"apply-user-list\" v-for=\"user in applyUserList\">\n                    <el-avatar :size=\"60\" :src=\"user.avatar\"></el-avatar>\n                    <span class=\"username\">{{ user.username }}</span>\n                </div>\n            </el-form-item>\n            <el-form-item style=\"text-align: center\" class=\"save\">\n                <el-button type=\"primary\" @click=\"onSubmit\">保存</el-button>\n                <el-button @click=\"backHistory\">取消</el-button>\n            </el-form-item>\n        </el-form>\n        <el-button type=\"primary\" class=\"invoiceRules\">报销规范</el-button>\n    </div>\n</template>\n\n<script>\nimport { getApplyUserInfo } from '../../../api/admin/user.js';\nimport { getPurchase } from '../../../api/purchase/purchase.js';\nimport { mapGetters } from 'vuex';\nexport default {\n    data() {\n        return {\n            query: {\n                companyId: null,\n                userId: null,\n                deptId: null,\n                itemId: null,\n                type: 6,\n                priceYuan: 0\n            },\n            formData: {\n                approverids: '',\n                name: '',\n                // 详细分类\n                type1: '',\n                type2: '',\n                type3: '',\n                // 数量\n                num: '',\n                // 单位\n                units: '',\n                // 单价\n                price: '',\n                // 总价\n                totalPrice: '',\n                // 预计到货时间\n                time: ''\n            },\n            uploadUrl: '',\n            fileList2: [],\n            applyUserList: [],\n            sumClassifyOptions: [],\n            mainClassifyOptions: [],\n            subClassifyOptions: []\n        };\n    },\n    created() {\n        this.getApplyUserInfo();\n        this.formData.userId = this.userId;\n        this.query.userId = this.userId;\n        this.getPurchase('100000', this.userId);\n        this.uploadUrl = `${window.location.origin}/purchase/form/upload`;\n    },\n    computed: {\n        ...mapGetters(['permissions', 'userId']),\n\n        // 计算总价\n        totalPrice: {\n            get() {\n                this.formData.totalPrice = this.formData.num * this.formData.price;\n                return this.formData.totalPrice;\n            },\n            set(value) {\n                this.formData.totalPrice = value;\n            }\n        }\n    },\n    methods: {\n        // 获取总类\n        getPurchase(id, userId) {\n            getPurchase(id, userId).then(res => {\n                console.log(res);\n                this.sumClassifyOptions = res.data.data.purchaseType;\n            });\n        },\n\n        // 主分类\n        classifyChange(val) {\n            (this.mainClassifyOptions = []), (this.subClassifyOptions = []);\n            getPurchase(val, this.query.userId).then(res => {\n                res.data.data.purchaseType.forEach(item => {\n                    this.mainClassifyOptions.push({\n                        value: item.id,\n                        label: item.name,\n                        children: item.children\n                    });\n                });\n            });\n        },\n\n        // 详情分类\n        classifyChange2(val) {\n            this.query.itemId = null;\n            this.formData.itemId = null;\n            getPurchase(val[0], this.query.userId).then(res => {\n                this.subClassifyOptions = res.data.data.purchaseType;\n            });\n\n            // 获取项目id\n            if (val.length > 1 && val.length < 3) {\n                this.query.itemId = val[1];\n                this.formData.itemId = val[1];\n                // this.getApplyUser();\n            } else if (val.length == 3) {\n                this.query.itemId = val[2];\n                this.formData.itemId = val[2];\n                // this.getApplyUser();\n            } else {\n                this.query.itemId = null;\n                this.formData.itemId = null;\n            }\n        },\n\n        getApplyUserInfo() {\n            getApplyUserInfo(this.query).then(response => {\n                this.applyUserList = [];\n                this.formData.approverids = null;\n                console.log(response);\n                response.data.data.forEach(element => {\n                    this.applyUserList.push({\n                        userId: element.userId,\n                        username: element.username,\n                        avatar: element.avatar\n                    });\n                    if (this.formData.approverids == null) {\n                        this.formData.approverids += element.userId;\n                    } else {\n                        this.formData.approverids += ',' + element.userId;\n                    }\n                });\n            });\n        },\n\n        handlePreview2(file) {\n            console.log(file);\n        },\n        handleRemove2(data) {\n            var serverUrl = `${window.location.origin}/purchase/form`;\n            const imgUrl = data.url.replace(serverUrl, '');\n            this.formData.invoiceImg = this.formData.invoiceImg.replace(imgUrl + ',', '');\n        },\n        handSuccess2(data) {\n            const imgInfo = data.data;\n            const imgUrl = imgInfo.bucketName + '-' + imgInfo.fileName;\n            this.formData.invoiceImg += imgUrl + ',';\n        },\n        beforeAvatarUpload: function(file) {\n            const isJPG = file.type === 'image/jpeg';\n            const isPNG = file.type === 'image/png';\n            const isPG = isJPG || isPNG; //限制图片格式为jpg / png\n            const isLt5M = file.size / 1024 / 1024 < 5; //限制图片大小\n            if (!isPG) {\n                this.$message.error('上传头像图片只能是 JPG 或 PNG 格式!');\n            }\n            if (!isLt5M) {\n                this.$message.error('上传头像图片大小不能超过 5MB!');\n            }\n            return isPG && isLt5M;\n        },\n\n        // 提交\n        onSubmit() {\n            console.log(this.formData);\n        },\n\n        // 取消\n        backHistory() {\n            this.$router.go(-1);\n        }\n    }\n};\n</script>\n\n<style></style>\n"]}]}