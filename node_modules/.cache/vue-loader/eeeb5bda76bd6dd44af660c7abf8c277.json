{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\admin\\UserInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\admin\\UserInfo.vue","mtime":1588235430045},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { getUserInfo, editUser, getWeixinAvatar} from \"../../api/admin/user.js\";\r\nimport { mapGetters } from \"vuex\";\r\nexport default {\r\n    data() {\r\n        let validatePass = (rule, value, callback) => {\r\n            if (value === \"\") {\r\n                callback(new Error(\"请输入密码\"));\r\n            } else {\r\n                if (!/^[0-9A-Za-z]{6,15}$/.test(value)) {\r\n                    callback(new Error(\"密码少于6位\"));\r\n                }\r\n                callback();\r\n            }\r\n        };\r\n        return {\r\n            formData: {\r\n                userId: \"\",\r\n                username: \"\",\r\n                avatar: \"\",\r\n                phone: \"\",\r\n                newpassword1: \"\",\r\n                joinedTime: \"\",\r\n                wxOpenid: \"\"\r\n            },\r\n            saving: false,\r\n            rules: {\r\n                password: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入新密码\",\r\n                        trigger: \"blur\"\r\n                    },\r\n                    { validator: validatePass, trigger: \"blur\" }\r\n                ]\r\n            },\r\n            uploadUrl: \"\",\r\n        };\r\n    },\r\n    created() {\r\n        this.formData.userId = this.userId;\r\n        this.getUserInfo();\r\n        this.uploadUrl = `${window.location.origin}/admin/user/file/upload`;\r\n    },\r\n    computed: {\r\n        ...mapGetters([\"permissions\", \"userId\"])\r\n    },\r\n    methods: {\r\n        getUserInfo() {\r\n            getUserInfo(this.formData.userId).then(response => {\r\n                if (response.data.data) {\r\n                    const userInfo = response.data.data;\r\n                    this.formData.username = userInfo.username;\r\n                    this.formData.avatar = userInfo.avatar;\r\n                    this.formData.phone = userInfo.phone;\r\n                    this.formData.joinedTime = userInfo.joinedTime;\r\n                    this.formData.wxOpenid = userInfo.wxOpenid;\r\n                }\r\n            });\r\n        },\r\n        backHistory() {\r\n            this.$router.go(-1);\r\n        },\r\n        handleAvatarSuccess(res, file) {\r\n            var avatarUrl = `${window.location.origin}/admin/user/file/` + res.data.bucketName + \"-\" + res.data.fileName;\r\n            this.formData.avatar = avatarUrl;\r\n            this.imageUrl = URL.createObjectURL(file.raw);\r\n        },\r\n        beforeAvatarUpload(file) {\r\n            const isJPG = file.type === \"image/jpeg\";\r\n            const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n            if (!isJPG) {\r\n                this.$message.error(\"上传头像图片只能是 JPG 格式!\");\r\n            }\r\n            if (!isLt2M) {\r\n                this.$message.error(\"上传头像图片大小不能超过 2MB!\");\r\n            }\r\n            return isJPG && isLt2M;\r\n        },\r\n        onSubmit() {\r\n            if (this.formData.phone.indexOf(\"*\") != -1) {\r\n                this.formData.phone = \"\";\r\n            }\r\n            editUser(this.formData)\r\n                .then(res => {\r\n                    if (res.data.data) {\r\n                        this.$message({\r\n                            message: \"修改成功\",\r\n                            type: \"success\"\r\n                        });\r\n                        // 刷新表单\r\n                        this.$store.dispatch(\"loginOut\").then(() => {\r\n                            location.reload(); // 为了重新实例化vue-router对象 避免bug\r\n                        });\r\n                    }\r\n                })\r\n                .finally(() => {\r\n                    this.saving = false;\r\n                });\r\n        },\r\n        getWeixinAvatar() {\r\n            getWeixinAvatar(this.formData.userId).then(response => {\r\n                if (response.data.data) {\r\n                    this.formData.avatar = response.data.data;\r\n                    //console.log(response.data.data)\r\n                }\r\n            })\r\n        }\r\n    },\r\n    mounted() {}\r\n};\r\n",null]}