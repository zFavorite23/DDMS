{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\project\\Total.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\project\\Total.vue","mtime":1588235430075},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { adList, adSave, adDelete } from \"../../api/ad/ad\";\r\nimport Upload from \"../../components/File/Upload.vue\";\r\nconst formJson = {\r\n    ad_id: \"\",\r\n    title: \"\",\r\n    describe: \"\",\r\n    pic: \"\",\r\n    pic_url: \"\",\r\n    jump_type: \"\",\r\n    jump_url: \"\",\r\n    ios_url: \"\",\r\n    android_url: \"\",\r\n    wxa_appid: \"\",\r\n    channel_type: 0,\r\n    channel_list: [],\r\n    android_version_type: 0,\r\n    android_version_list: [],\r\n    ios_version_type: 0,\r\n    ios_version_list: [],\r\n    new_show_start_num: 0,\r\n    new_show_max_num: 0,\r\n    old_show_start_num: 0,\r\n    old_show_max_num: 0,\r\n    end_time: \"\",\r\n    event_name: \"\",\r\n    status: 1\r\n};\r\nexport default {\r\n    data() {\r\n        return {\r\n            query: {\r\n                title: \"\",\r\n                page: 1,\r\n                limit: 20\r\n            },\r\n            channelListInput: \"\",\r\n            androidVersionListInput: \"\",\r\n            iosVersionListInput: \"\",\r\n            list: [],\r\n            total: 0,\r\n            loading: true,\r\n            index: null,\r\n            formName: null,\r\n            formMap: {\r\n                add: \"新增\",\r\n                edit: \"编辑\"\r\n            },\r\n            formLoading: false,\r\n            formVisible: false,\r\n            formData: formJson,\r\n            formRules: {\r\n                title: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入广告标题\",\r\n                        trigger: \"blur\"\r\n                    }\r\n                ],\r\n                pic: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请选择封面图片\",\r\n                        trigger: \"change\"\r\n                    }\r\n                ],\r\n                jump_type: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请选择跳转方式\",\r\n                        trigger: \"change\"\r\n                    }\r\n                ],\r\n                jump_url: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入跳转链接\",\r\n                        trigger: \"blur\"\r\n                    }\r\n                ],\r\n                android_url: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入Android类名\",\r\n                        trigger: \"blur\"\r\n                    }\r\n                ],\r\n                ios_url: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入IOS类名\",\r\n                        trigger: \"blur\"\r\n                    }\r\n                ],\r\n                wxa_appid: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入小程序Appid\",\r\n                        trigger: \"blur\"\r\n                    }\r\n                ],\r\n                channel_list: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入至少一个渠道名单\",\r\n                        trigger: \"change\"\r\n                    }\r\n                ],\r\n                android_version_list: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入至少一个Android版本名单\",\r\n                        trigger: \"change\"\r\n                    }\r\n                ],\r\n                ios_version_list: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入至少一个iOS版本名单\",\r\n                        trigger: \"change\"\r\n                    }\r\n                ],\r\n                status: [\r\n                    { required: true, message: \"请选择状态\", trigger: \"change\" }\r\n                ]\r\n            },\r\n            deleteLoading: false\r\n        };\r\n    },\r\n    components: {\r\n        Upload\r\n    },\r\n    methods: {\r\n        onReset() {\r\n            this.$router.push({\r\n                path: \"\"\r\n            });\r\n            this.query = {\r\n                title: \"\",\r\n                page: 1,\r\n                limit: 20\r\n            };\r\n            this.getList();\r\n        },\r\n        onSubmit() {\r\n            this.$router.push({\r\n                path: \"\",\r\n                query: this.query\r\n            });\r\n            this.getList();\r\n        },\r\n        handleSizeChange(val) {\r\n            this.query.limit = val;\r\n            this.getList();\r\n        },\r\n        handleCurrentChange(val) {\r\n            this.query.page = val;\r\n            this.getList();\r\n        },\r\n        getList() {\r\n            this.loading = true;\r\n            adList(this.query)\r\n                .then(response => {\r\n                    this.loading = false;\r\n                    this.list = response.data.List || [];\r\n                    this.total = response.data.total || 0;\r\n                })\r\n                .catch(() => {\r\n                    this.loading = false;\r\n                    this.list = [];\r\n                    this.total = 0;\r\n                });\r\n        },\r\n        // 删除渠道\r\n        handleChannelListClose(index) {\r\n            console.log(index);\r\n            // 更改值\r\n            this.formData.channel_list.splice(index, 1);\r\n        },\r\n        // 添加渠道白名单\r\n        handleChannelListSubmit() {\r\n            // 更改值\r\n            if (\r\n                this.channelListInput &&\r\n                this.formData.channel_list.length < 15\r\n            ) {\r\n                let arr = this.channelListInput.split(\",\");\r\n                for (let i in arr) {\r\n                    if (\r\n                        arr[i] !== \"\" &&\r\n                        (this.formData.channel_list.length === 0 ||\r\n                            this.formData.channel_list.indexOf(arr[i]) < 0)\r\n                    ) {\r\n                        this.formData.channel_list.push(arr[i]);\r\n                    }\r\n                }\r\n                this.channelListInput = \"\";\r\n                this.$refs.channelListRef.focus();\r\n            }\r\n        },\r\n        // 删除Android版本\r\n        handleAndroidVersionListClose(index) {\r\n            // 更改值\r\n            this.formData.android_version_list.splice(index, 1);\r\n        },\r\n        // 添加Android版本\r\n        handleAndroidVersionListSubmit() {\r\n            // 更改值\r\n            if (\r\n                this.androidVersionListInput &&\r\n                this.formData.android_version_list.length < 15\r\n            ) {\r\n                let arr = this.androidVersionListInput.split(\",\");\r\n                for (let i in arr) {\r\n                    let avList = this.formData.android_version_list;\r\n                    if (\r\n                        arr[i] !== \"\" &&\r\n                        (avList.length === 0 || avList.indexOf(arr[i]) < 0)\r\n                    ) {\r\n                        this.formData.android_version_list.push(arr[i]);\r\n                    }\r\n                }\r\n                this.androidVersionListInput = \"\";\r\n                this.$refs.androidVersionListRef.focus();\r\n            }\r\n        },\r\n        // 删除Ios版本\r\n        handleIosVersionListClose(index) {\r\n            // 更改值\r\n            this.formData.ios_version_list.splice(index, 1);\r\n        },\r\n        // 添加Ios版本\r\n        handleIosVersionListSubmit() {\r\n            // 更改值\r\n            if (\r\n                this.iosVersionListInput &&\r\n                this.formData.ios_version_list.length < 15\r\n            ) {\r\n                let arr = this.iosVersionListInput.split(\",\");\r\n                for (let i in arr) {\r\n                    if (\r\n                        arr[i] !== \"\" &&\r\n                        (this.formData.ios_version_list.length === 0 ||\r\n                            this.formData.ios_version_list.indexOf(arr[i]) < 0)\r\n                    ) {\r\n                        this.formData.ios_version_list.push(arr[i]);\r\n                    }\r\n                }\r\n                this.iosVersionListInput = \"\";\r\n                this.$refs.iosVersionListRef.focus();\r\n            }\r\n        },\r\n        // 刷新表单\r\n        resetForm() {\r\n            if (this.$refs[\"dataForm\"]) {\r\n                // 清空字段\r\n                this.$refs[\"dataForm\"].resetFields();\r\n                // 清空验证信息表单\r\n                this.$refs[\"dataForm\"].clearValidate();\r\n            }\r\n        },\r\n        // 隐藏表单\r\n        hideForm() {\r\n            // 更改值\r\n            this.formVisible = !this.formVisible;\r\n            return true;\r\n        },\r\n        // 显示表单\r\n        handleForm(index, row) {\r\n            this.formVisible = true;\r\n            // 刷新表单\r\n            this.resetForm();\r\n            this.formData = JSON.parse(JSON.stringify(formJson));\r\n            if (row !== null) {\r\n                this.formData = Object.assign({}, row);\r\n            }\r\n            this.formName = \"add\";\r\n            if (index !== null) {\r\n                this.index = index;\r\n                this.formName = \"edit\";\r\n            }\r\n        },\r\n        formSubmit() {\r\n            this.$refs[\"dataForm\"].validate(valid => {\r\n                if (valid) {\r\n                    this.formLoading = true;\r\n                    let data = Object.assign({}, this.formData);\r\n                    adSave(data, this.formName)\r\n                        .then(response => {\r\n                            this.formLoading = false;\r\n                            if (response.code) {\r\n                                this.$message.error(response.message);\r\n                                return false;\r\n                            }\r\n                            this.$message.success(\"操作成功\");\r\n                            this.formVisible = false;\r\n                            if (this.formName === \"add\") {\r\n                                // 向头部添加数据\r\n                                data.ad_id = response.data.ad_id;\r\n                                this.list.unshift(data);\r\n                            } else {\r\n                                this.list.splice(this.index, 1, data);\r\n                            }\r\n                        })\r\n                        .catch(() => {\r\n                            this.formLoading = false;\r\n                        });\r\n                }\r\n            });\r\n        },\r\n        // 删除\r\n        handleDel(index, row) {\r\n            if (row.ad_id) {\r\n                this.$confirm(\"确认删除该记录吗?\", \"提示\", {\r\n                    type: \"warning\"\r\n                })\r\n                    .then(() => {\r\n                        let para = { ad_id: row.ad_id };\r\n                        this.deleteLoading = true;\r\n                        adDelete(para)\r\n                            .then(response => {\r\n                                this.deleteLoading = false;\r\n                                if (response.code) {\r\n                                    this.$message.error(response.message);\r\n                                    return false;\r\n                                }\r\n                                this.$message(\"删除成功\");\r\n                                // 刷新数据\r\n                                this.list.splice(index, 1);\r\n                            })\r\n                            .catch(() => {\r\n                                this.deleteLoading = false;\r\n                            });\r\n                    })\r\n                    .catch(() => {\r\n                        this.$message.info(\"取消删除\");\r\n                    });\r\n            }\r\n        },\r\n        onSelectPic(filePath, filePathUrl) {\r\n            this.formData.pic = filePath;\r\n            this.formData.pic_url = filePathUrl;\r\n        }\r\n    },\r\n    filters: {\r\n        statusFilterType(status) {\r\n            const statusMap = {\r\n                0: \"gray\",\r\n                1: \"success\"\r\n            };\r\n            return statusMap[status];\r\n        },\r\n        statusFilterName(status) {\r\n            const statusMap = {\r\n                0: \"禁用\",\r\n                1: \"正常\"\r\n            };\r\n            return statusMap[status];\r\n        }\r\n    },\r\n    mounted() {},\r\n    created() {\r\n        // 将参数拷贝进查询对象\r\n        let query = this.$route.query;\r\n        this.query = Object.assign(this.query, query);\r\n        this.query.limit = parseInt(this.query.limit);\r\n        // 加载表格数据\r\n        this.getList();\r\n    }\r\n};\r\n",null]}