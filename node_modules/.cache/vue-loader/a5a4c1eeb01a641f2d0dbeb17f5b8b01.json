{"remainingRequest":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DDMS\\src\\views\\login\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DDMS\\src\\views\\login\\index.vue","mtime":1592813778460},{"path":"D:\\DDMS\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DDMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { randomLenNum } from '@/utils/utils';\r\nimport { codeUrl } from '@/config/app';\r\nconst Base64 = require('js-base64').Base64;\r\nexport default {\r\n    name: 'login',\r\n    data() {\r\n        return {\r\n            ruleForm: {\r\n                username: '', //用户名\r\n                password: '',\r\n                code: '',\r\n                randomStr: ''\r\n            },\r\n            remember: true,\r\n            autoLogin: true,\r\n            isAutoLogin: false,\r\n            isMobile: false,\r\n            checked: true,\r\n            code: {\r\n                src: '/code',\r\n                value: '',\r\n                len: 4,\r\n                type: 'image'\r\n            },\r\n            rules: {\r\n                username: [{ required: true, message: '请输入用户名', trigger: 'blur' }],\r\n                password: [{ required: true, message: '请输入密码', trigger: 'blur' }, { min: 6, message: '密码长度最少为6位', trigger: 'blur' }],\r\n                code: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入验证码',\r\n                        trigger: 'blur'\r\n                    },\r\n                    {\r\n                        min: 4,\r\n                        max: 4,\r\n                        message: '验证码长度为4位',\r\n                        trigger: 'blur'\r\n                    }\r\n                ]\r\n            },\r\n            isShowPwd: false, // 是否显示密码\r\n            loading: false, // 登录loading\r\n            showDialog: false, // 显示dialog\r\n            redirect: null, // 回调地址\r\n            codeUrl: codeUrl\r\n        };\r\n    },\r\n    created() {\r\n        // 将参数拷贝进查询对象\r\n        let query = this.$route.query;\r\n        if (query.redirect) {\r\n            // URL Encode\r\n            this.redirect = decodeURIComponent(query.redirect);\r\n        }\r\n\r\n        //this._isMobile();\r\n\r\n        // let ddmsusername = this.getCookie(\"ddmsusername\");\r\n        // let ddmspassword = Base64.decode(this.getCookie(\"ddmspassword\"));\r\n\r\n        let ddmsusername = window.localStorage.getItem('ddmsusername');\r\n        let ddmspassword = Base64.decode(window.localStorage.getItem('ddmspassword'));\r\n        if (ddmsusername) {\r\n            this.ruleForm.username = ddmsusername;\r\n            this.ruleForm.password = ddmspassword;\r\n        }\r\n\r\n        this.refreshCode(ddmsusername);\r\n\r\n        //alert(this.getCode().code);\r\n    },\r\n    methods: {\r\n        changeImgCode() {\n            this.refreshCode()\r\n        },\r\n\r\n        isRemember(val) {\r\n            console.log(val);\r\n            if (!val) {\r\n                this.autoLogin = false;\r\n                this.isAutoLogin = true;\r\n            } else {\r\n                this.autoLogin = true;\r\n                this.isAutoLogin = false;\r\n            }\r\n        },\r\n        refreshCode(ddmsusername) {\r\n            this.ruleForm.code = '';\r\n            this.ruleForm.randomStr = randomLenNum(this.code.len, true);\r\n            if (ddmsusername) {\r\n                this.code.type = 'text';\r\n            }\r\n            this.code.type === 'text' ? (this.code.value = randomLenNum(this.code.len)) : (this.code.src = `${this.codeUrl}?randomStr=${this.ruleForm.randomStr}`);\r\n            this.ruleForm.code = this.code.value;\r\n            //let ddmsAutoLogin = this.getCookie(\"ddmsAutoLogin\");\r\n            let ddmsAutoLogin = window.localStorage.getItem('ddmsAutoLogin');\r\n            if (ddmsAutoLogin) {\r\n                this.login();\r\n            }\r\n        },\r\n        handleLogin() {\r\n            this.$refs[\"ruleForm\"].validate(valid => {\r\n                if (valid) {\r\n                    this.login();\r\n                } else {\r\n                    return false;\r\n                }\r\n            });\r\n        },\r\n\r\n        login() {\r\n            this.loading = true;\r\n            this.$store\r\n                .dispatch('loginName', this.ruleForm)\r\n                .then(response => {\r\n                    console.log(response);\r\n                    this.loading = false;\r\n                    // if (response.code) {\r\n                    //     this.$message.error(response.message);\r\n                    //     return;\r\n                    // }\r\n                    // 储存登录信息\r\n                    this.setUserInfo();\r\n                    let path = '/';\r\n                    // if (this.redirect) {\r\n                    //     path = this.redirect;\r\n                    // }\r\n                    this.$router.push({\r\n                        path: path\r\n                    });\r\n                    //console.log(path)\r\n                    //window.location.replace(path);\r\n                    // this.showDialog = true\r\n                })\r\n                .catch(() => {\r\n                    this.loading = false;\r\n                });\r\n        },\r\n\r\n        wxLogin() {\r\n            // if(this._isMobile()){\r\n            //     console.log(\"m\")\r\n            // }else {\r\n            //     console.log(\"pc\")\r\n            // }\r\n\r\n            // let appid, client_id, redirect_uri, url\r\n            // redirect_uri = encodeURIComponent(window.location.origin + '/#/authredirect')\r\n            //\r\n            // appid = 'wxd1678d3f83b1d83a'\r\n            // url = 'https://open.weixin.qq.com/connect/qrconnect?appid=' + appid + '&redirect_uri=' + redirect_uri + '&state=WX-BIND&response_type=code&scope=snsapi_login#wechat_redirect'\r\n\r\n            let url =\r\n                'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxce4bd89765319e92&redirect_uri=http%3A%2F%2Foa.dreamdeck.cn%2F#%2Flogin&response_type=code&scope=snsapi_userinfo&state=123#wechat_redirect';\r\n\r\n            window.location.href = url;\r\n        },\r\n        _isMobile() {\r\n            let flag = navigator.userAgent.match(\r\n                /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i\r\n            );\r\n\r\n            if (flag) {\r\n                this.isMobile = true;\r\n            }\r\n\r\n            return flag;\r\n        },\r\n        getCode() {\r\n            const href = location.href;\r\n            if (href.indexOf('?') != -1) {\r\n                var search = href.split('?')[1].split('&'),\r\n                    data = {};\r\n                for (var i = 0; i < search.length; i++) {\r\n                    var item = search[i].split('=');\r\n                    data[item[0]] = item[1];\r\n                }\r\n                return data;\r\n            } else {\r\n                return {};\r\n            }\r\n        },\r\n\r\n        // 储存表单信息\r\n        setUserInfo: function() {\r\n            // 判断用户是否勾选记住密码，如果勾选，向cookie中储存登录信息，\r\n            // 如果没有勾选，储存的信息为空\r\n            if (this.remember) {\r\n                window.localStorage.setItem('ddmsusername', this.ruleForm.username);\r\n                //this.setCookie(\"ddmsusername\",this.ruleForm.username)\r\n                // base64加密密码\r\n                let passWord = Base64.encode(this.ruleForm.password);\r\n                window.localStorage.setItem('ddmspassword', passWord);\r\n                //this.setCookie(\"ddmspassword\",passWord)\r\n            } else {\r\n                window.localStorage.setItem('ddmsusername', '');\r\n                window.localStorage.setItem('ddmspassword', '');\r\n                //this.setCookie(\"ddmsusername\",\"\")\r\n                //this.setCookie(\"ddmspassword\",\"\")\r\n            }\r\n            //this.setCookie(\"ddmsAutoLogin\",this.autoLogin)\r\n            window.localStorage.setItem('ddmsAutoLogin', this.autoLogin);\r\n        },\r\n        // 获取cookie\r\n        getCookie: function(key) {\r\n            if (document.cookie.length > 0) {\r\n                var start = document.cookie.indexOf(key + '=');\r\n                if (start !== -1) {\r\n                    start = start + key.length + 1;\r\n                    var end = document.cookie.indexOf(';', start);\r\n                    if (end === -1) end = document.cookie.length;\r\n                    return unescape(document.cookie.substring(start, end));\r\n                }\r\n            }\r\n            return '';\r\n        },\r\n        // 保存cookie\r\n        setCookie: function(cName, value, expiredays) {\r\n            var exdate = new Date();\r\n            exdate.setDate(exdate.getDate() + expiredays);\r\n            document.cookie = cName + '=' + decodeURIComponent(value) + (expiredays == null ? '' : ';expires=' + exdate.toGMTString());\r\n        }\r\n    }\r\n};\r\n",null]}